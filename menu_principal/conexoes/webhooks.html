<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="https://imagens-zipline.hgabnb.easypanel.host/u/2FsJTY.png">
   <link rel="shortcut icon" type="image/png" href="https://imagens-zipline.hgabnb.easypanel.host/u/2FsJTY.png">
   <link rel="apple-touch-icon" href="https://imagens-zipline.hgabnb.easypanel.host/u/2FsJTY.png">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciar Webhooks - Salesdever</title>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Raleway', sans-serif;
    }
    
    body {
      background: #0a0420;
      min-height: 100vh;
      color: #ffffff;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 20% 50%, rgba(165, 148, 255, 0.08) 0%, transparent 50%),
                  radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.06) 0%, transparent 50%);
      animation: backgroundFloat 20s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes backgroundFloat {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(3%, 3%); }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(165, 148, 255, 0.3);
      border-radius: 50%;
      border-top-color: #A594FF;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .progress-circle {
      transform: rotate(-90deg);
    }
    
    .progress-path {
      stroke-dasharray: 157;
      stroke-dashoffset: 157;
      transition: stroke-dashoffset 1s linear;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem;
      position: relative;
      z-index: 1;
    }

    .header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInDown 0.6s ease;
    }

    .title {
      font-size: 2.2rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #ffffff, #A594FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 400;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2.5rem;
      padding: 2rem;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.15);
      gap: 2rem;
      flex-wrap: wrap;
      box-shadow: 0 8px 32px rgba(165, 148, 255, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      animation: fadeInUp 0.6s ease 0.1s both;
    }

    .section-info h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 10px rgba(165, 148, 255, 0.3);
    }

    .section-info p {
      color: rgba(255, 255, 255, 0.65);
      font-size: 0.95rem;
    }
    
    .create-instance-btn {
      background: linear-gradient(135deg, #A594FF, #764ba2);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 1rem;
      font-family: 'Raleway', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      gap: 0.625rem;
      box-shadow: 0 4px 20px rgba(165, 148, 255, 0.5);
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      border: 1px solid rgba(165, 148, 255, 0.3);
    }

    .create-instance-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .create-instance-btn:hover::before {
      transform: translateX(100%);
    }

    .create-instance-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 35px rgba(165, 148, 255, 0.7);
    }

    .glass-effect {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px rgba(165, 148, 255, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border-radius: 1.5rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .glass-effect:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(165, 148, 255, 0.25);
    }

    .instances-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .instance-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px rgba(165, 148, 255, 0.15);
      border-radius: 1.5rem;
      padding: 2rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.6s ease both;
    }

    .instance-card:nth-child(1) { animation-delay: 0.1s; }
    .instance-card:nth-child(2) { animation-delay: 0.2s; }
    .instance-card:nth-child(3) { animation-delay: 0.3s; }
    .instance-card:nth-child(4) { animation-delay: 0.4s; }
    .instance-card:nth-child(5) { animation-delay: 0.5s; }
    .instance-card:nth-child(6) { animation-delay: 0.6s; }

    .instance-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, #A594FF, transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .instance-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(165, 148, 255, 0.1), transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .instance-card:hover {
      border-color: rgba(165, 148, 255, 0.5);
      transform: translateY(-4px) scale(1.005);
      box-shadow: 0 12px 35px rgba(165, 148, 255, 0.25);
    }

    .instance-card:hover::before,
    .instance-card:hover::after {
      opacity: 1;
    }

    .instance-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      gap: 1rem;
      position: relative;
      z-index: 1;
    }

    .instance-info {
      flex: 1;
      min-width: 0;
    }

    .instance-name {
      font-size: 1.2rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.5rem;
      line-height: 1.3;
      word-break: break-word;
      text-shadow: 0 2px 10px rgba(165, 148, 255, 0.3);
    }

    .instance-number {
      color: rgba(255, 255, 255, 0.85);
      font-size: 0.9375rem;
      margin-bottom: 0.75rem;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      font-weight: 500;
      letter-spacing: 0.025em;
    }

    .instance-details {
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      z-index: 1;
    }

    .instance-details > div {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      font-size: 0.8125rem;
      color: rgba(255, 255, 255, 0.65);
      line-height: 1.5;
    }

    .instance-details span {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-badge {
      padding: 0.3rem 0.75rem;
      border-radius: 0.875rem;
      font-size: 0.6875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .status-connected {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.3));
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #22C55E;
      box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
    }

    .status-disconnected {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.3));
      border: 1px solid rgba(239, 68, 68, 0.5);
      color: #EF4444;
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }

    .status-pending {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3));
      border: 1px solid rgba(251, 191, 36, 0.5);
      color: #FBC02D;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }

    .instance-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 0.75rem;
      margin-top: 1.5rem;
      position: relative;
      z-index: 1;
    }

    /* Quando há 1 botão, ocupa 100% */
    .instance-actions:has(button:only-child) {
      grid-template-columns: 1fr;
    }

    /* Quando há 2 botões, ficam lado a lado */
    .instance-actions:has(button:nth-child(2):last-child) {
      grid-template-columns: 1fr 1fr;
    }

    /* Quando há 3 botões, o último fica em baixo */
    .instance-actions:has(button:nth-child(3)) {
      grid-template-columns: 1fr 1fr;
    }

    .instance-actions button:last-child:nth-child(3) {
      grid-column: 1 / -1;
    }

    .btn-action {
      padding: 0.625rem 1rem;
      border: none;
      border-radius: 0.75rem;
      font-family: 'Raleway', sans-serif;
      font-weight: 600;
      font-size: 0.8125rem;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      white-space: nowrap;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .btn-action svg {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      transition: transform 0.2s ease;
    }
    
    .btn-action:hover:not(:disabled) svg {
      transform: scale(1.1);
    }
    
    .btn-action:active:not(:disabled) {
      transform: translateY(0px) scale(0.98) !important;
    }

    .btn-action::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .btn-action:hover::before {
      transform: translateX(100%);
    }

    .btn-disconnect {
      background: linear-gradient(135deg, #F59E0B, #D97706);
      color: white;
      box-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
    }

    .btn-disconnect:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.5);
    }

    .btn-delete {
      background: linear-gradient(135deg, #EF4444, #DC2626);
      color: white;
      box-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
    }

    .btn-delete:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5);
    }

    .btn-connect {
      background: linear-gradient(135deg, #22C55E, #16A34A);
      color: white;
      box-shadow: 0 2px 10px rgba(34, 197, 94, 0.3);
    }

    .btn-connect:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(34, 197, 94, 0.5);
    }

    .btn-action:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    .btn-action:disabled svg {
      transform: none !important;
    }

    /* Estilos específicos para os novos botões */
    .btn-logs {
      background: rgba(124, 58, 237, 0.15) !important;
      border: 1px solid rgba(165, 148, 255, 0.3) !important;
      color: rgba(165, 148, 255, 0.9) !important;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(124, 58, 237, 0.2) !important;
    }

    .btn-logs:hover {
      background: rgba(124, 58, 237, 0.2) !important;
      border-color: rgba(165, 148, 255, 0.5) !important;
      color: rgba(165, 148, 255, 1) !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3) !important;
    }

    .btn-edit {
      background: rgba(165, 148, 255, 0.15) !important;
      border: 1px solid rgba(165, 148, 255, 0.3) !important;
      color: rgba(165, 148, 255, 0.9) !important;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(165, 148, 255, 0.2) !important;
    }

    .btn-edit:hover {
      background: rgba(165, 148, 255, 0.2) !important;
      border-color: rgba(165, 148, 255, 0.5) !important;
      color: rgba(165, 148, 255, 1) !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(165, 148, 255, 0.3) !important;
    }

    /* Estilo específico para o botão Ver Informações */
    .btn-info-toggle {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      backdrop-filter: blur(15px);
      border: 1px solid rgba(165, 148, 255, 0.4);
      color: rgba(255, 255, 255, 0.95);
      border-radius: 0.75rem;
      padding: 0.875rem 1.25rem;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      width: 100%;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(165, 148, 255, 0.1);
    }

    .btn-info-toggle::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        transparent 30%,
        rgba(165, 148, 255, 0.08) 50%,
        transparent 70%
      );
      transform: translateX(-100%) skewX(-15deg);
      transition: transform 0.8s ease;
    }

    .btn-info-toggle:hover::before {
      transform: translateX(100%) skewX(-15deg);
    }

    .btn-info-toggle:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
      border-color: rgba(165, 148, 255, 0.6);
      transform: translateY(-1px);
      box-shadow: 0 6px 25px rgba(165, 148, 255, 0.25);
      color: rgba(255, 255, 255, 1);
    }

    .btn-info-toggle:active {
      transform: translateY(0);
      transition: transform 0.15s ease;
    }

    .btn-info-toggle .info-chevron {
      transition: transform 0.3s ease;
    }

    .btn-info-toggle.expanded .info-chevron {
      transform: rotate(180deg);
    }

    .loading, .error, .empty-state {
      text-align: center;
      padding: 5rem 2.5rem;
      margin: 2rem 0;
      animation: fadeIn 0.6s ease;
    }

    .loading {
      font-size: 1.125rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .error {
      color: #EF4444;
      font-size: 1.0625rem;
    }

    .empty-state {
      color: #94a3b8;
    }

    .empty-state svg {
      margin-bottom: 2rem;
      opacity: 0.6;
      filter: drop-shadow(0 4px 15px rgba(165, 148, 255, 0.3));
    }

    .empty-state h3 {
      font-size: 1.75rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 1rem;
    }

    .empty-state p {
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 2.5rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .input-focus {
      width: 100%;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 0.75rem;
      color: #ffffff;
      font-size: 0.95rem;
      font-weight: 500;
      outline: none;
      transition: all 0.3s ease;
      box-shadow: none;
    }

    .input-focus::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .input-focus:hover {
      border-color: rgba(165, 148, 255, 0.5);
      background: rgba(255, 255, 255, 0.08);
    }

    .input-focus:focus {
      border-color: #A594FF;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2);
    }

    /* Estilos especiais para select */
    select.input-focus {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23A594FF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 18px;
      padding-right: 3rem;
      cursor: pointer;
    }

    select.input-focus option {
      background: #1a1333;
      color: #ffffff;
      padding: 0.5rem;
      font-weight: 500;
    }

    select.input-focus option:checked {
      background: #A594FF;
      color: #ffffff;
    }

    /* Estilos removidos - labels agora são simples */

    .btn-primary {
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(135deg, #A594FF, #764ba2);
      position: relative;
      overflow: hidden;
      color: white;
      border: 1px solid rgba(165, 148, 255, 0.3);
      font-weight: 700;
      cursor: pointer;
      border-radius: 0.75rem;
      padding: 0.75rem 1.5rem;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 0.9375rem;
      box-shadow: 0 2px 10px rgba(165, 148, 255, 0.4);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }
    
    .btn-primary:hover:not(:disabled)::before {
      transform: translateX(100%);
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(165, 148, 255, 0.6);
    }
    
    .btn-primary:active:not(:disabled) {
      transform: translateY(0px) scale(0.98) !important;
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-primary svg {
      width: 16px;
      height: 16px;
      transition: transform 0.2s ease;
    }
    
    .btn-primary:hover:not(:disabled) svg {
      transform: scale(1.1);
    }

    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .btn-secondary {
      transition: all 0.25s ease;
      background: rgba(10, 5, 30, 0.95);
      color: #ffffff;
      border: 2px solid rgba(165, 148, 255, 0.5);
      font-weight: 600;
      cursor: pointer;
      border-radius: 0.75rem;
      padding: 0.75rem 1.5rem;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 0.9375rem;
    }
    
    .btn-secondary:hover {
      background: rgba(5, 2, 20, 1);
      color: #ffffff;
      border-color: rgba(165, 148, 255, 0.7);
      box-shadow: 0 2px 15px rgba(165, 148, 255, 0.3);
      transform: translateY(-1px);
    }
    
    .btn-secondary svg {
      width: 16px;
      height: 16px;
      transition: transform 0.2s ease;
    }
    
    .btn-secondary:hover svg {
      transform: scale(1.1);
    }

    .feature-card {
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.2), rgba(118, 75, 162, 0.15));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(165, 148, 255, 0.4);
      border-radius: 1rem;
    }
    
    .feature-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 8px 32px rgba(165, 148, 255, 0.4);
      border-color: rgba(165, 148, 255, 0.6);
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.3), rgba(118, 75, 162, 0.25));
    }

    .feature-card .w-10 {
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.3), rgba(118, 75, 162, 0.2));
      color: white;
    }

    .error-input {
      border-color: #ef4444 !important;
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.25) !important;
    }

    .error-message {
      color: #ef4444;
      font-size: 0.875rem;
      margin-top: 0.625rem;
      display: none;
      padding-left: 0.25rem;
    }

    .error-message.show {
      display: block;
    }

    .page {
      display: none;
      min-height: 100vh;
    }

    .page.active {
      display: block;
    }

    .main-container {
      width: 100%;
      max-width: 580px;
      margin: 0 auto;
      padding: 3rem 2.5rem;
    }

    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      padding: 1rem;
    }

    .popup-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .popup {
      background: linear-gradient(135deg, rgba(34, 25, 88, 0.95), rgba(54, 44, 125, 0.95));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(165, 148, 255, 0.4);
      border-radius: 1.5rem;
      padding: 2.5rem;
      max-width: 440px;
      width: 100%;
      text-align: center;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .popup-overlay.show .popup {
      transform: scale(1);
    }

    .popup-success {
      border-color: rgba(34, 197, 94, 0.6);
    }

    .popup-error {
      border-color: rgba(239, 68, 68, 0.6);
    }

    .popup-icon {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      margin: 0 auto 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .popup-success .popup-icon {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
    }

    .popup-error .popup-icon {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }

    #popupMessage {
      word-wrap: break-word;
      word-break: break-all;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      max-width: 100%;
      line-height: 1.6;
    }

    #popupMessage strong {
      color: rgba(165, 148, 255, 1);
      font-weight: 600;
    }

    @media (max-width: 768px) {
      body {
        padding: 0;
      }

      .container {
        padding: 2rem 1.5rem;
      }

      .header {
        margin-bottom: 2.5rem;
      }

      .title {
        font-size: 1.8rem;
      }

      .subtitle {
        font-size: 0.95rem;
      }

      .section-header {
        flex-direction: column;
        align-items: flex-start;
        padding: 2rem 1.5rem;
        gap: 1.5rem;
      }

      .section-info h2 {
        font-size: 1.3rem;
      }

      .create-instance-btn {
        width: 100%;
        justify-content: center;
      }

      .instances-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .instance-card {
        padding: 1.75rem;
      }

      .instance-actions {
        grid-template-columns: 1fr !important;
      }
      
      .instance-actions button:last-child:nth-child(3) {
        grid-column: auto;
      }

      .webhook-card-info {
        grid-template-columns: 1fr;
      }

      .btn-action {
        width: 100%;
      }

      .btn-primary,
      .btn-secondary {
        width: 100%;
        justify-content: center;
        padding: 0.875rem 1.5rem;
      }

      .main-container {
        padding: 2rem 1.5rem;
      }

      .popup {
        padding: 2rem 1.5rem;
        margin: 1rem;
      }

      /* Webhook Form - Mobile */
      .webhook-form-wrapper {
        max-width: 100%;
      }

      /* Webhook Success Display - Mobile */
      .webhook-success-content {
        padding: 2rem 1.5rem;
      }

      #webhookFormContent {
        padding: 2.5rem 2rem !important;
      }

      .webhook-form-wrapper {
        max-width: 100%;
      }

      .webhook-success-title {
        font-size: 1.5rem;
      }

      .webhook-success-subtitle {
        font-size: 1rem;
      }

      .webhook-url-container {
        padding: 1.5rem;
      }

      .webhook-url-display {
        flex-direction: column;
        gap: 0.75rem;
      }

      .webhook-copy-btn {
        width: 100%;
        min-width: auto;
      }

      .create-another-webhook-btn {
        width: 100%;
      }
    }

    /* Utility classes */
    .text-center { text-align: center; }
    .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-base { font-size: 1rem; line-height: 1.5rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .text-white { color: #ffffff; }
    .text-gray-200 { color: rgba(255, 255, 255, 0.8); }
    .text-gray-300 { color: rgba(255, 255, 255, 0.6); }
    .text-black { color: #000000; }
    .bg-white { background-color: #ffffff; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .mb-10 { margin-bottom: 2.5rem; }
    .mt-3 { margin-top: 0.75rem; }
    .mt-8 { margin-top: 2rem; }
    .mt-10 { margin-top: 2.5rem; }
    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }
    .py-16 { padding-top: 4rem; padding-bottom: 4rem; }
    .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
    .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .space-y-6 > * + * { margin-top: 1.5rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-x-3 > * + * { margin-left: 0.75rem; }
    .space-x-4 > * + * { margin-left: 1rem; }
    .flex { display: flex; }
    .inline-flex { display: inline-flex; }
    .items-center { align-items: center; }
    .items-start { align-items: flex-start; }
    .justify-center { justify-content: center; }
    .grid { display: grid; }
    .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .gap-3 { gap: 0.75rem; }
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-2xl { border-radius: 1rem; }
    .rounded-full { border-radius: 9999px; }
    .w-6 { width: 1.5rem; height: 1.5rem; }
    .w-8 { width: 2rem; height: 2rem; }
    .w-10 { width: 2.5rem; height: 2.5rem; }
    .w-20 { width: 5rem; height: 5rem; }
    .w-64 { width: 16rem; height: 16rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .max-w-sm { max-width: 24rem; }
    .object-contain { object-fit: contain; }
    .tracking-wide { letter-spacing: 0.025em; }
    .flex-shrink-0 { flex-shrink: 0; }
    .hidden { display: none !important; }
    .relative { position: relative; }
    .absolute { position: absolute; }
    .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
    .overflow-hidden { overflow: hidden; }

    /* Webhook Form Wrapper */
    .webhook-form-wrapper {
      max-width: 750px;
      margin: 0 auto;
    }

    /* Webhook Card Styles - Design Moderno e Harmonioso */
    .webhook-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px rgba(165, 148, 255, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border-radius: 1.5rem;
      padding: 2rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.8s ease both;
    }

    .webhook-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(165, 148, 255, 0.3) 25%,
        rgba(165, 148, 255, 0.8) 50%,
        rgba(102, 126, 234, 0.8) 75%,
        transparent 100%
      );
      opacity: 0;
      transition: all 0.6s ease;
    }

    .webhook-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at 50% 0%,
        rgba(165, 148, 255, 0.03) 0%,
        transparent 60%
      );
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }

    .webhook-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(165, 148, 255, 0.25);
    }

    .webhook-card:hover::before {
      opacity: 1;
      height: 6px;
    }

    .webhook-card:hover::after {
      opacity: 1;
    }

    .webhook-card-header {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      position: relative;
    }

    .webhook-card-header::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 35%;
      height: 2px;
      background: linear-gradient(90deg, rgba(165, 148, 255, 0.5), transparent);
      border-radius: 2px;
    }

    .webhook-card-title {
      font-size: 1.4rem;
      font-weight: 800;
      background: linear-gradient(135deg, #ffffff 0%, rgba(165, 148, 255, 0.9) 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 15px rgba(165, 148, 255, 0.4);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1;
      line-height: 1.2;
    }

    .webhook-card-title svg {
      fill: rgba(165, 148, 255, 0.8);
      filter: drop-shadow(0 2px 8px rgba(165, 148, 255, 0.3));
    }

    .webhook-card-url {
      background: rgba(165, 148, 255, 0.15);
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      transition: all 0.3s ease;
    }

    .webhook-card-url:hover {
      background: rgba(165, 148, 255, 0.2);
      border-color: rgba(165, 148, 255, 0.5);
    }

    .webhook-url-text {
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      color: #A594FF;
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      flex: 1;
    }

    .webhook-copy-small-btn {
      background: linear-gradient(135deg, #A594FF, #764ba2);
      border: none;
      color: white;
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.85rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .webhook-copy-small-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(165, 148, 255, 0.4);
    }

    .webhook-copy-small-btn.copied {
      background: linear-gradient(135deg, #22c55e, #16a34a);
    }

    .webhook-deactivate-btn-icon {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: rgba(239, 68, 68, 0.9);
      border-radius: 0.375rem;
      padding: 0.375rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      flex-shrink: 0;
      margin-top: -0.25rem;
      margin-right: -0.25rem;
    }

    .webhook-deactivate-btn-icon:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
      color: rgba(239, 68, 68, 1);
      transform: scale(1.1);
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }

    .webhook-deactivate-btn-icon:active {
      transform: scale(0.95);
      background: rgba(239, 68, 68, 0.3);
    }

    .webhook-deactivate-btn-icon:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .webhook-deactivate-btn-icon svg {
      width: 14px;
      height: 14px;
      stroke-width: 2.5;
    }

    .webhook-edit-btn-icon {
      background: rgba(165, 148, 255, 0.1);
      border: 1px solid rgba(165, 148, 255, 0.3);
      color: rgba(165, 148, 255, 0.9);
      border-radius: 0.375rem;
      padding: 0.375rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      flex-shrink: 0;
      margin-top: -0.25rem;
      margin-right: 0.5rem;
    }

    .webhook-edit-btn-icon:hover {
      background: rgba(165, 148, 255, 0.2);
      border-color: rgba(165, 148, 255, 0.5);
      color: rgba(165, 148, 255, 1);
      transform: scale(1.1);
      box-shadow: 0 2px 8px rgba(165, 148, 255, 0.3);
    }

    .webhook-edit-btn-icon:active {
      transform: scale(0.95);
      background: rgba(165, 148, 255, 0.3);
    }

    .webhook-edit-btn-icon:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .webhook-edit-btn-icon svg {
      width: 14px;
      height: 14px;
      stroke-width: 2.5;
    }

    /* Popup de Confirmação */
    .confirm-popup {
      background: linear-gradient(135deg, rgba(34, 25, 88, 0.95), rgba(54, 44, 125, 0.95));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(239, 68, 68, 0.4);
      border-radius: 1.5rem;
      padding: 2.5rem;
      max-width: 440px;
      width: 100%;
      text-align: center;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .popup-overlay.show .confirm-popup {
      transform: scale(1);
    }

    .confirm-popup-icon {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      margin: 0 auto 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.2));
      border: 2px solid rgba(239, 68, 68, 0.4);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
    }

    .confirm-popup-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      justify-content: center;
    }

    .confirm-popup-btn {
      padding: 0.75rem 2rem;
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      flex: 1;
      max-width: 150px;
    }

    .confirm-popup-btn-cancel {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .confirm-popup-btn-cancel:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .confirm-popup-btn-confirm {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
    }

    .confirm-popup-btn-confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
    }

    /* Popup de Edição de Webhook */
    .edit-webhook-popup {
      background: linear-gradient(135deg, rgba(10, 4, 32, 0.95), rgba(20, 15, 50, 0.95));
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid rgba(165, 148, 255, 0.15);
      border-radius: 1rem;
      max-width: 480px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: 0 8px 32px rgba(165, 148, 255, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      position: relative;
      margin: 0 auto;
    }

    #editWebhookOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      z-index: 9999;
      padding: 2rem;
    }

    .popup-overlay.show .edit-webhook-popup {
      transform: scale(1);
    }

    .edit-webhook-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem 0.75rem;
      border-bottom: 1px solid rgba(165, 148, 255, 0.2);
    }

    .edit-webhook-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: white;
      margin: 0;
    }

    .edit-webhook-close {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.5rem;
      padding: 0.5rem;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .edit-webhook-close:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      transform: scale(1.1);
    }

    .edit-webhook-content {
      padding: 1rem 1.5rem 1.5rem;
    }

    .edit-webhook-content .form-group {
      margin-bottom: 1rem;
    }

    .edit-webhook-content .form-group label {
      display: block;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 600;
      margin-bottom: 0.375rem;
      font-size: 0.875rem;
    }

    .edit-webhook-content .form-input,
    .edit-webhook-content .form-select {
      width: 100%;
      padding: 0.75rem 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 0.5rem;
      color: #ffffff;
      font-size: 0.875rem;
      font-weight: 500;
      outline: none;
      transition: all 0.3s ease;
      box-shadow: none;
      font-family: 'Raleway', sans-serif;
    }

    .edit-webhook-content .form-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .edit-webhook-content .form-input:hover,
    .edit-webhook-content .form-select:hover {
      border-color: rgba(165, 148, 255, 0.5);
      background: rgba(255, 255, 255, 0.08);
    }

    .edit-webhook-content .form-input:focus,
    .edit-webhook-content .form-select:focus {
      border-color: #A594FF;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2);
    }

    .edit-webhook-content .form-select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23A594FF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 16px;
      padding-right: 2.5rem;
      cursor: pointer;
    }

    .edit-webhook-content .form-select option {
      background: #1a1333;
      color: #ffffff;
      padding: 0.5rem;
      font-weight: 500;
    }

    .edit-webhook-content .form-select option:checked {
      background: #A594FF;
      color: #ffffff;
    }

    .edit-webhook-buttons {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.25rem;
      justify-content: center;
    }

    .edit-webhook-btn-cancel,
    .edit-webhook-btn-confirm {
      padding: 0.625rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .edit-webhook-btn-cancel {
      background: rgba(255, 255, 255, 0.08);
      color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.15);
      font-family: 'Raleway', sans-serif;
    }

    .edit-webhook-btn-cancel:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .edit-webhook-btn-confirm {
      background: linear-gradient(135deg, #A594FF, #764ba2);
      color: white;
      box-shadow: 0 4px 20px rgba(165, 148, 255, 0.5);
      border: 1px solid rgba(165, 148, 255, 0.3);
      font-family: 'Raleway', sans-serif;
      position: relative;
      overflow: hidden;
    }

    .edit-webhook-btn-confirm::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .edit-webhook-btn-confirm:hover::before {
      transform: translateX(100%);
    }

    .edit-webhook-btn-confirm:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 35px rgba(165, 148, 255, 0.7);
    }

    .edit-webhook-btn-confirm:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .edit-webhook-spinner {
      width: 16px;
      height: 16px;
    }

    .webhook-card-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      column-gap: 1.5rem;
    }

    .webhook-info-row {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .webhook-info-icon {
      width: 20px;
      height: 20px;
      color: #A594FF;
      flex-shrink: 0;
      margin-top: 0.125rem;
    }

    .webhook-info-content {
      flex: 1;
    }

    .webhook-info-label {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 0.25rem;
      font-weight: 500;
    }

    .webhook-info-value {
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 600;
    }

    .webhook-badge {
      display: inline-block;
      padding: 0.375rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.85rem;
      font-weight: 600;
      background: rgba(165, 148, 255, 0.2);
      border: 1px solid rgba(165, 148, 255, 0.4);
      color: #A594FF;
    }

    .webhook-date {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Webhook Success Display Styles */
    .webhook-success-container {
      margin-bottom: 2.5rem;
      animation: fadeInUp 0.6s ease;
    }

    .webhook-success-content {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 2px solid rgba(34, 197, 94, 0.4);
      border-radius: 1.5rem;
      padding: 2.5rem 2rem;
      text-align: center;
      box-shadow: 0 8px 32px rgba(34, 197, 94, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }

    .webhook-success-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, #22c55e, transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .webhook-success-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 1.5rem;
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: scaleIn 0.5s ease;
      box-shadow: 0 0 30px rgba(34, 197, 94, 0.3);
    }

    .webhook-success-icon svg {
      stroke: #22c55e;
      animation: checkmark 0.6s ease 0.3s both;
    }

    @keyframes scaleIn {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes checkmark {
      0% {
        stroke-dasharray: 100;
        stroke-dashoffset: 100;
      }
      100% {
        stroke-dasharray: 100;
        stroke-dashoffset: 0;
      }
    }

    .webhook-success-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.75rem;
      text-shadow: 0 2px 15px rgba(34, 197, 94, 0.4);
    }

    .webhook-success-subtitle {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 2rem;
      font-weight: 500;
    }

    .webhook-url-container {
      background: rgba(10, 5, 30, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1.25rem;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .webhook-url-label {
      display: block;
      font-size: 0.95rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 1rem;
      text-align: left;
    }

    .webhook-url-display {
      display: flex;
      gap: 0.75rem;
      align-items: stretch;
    }

    .webhook-url-input {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(165, 148, 255, 0.3);
      border-radius: 0.875rem;
      padding: 1rem 1.25rem;
      color: #ffffff;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      outline: none;
    }

    .webhook-url-input:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(165, 148, 255, 0.5);
    }

    .webhook-url-input:focus {
      background: rgba(255, 255, 255, 0.1);
      border-color: #A594FF;
      box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2);
    }

    .webhook-copy-btn {
      background: linear-gradient(135deg, #A594FF, #764ba2);
      border: 2px solid rgba(165, 148, 255, 0.4);
      color: white;
      border-radius: 0.875rem;
      padding: 0 1.5rem;
      font-family: 'Raleway', sans-serif;
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 120px;
      justify-content: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(165, 148, 255, 0.4);
    }

    .webhook-copy-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .webhook-copy-btn:hover::before {
      transform: translateX(100%);
    }

    .webhook-copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(165, 148, 255, 0.6);
    }

    .webhook-copy-btn:active {
      transform: translateY(0);
    }

    .webhook-copy-btn.copied {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-color: rgba(34, 197, 94, 0.4);
    }

    .webhook-copy-btn svg {
      transition: all 0.3s ease;
    }

    .webhook-url-hint {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 1rem;
      text-align: left;
      line-height: 1.5;
    }

    .create-another-webhook-btn {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      border: 2px solid rgba(165, 148, 255, 0.4);
      color: white;
      border-radius: 1rem;
      padding: 1rem 2rem;
      font-family: 'Raleway', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      gap: 0.625rem;
      margin-top: 1rem;
    }

    .create-another-webhook-btn:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.06));
      border-color: rgba(165, 148, 255, 0.6);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(165, 148, 255, 0.3);
    }

    .create-another-webhook-btn svg {
      transition: transform 0.3s ease;
    }

    .create-another-webhook-btn:hover svg {
      transform: rotate(90deg);
    }

    /* ============================================
       POPUP DE LOGS STYLES
       ============================================ */

    .logs-popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      padding: 2rem;
    }

    .logs-popup-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .logs-popup {
      background: linear-gradient(135deg, rgba(20, 15, 50, 0.98), rgba(30, 20, 60, 0.98));
      backdrop-filter: blur(30px);
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 1.5rem;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6);
    }

    .logs-popup-overlay.show .logs-popup {
      transform: scale(1);
    }

    .logs-popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2rem 2.5rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logs-popup-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin: 0;
    }

    .logs-popup-close {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.5rem;
      padding: 0.5rem;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .logs-popup-close:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      transform: scale(1.1);
    }

    .logs-popup-content {
      padding: 1.5rem 2.5rem 2.5rem;
      max-height: 70vh;
      overflow-y: auto;
    }

    .logs-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .logs-stat-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.06));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(165, 148, 255, 0.2);
      border-radius: 1.25rem;
      padding: 2rem 1.5rem;
      text-align: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      cursor: default;
    }

    .logs-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, #A594FF, #667eea, transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .logs-stat-card:hover {
      transform: translateY(-4px) scale(1.02);
      border-color: rgba(165, 148, 255, 0.4);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
      box-shadow: 0 12px 40px rgba(165, 148, 255, 0.25);
    }

    .logs-stat-card:hover::before {
      opacity: 1;
    }

    .logs-stat-number {
      font-size: 2.25rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ffffff 0%, rgba(165, 148, 255, 0.9) 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 8px rgba(165, 148, 255, 0.2);
      transition: all 0.3s ease;
    }

    .logs-stat-card:hover .logs-stat-number {
      background: linear-gradient(135deg, #A594FF 0%, #ffffff 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 4px 15px rgba(165, 148, 255, 0.4);
    }

    .logs-stat-label {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
      line-height: 1.3;
    }

    .logs-stat-card:hover .logs-stat-label {
      color: rgba(255, 255, 255, 0.95);
    }

    /* Ícones removidos para design mais limpo e visual */

    /* Filtros e Pesquisa */
    .logs-filters {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .logs-search-container {
      position: relative;
      flex: 1;
      min-width: 250px;
    }

    .logs-search-input {
      width: 100%;
      padding: 0.875rem 1rem 0.875rem 3rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 1rem;
      color: #ffffff;
      font-size: 0.9rem;
      font-weight: 500;
      outline: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .logs-search-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .logs-search-input:focus {
      border-color: #A594FF;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2);
    }

    .logs-search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(165, 148, 255, 0.6);
      transition: all 0.3s ease;
    }

    .logs-search-input:focus + .logs-search-icon {
      color: #A594FF;
    }

    .logs-filter-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .logs-filter-btn {
      padding: 0.6rem 1.2rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.75rem;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .logs-filter-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(165, 148, 255, 0.3);
      color: rgba(255, 255, 255, 0.9);
    }

    .logs-filter-btn.active {
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.2), rgba(102, 126, 234, 0.1));
      border-color: rgba(165, 148, 255, 0.5);
      color: #A594FF;
      box-shadow: 0 2px 10px rgba(165, 148, 255, 0.2);
    }

    .logs-table {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 1.5rem;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(165, 148, 255, 0.15);
    }

    .logs-table-header {
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.2), rgba(102, 126, 234, 0.1));
      padding: 1.25rem 2rem;
      font-weight: 700;
      color: #ffffff;
      border-bottom: 1px solid rgba(165, 148, 255, 0.3);
      backdrop-filter: blur(15px);
    }

    .logs-table-body {
      max-height: 450px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(165, 148, 255, 0.3) transparent;
    }

    .logs-table-body::-webkit-scrollbar {
      width: 8px;
    }

    .logs-table-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .logs-table-body::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(165, 148, 255, 0.5), rgba(102, 126, 234, 0.3));
      border-radius: 4px;
    }

    .logs-table-body::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, rgba(165, 148, 255, 0.7), rgba(102, 126, 234, 0.5));
    }

    .logs-table-row {
      display: grid;
      grid-template-columns: 160px 130px 1fr 140px;
      gap: 1.5rem;
      padding: 1.25rem 2rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      cursor: pointer;
    }

    .logs-table-row::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 3px;
      height: 100%;
      background: linear-gradient(180deg, #A594FF, #667eea);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .logs-table-row:hover {
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.1), rgba(102, 126, 234, 0.05));
      transform: translateX(8px);
      box-shadow: 0 4px 20px rgba(165, 148, 255, 0.2);
    }

    .logs-table-row:hover::before {
      opacity: 1;
    }

    .logs-table-cell {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .logs-status {
      padding: 0.25rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.8rem;
      font-weight: 600;
      text-align: center;
    }

    .logs-status-success {
      background: rgba(34, 197, 94, 0.2);
      color: #22C55E;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .logs-status-error {
      background: rgba(239, 68, 68, 0.2);
      color: #EF4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .logs-empty {
      text-align: center;
      padding: 3rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .logs-empty svg {
      margin-bottom: 1rem;
      opacity: 0.5;
    }


    /* ============================================
       VARIABLES SIDE PANEL STYLES
       ============================================ */

    .variables-side-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      z-index: 10000;
      pointer-events: none;
      transition: opacity 0.3s ease;
      opacity: 0;
    }

    .variables-side-panel.active {
      opacity: 1;
      pointer-events: all;
    }

    .variables-panel-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      cursor: pointer;
    }

    .variables-panel-content {
      position: absolute;
      top: 0;
      right: 0;
      width: 600px;
      max-width: 90vw;
      height: 100%;
      background: linear-gradient(135deg, rgba(20, 15, 50, 0.98), rgba(30, 20, 60, 0.98));
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-left: 2px solid rgba(165, 148, 255, 0.3);
      box-shadow: -10px 0 50px rgba(0, 0, 0, 0.5);
      transform: translateX(100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .variables-side-panel.active .variables-panel-content {
      transform: translateX(0);
    }

    .variables-panel-header {
      padding: 2rem 2rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.1), transparent);
    }

    .variables-panel-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: #ffffff;
      margin-bottom: 0.25rem;
      background: linear-gradient(135deg, #ffffff, #A594FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .variables-panel-subtitle {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 400;
    }

    .variables-close-btn {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 0.75rem;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
      color: rgba(255, 255, 255, 0.7);
    }

    .variables-close-btn:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(165, 148, 255, 0.5);
      color: #ffffff;
      transform: rotate(90deg);
    }

    .variables-panel-body {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
      scrollbar-width: thin;
      scrollbar-color: rgba(165, 148, 255, 0.3) transparent;
    }

    .variables-panel-body::-webkit-scrollbar {
      width: 8px;
    }

    .variables-panel-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .variables-panel-body::-webkit-scrollbar-thumb {
      background: rgba(165, 148, 255, 0.3);
      border-radius: 4px;
    }

    .variables-panel-body::-webkit-scrollbar-thumb:hover {
      background: rgba(165, 148, 255, 0.5);
    }

    /* Info Card */
    .variables-info-card {
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.15), rgba(102, 126, 234, 0.1));
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 1rem;
      padding: 1.25rem;
      margin-bottom: 2rem;
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }

    .variables-info-icon {
      font-size: 2rem;
      flex-shrink: 0;
    }

    .variables-info-card code {
      background: rgba(165, 148, 255, 0.2);
      padding: 0.15rem 0.5rem;
      border-radius: 0.35rem;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9em;
      color: #A594FF;
      border: 1px solid rgba(165, 148, 255, 0.3);
    }

    /* Create Section */
    .variables-create-section {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1.25rem;
      padding: 1.75rem;
      margin-bottom: 2rem;
    }

    .variables-section-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
    }

    .variables-count {
      background: linear-gradient(135deg, #A594FF, #764ba2);
      color: white;
      padding: 0.15rem 0.6rem;
      border-radius: 1rem;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 0.75rem;
    }

    /* Form Styles */
    .variables-form {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }

    .form-label {
      font-size: 0.95rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 0.75rem;
    }

    .form-input {
      width: 100%;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 0.75rem;
      color: #ffffff;
      font-size: 0.95rem;
      font-family: 'Raleway', sans-serif;
      outline: none;
      transition: all 0.3s ease;
      box-shadow: none;
    }

    .form-input:hover {
      border-color: rgba(165, 148, 255, 0.5);
      background: rgba(255, 255, 255, 0.08);
    }

    .form-input:focus {
      border-color: #A594FF;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2);
      outline: none;
    }

    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    /* Estilo especial para select.form-input */
    select.form-input {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23A594FF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 18px;
      padding-right: 3rem;
      cursor: pointer;
    }

    select.form-input option {
      background: #1a1333;
      color: #ffffff;
      padding: 0.5rem;
      font-weight: 500;
    }

    select.form-input option:checked {
      background: #A594FF;
      color: #ffffff;
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
      font-family: 'Raleway', sans-serif;
      line-height: 1.6;
    }

    .form-hint {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.55);
      margin-top: 0.5rem;
      line-height: 1.4;
    }

    /* Variable Input Wrapper */
    .variable-input-wrapper {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 0.75rem;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .variable-input-wrapper:focus-within {
      border-color: #A594FF;
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.1);
    }

    .variable-prefix,
    .variable-suffix {
      padding: 0.875rem 0.75rem;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1.1rem;
      font-weight: 700;
      color: #A594FF;
      background: rgba(165, 148, 255, 0.1);
      flex-shrink: 0;
    }

    .variable-name-input {
      border: none !important;
      background: transparent !important;
      box-shadow: none !important;
      padding: 0.875rem 0.5rem !important;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1rem;
      flex: 1;
    }

    .variable-name-input:focus {
      outline: none;
    }

    /* Create Button */
    .btn-create-variable {
      background: linear-gradient(135deg, #A594FF, #764ba2);
      color: white;
      border: none;
      padding: 1rem 1.5rem;
      border-radius: 0.875rem;
      font-family: 'Raleway', sans-serif;
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(165, 148, 255, 0.4);
      position: relative;
      overflow: hidden;
    }

    .btn-create-variable::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .btn-create-variable:hover::before {
      transform: translateX(100%);
    }

    .btn-create-variable:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(165, 148, 255, 0.6);
    }

    .btn-create-variable:active {
      transform: translateY(0);
    }

    /* Variables List Section */
    .variables-list-section {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 1.25rem;
      padding: 1.75rem;
    }

    .variables-empty-state {
      text-align: center;
      padding: 3rem 2rem;
    }

    /* Variables Grid */
    .variables-grid {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .variable-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 1rem;
      padding: 1.25rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .variable-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #A594FF, transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .variable-card:hover {
      border-color: rgba(165, 148, 255, 0.4);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      transform: translateX(4px);
    }

    .variable-card:hover::before {
      opacity: 1;
    }

    .variable-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .variable-tag {
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 1.05rem;
      font-weight: 700;
      color: #A594FF;
      background: rgba(165, 148, 255, 0.15);
      padding: 0.4rem 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(165, 148, 255, 0.3);
      flex: 1;
    }

    .variable-actions {
      display: flex;
      gap: 0.5rem;
    }

    .variable-action-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.5rem;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: rgba(255, 255, 255, 0.6);
    }

    .variable-action-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(165, 148, 255, 0.4);
      color: #A594FF;
    }

    .variable-action-btn.delete:hover {
      background: rgba(239, 68, 68, 0.15);
      border-color: rgba(239, 68, 68, 0.4);
      color: #EF4444;
    }

    .variable-description {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      line-height: 1.5;
      margin-bottom: 0.75rem;
    }

    .variable-example {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.5);
      font-style: italic;
      padding: 0.5rem 0.75rem;
      background: rgba(255, 255, 255, 0.03);
      border-left: 2px solid rgba(165, 148, 255, 0.3);
      border-radius: 0.25rem;
    }

    /* First Contact Configuration Styles */
    .first-contact-section {
      margin-top: 1.5rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(165, 148, 255, 0.06), rgba(102, 126, 234, 0.04));
      border: 1px solid rgba(165, 148, 255, 0.25);
      border-radius: 1rem;
      animation: fadeInUp 0.4s ease;
    }

    .first-contact-header {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      margin-bottom: 1.25rem;
    }

    .first-contact-header svg {
      width: 20px;
      height: 20px;
      color: #A594FF;
    }

    .first-contact-title {
      font-size: 1rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.95);
    }

    .first-contact-badge {
      background: rgba(34, 197, 94, 0.2);
      color: #22C55E;
      padding: 0.15rem 0.5rem;
      border-radius: 0.35rem;
      font-size: 0.7rem;
      font-weight: 700;
      margin-left: auto;
    }

    .delay-control {
      margin-bottom: 1.25rem;
    }

    .delay-label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.85);
      margin-bottom: 0.75rem;
    }

    .delay-slider-wrapper {
      background: rgba(165, 148, 255, 0.08);
      border: 1px solid rgba(165, 148, 255, 0.2);
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
    }

    .delay-slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: linear-gradient(to right,
          rgba(165, 148, 255, 0.2) 0%,
          rgba(165, 148, 255, 0.15) 50%,
          rgba(165, 148, 255, 0.25) 100%);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      margin-bottom: 0.75rem;
    }

    .delay-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(135deg, #A594FF, #764ba2);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(165, 148, 255, 0.4);
      transition: all 0.3s ease;
    }

    .delay-slider::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 16px rgba(165, 148, 255, 0.6);
    }

    .delay-slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(135deg, #A594FF, #764ba2);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(165, 148, 255, 0.4);
      transition: all 0.3s ease;
      border: none;
    }

    .delay-slider::-moz-range-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 16px rgba(165, 148, 255, 0.6);
    }

    .delay-display {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      color: #A594FF;
    }

    .delay-hint {
      text-align: center;
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 0.5rem;
      line-height: 1.4;
    }

    /* Time Input Styles */
    .time-input {
      width: 100%;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(165, 148, 255, 0.3);
      border-radius: 0.75rem;
      color: rgba(255, 255, 255, 0.95);
      font-size: 0.95rem;
      font-weight: 500;
      font-family: 'Raleway', sans-serif;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .time-input:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(165, 148, 255, 0.5);
    }

    .time-input:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.1);
      border-color: #A594FF;
      box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2);
    }

    .time-input::-webkit-calendar-picker-indicator {
      filter: invert(1);
      opacity: 0.7;
      cursor: pointer;
    }

    .time-input::-webkit-calendar-picker-indicator:hover {
      opacity: 1;
    }

    .time-input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .time-input:disabled::-webkit-calendar-picker-indicator {
      cursor: not-allowed;
      opacity: 0.3;
    }

    /* 24h Checkbox Styles */
    .checkbox-24h-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(165, 148, 255, 0.2);
    }

    .checkbox-24h-label:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(165, 148, 255, 0.4);
    }

    .checkbox-24h-input {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(165, 148, 255, 0.5);
      border-radius: 0.25rem;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.05);
    }

    .checkbox-24h-input:checked {
      background: linear-gradient(135deg, #A594FF, #764ba2);
      border-color: #A594FF;
    }

    .checkbox-24h-input:checked::after {
      content: '';
      position: absolute;
      left: 5px;
      top: 2px;
      width: 4px;
      height: 8px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .checkbox-24h-input:hover {
      border-color: #A594FF;
    }

    .checkbox-24h-text {
      font-size: 0.875rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      user-select: none;
    }

    .checkbox-24h-input:checked ~ .checkbox-24h-text {
      color: #A594FF;
    }

    /* Variables Accordion Styles */
    .variables-accordion-header:hover {
      background: rgba(165, 148, 255, 0.12) !important;
      box-shadow: 0 2px 8px rgba(165, 148, 255, 0.2);
    }

    .variables-accordion-header:active {
      transform: scale(0.99);
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      .variables-panel-content {
        width: 100%;
        max-width: 100%;
      }

      .variables-panel-header {
        padding: 1.5rem 1.25rem 1.25rem;
      }

      .variables-panel-body {
        padding: 1.5rem 1.25rem;
      }

      .variables-panel-title {
        font-size: 1.25rem;
      }

      .variables-create-section,
      .variables-list-section {
        padding: 1.25rem;
      }

      .first-contact-section [style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>
  <!-- Popup Overlay -->
  <div id="popupOverlay" class="popup-overlay">
    <div id="popup" class="popup">
      <div id="popupIcon" class="popup-icon">
        <svg id="popupSvg" class="w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path id="popupPath" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d=""></path>
        </svg>
      </div>
      <h3 id="popupTitle" class="text-xl font-bold text-white mb-2"></h3>
      <p id="popupMessage" class="text-gray-200 mb-6"></p>
      <button id="popupButton" onclick="closePopup()" class="btn-primary px-6 py-2 rounded-xl font-semibold">
        OK
      </button>
    </div>
  </div>

  <!-- Popup de Confirmação de Desativação -->
  <div id="confirmPopupOverlay" class="popup-overlay">
    <div class="confirm-popup">
      <div class="confirm-popup-icon">
        <svg class="w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
      </div>
      <h3 class="text-xl font-bold text-white mb-2">Desativar Webhook</h3>
      <p id="confirmPopupMessage" class="text-gray-200 mb-6">
        Tem certeza que deseja desativar este webhook?<br>
        <span style="color: rgba(165, 148, 255, 0.8); font-size: 0.9rem;">Esta ação pode ser revertida posteriormente.</span>
      </p>
      <div class="confirm-popup-buttons">
        <button id="confirmCancelBtn" class="confirm-popup-btn confirm-popup-btn-cancel">
          Cancelar
        </button>
        <button id="confirmConfirmBtn" class="confirm-popup-btn confirm-popup-btn-confirm">
          Desativar
        </button>
      </div>
    </div>
  </div>

  <!-- Popup de Edição de Webhook -->
  <div id="editWebhookOverlay" class="popup-overlay" style="display: none;">
    <div class="edit-webhook-popup">
      <div class="edit-webhook-header">
        <h3 class="edit-webhook-title">Editar Webhook</h3>
        <button class="edit-webhook-close" onclick="closeEditWebhook()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="edit-webhook-content">
        <form id="editWebhookForm">
          <!-- Nome do Webhook -->
          <div class="form-group">
            <label for="editWebhookName">Nome do Webhook</label>
            <input type="text" id="editWebhookName" class="form-input" required>
          </div>

          <!-- Assistente -->
          <div class="form-group">
            <label for="editAssistantSelect">Assistente</label>
            <select id="editAssistantSelect" class="form-select" required>
              <option value="">Carregando assistentes...</option>
            </select>
          </div>

          <!-- Número -->
          <div class="form-group">
            <label for="editNumberSelect">Número WhatsApp</label>
            <select id="editNumberSelect" class="form-select" required>
              <option value="">Carregando números...</option>
            </select>
          </div>

          <!-- Follow-up -->
          <div class="form-group">
            <label for="editFollowUpSelect">Follow-up (opcional)</label>
            <select id="editFollowUpSelect" class="form-select">
              <option value="">Nenhum follow up</option>
            </select>
          </div>

          <!-- Tempo de Resposta Inicial -->
          <div id="editContactDelayGroup" class="form-group">
            <label for="editContactDelay">Tempo de Resposta Inicial (minutos)</label>
            <input type="number" id="editContactDelay" class="form-input" min="1" value="5">
          </div>

          <!-- Instância -->
          <div class="form-group">
            <label for="editInstanceSelect">Instância WhatsApp</label>
            <select id="editInstanceSelect" class="form-select" required>
              <option value="">Carregando instâncias...</option>
            </select>
          </div>

          <!-- Horário de Atendimento -->
          <div class="form-group">
            <label for="editWorkingHours">Horário de Atendimento</label>
            <select id="editWorkingHours" class="form-select">
              <option value="00:00-23:59">24 horas</option>
              <option value="08:00-18:00">08:00 - 18:00</option>
              <option value="09:00-17:00">09:00 - 17:00</option>
              <option value="08:00-17:00">08:00 - 17:00</option>
              <option value="09:00-18:00">09:00 - 18:00</option>
              <option value="10:00-19:00">10:00 - 19:00</option>
            </select>
          </div>

          <!-- Botões -->
          <div class="edit-webhook-buttons">
            <button type="button" class="edit-webhook-btn-cancel" onclick="closeEditWebhook()">
              Cancelar
            </button>
            <button type="submit" class="edit-webhook-btn-confirm">
              <svg class="w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <div class="spinner edit-webhook-spinner" style="display: none;"></div>
              <span class="edit-webhook-btn-text">Salvar Alteração</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Popup de Logs do Webhook -->
  <div id="logsPopupOverlay" class="logs-popup-overlay">
    <div class="logs-popup">
      <div class="logs-popup-header">
        <h3 class="logs-popup-title">Dashboard de Logs</h3>
        <button class="logs-popup-close" onclick="closeLogsPopup()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="logs-popup-content">
        <div class="logs-stats">
          <div class="logs-stat-card">
            <div class="logs-stat-number" id="totalLeads">0</div>
            <div class="logs-stat-label">Total de Leads</div>
          </div>
          <div class="logs-stat-card">
            <div class="logs-stat-number" id="successfulLeads">0</div>
            <div class="logs-stat-label">Total de Interações</div>
          </div>
          <div class="logs-stat-card" style="display: none;">
            <div class="logs-stat-number" id="failedLeads">0</div>
            <div class="logs-stat-label">Total de Falhas</div>
          </div>
        </div>

        <!-- Barra de Pesquisa e Filtros -->
        <div class="logs-filters">
          <div class="logs-search-container">
            <input type="text" id="logsSearchInput" placeholder="Buscar nos logs..." class="logs-search-input">
            <svg class="logs-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </div>
          <div class="logs-filter-buttons">
            <button class="logs-filter-btn active" data-filter="all">Todos</button>
            <button class="logs-filter-btn" data-filter="success">Sucessos</button>
            <button class="logs-filter-btn" data-filter="error" style="display: none;">Erros</button>
          </div>
        </div>

        <div class="logs-table">
          <div class="logs-table-header">
            <div style="display: grid; grid-template-columns: 150px 120px 1fr 120px; gap: 1rem;">
              <span>Data/Hora</span>
              <span>Status</span>
              <span>Dados do Lead</span>
              <span>Ação</span>
            </div>
          </div>
          <div class="logs-table-body" id="logsTableBody">
            <!-- Logs serão renderizados aqui via JavaScript -->
          </div>
        </div>

        <div id="logsEmpty" class="logs-empty" style="display: none;">
          <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <h3>Nenhum log encontrado</h3>
          <p>Este webhook ainda não recebeu nenhum lead.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ETAPA 1 - Gerenciar Instâncias -->
  <div id="page-main" class="page active">
    <div class="container fade-in">
      <!-- Header -->
      <div class="header">
        <h1 class="title">Gerenciar Webhooks</h1>
        <p class="subtitle">Configure webhooks para receber leads e conectar com seus assistentes</p>
      </div>

      <!-- Webhook Content -->
        <div class="section-header">
          <div class="section-info">
            <h2>Meus Webhooks</h2>
            <p>Configure webhooks para receber leads e conectar com seus assistentes</p>
          </div>

          <button onclick="showWebhookForm()" class="create-instance-btn">
            <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <span>Novo Webhook</span>
          </button>
        </div>

        <!-- Webhook Form (Initially Hidden) -->
        <div id="webhookForm" class="webhook-form-wrapper" style="display: none;">

          <!-- Webhook Success Display (Initially Hidden) -->
          <div id="webhookSuccessDisplay" class="webhook-success-container" style="display: none;">
            <div class="webhook-success-content">
              <div class="webhook-success-icon">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>

              <h3 class="webhook-success-title">Webhook Criado com Sucesso!</h3>
              <p class="webhook-success-subtitle" id="webhookSuccessName"></p>

              <div class="webhook-url-container">
                <label class="webhook-url-label">Sua URL de Webhook</label>
                <div class="webhook-url-display">
                  <input
                    type="text"
                    id="webhookUrlDisplay"
                    readonly
                    class="webhook-url-input"
                  />
                  <button
                    type="button"
                    id="copyWebhookBtn"
                    class="webhook-copy-btn"
                    onclick="copyWebhookUrl()"
                  >
                    <svg class="copy-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke-width="2"></rect>
                      <path stroke-width="2" d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                    <svg class="check-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="display: none;">
                      <polyline points="20 6 9 17 4 12" stroke-width="2"></polyline>
                    </svg>
                    <span class="copy-text">Copiar</span>
                  </button>
                </div>
                <p class="webhook-url-hint">Utilize esta URL em suas landing pages, formulários ou integrações</p>
              </div>

              <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button
                  type="button"
                  onclick="hideWebhookForm()"
                  class="create-another-webhook-btn"
                  style="flex: 1; min-width: 200px;"
                >
                  <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                  </svg>
                  <span>Voltar e Visualizar</span>
                </button>

                <button
                  type="button"
                  onclick="createAnotherWebhook()"
                  class="create-another-webhook-btn"
                  style="flex: 1; min-width: 200px;"
                >
                  <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                  <span>Criar Outro Webhook</span>
                </button>
              </div>
            </div>
          </div>

          <div class="glass-effect" id="webhookFormContent" style="padding: 3rem 3.5rem; animation: fadeInUp 0.6s ease;">
            <h3 style="font-size: 1.75rem; font-weight: 700; color: #ffffff; margin-bottom: 2.5rem; text-align: center;">
              Criar Novo Webhook
            </h3>

            <form id="createWebhookForm" class="space-y-6">
              <!-- Nome do Webhook -->
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: rgba(255, 255, 255, 0.9); font-size: 0.95rem;">
                  Nome do Webhook *
                </label>
                <input
                  type="text"
                  id="webhookName"
                  placeholder="Ex: Webhook Landing Page"
                  class="input-focus"
                  required
                />
              </div>

              <!-- Follow-up -->
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: rgba(255, 255, 255, 0.95); font-size: 0.95rem;">
                  Follow-up (Inbound) *
                </label>
                <select
                  id="webhookFollowup"
                  class="input-focus"
                  required
                >
                  <option value="">Carregando follow-ups...</option>
                </select>
                <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.55); margin-top: 0.5rem; line-height: 1.5;">
                  Follow-up que será executado quando o webhook receber um lead
                </p>

                <!-- First Contact Configuration Section -->
                <div id="firstContactSection" class="first-contact-section">
                  <div class="first-contact-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span class="first-contact-title">Tempo de Espera - Primeiro Contato</span>
                  </div>

                  <!-- Delay Control -->
                  <div class="delay-control" style="margin-bottom: 1.25rem;">
                    <label class="delay-label">
                      Aguardar antes de iniciar o primeiro contato
                    </label>
                    <div class="delay-slider-wrapper">
                      <input
                        type="range"
                        id="firstContactDelay"
                        class="delay-slider"
                        min="1"
                        max="20"
                        value="2"
                        oninput="updateFirstContactDelay(this.value)"
                      >
                      <div class="delay-display">
                        <span id="firstContactDelayValue">2</span> minutos
                      </div>
                      <div class="delay-hint">Recomendado: 1-3 minutos para melhor taxa de resposta</div>
                    </div>
                  </div>

                  <!-- Horário de Atendimento -->
                  <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                      <label class="delay-label" style="margin-bottom: 0;">
                        Horário de atendimento
                      </label>
                      <label class="checkbox-24h-label">
                        <input
                          type="checkbox"
                          id="is24Hours"
                          class="checkbox-24h-input"
                          onchange="toggle24Hours(this.checked)"
                        >
                        <span class="checkbox-24h-text">24h</span>
                      </label>
                    </div>
                    <div id="timeInputsContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                      <div>
                        <label style="display: block; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.5rem;">
                          Início
                        </label>
                        <input
                          type="time"
                          id="workingHoursStart"
                          class="time-input"
                          value="08:00"
                          required
                        >
                      </div>
                      <div>
                        <label style="display: block; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.5rem;">
                          Fim
                        </label>
                        <input
                          type="time"
                          id="workingHoursEnd"
                          class="time-input"
                          value="22:00"
                          required
                        >
                      </div>
                    </div>
                    <div class="delay-hint" style="margin-top: 0.5rem;">
                      Leads recebidos fora desse horário serão contactados no próximo dia útil
                    </div>
                  </div>
                </div>
              </div>

              <!-- Assistente -->
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: rgba(255, 255, 255, 0.95); font-size: 0.95rem;">
                  Assistente *
                </label>
                <select
                  id="webhookAssistant"
                  class="input-focus"
                  required
                >
                  <option value="">Carregando assistentes...</option>
                </select>
                <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.55); margin-top: 0.5rem; line-height: 1.5;">
                  Assistente de IA que conduzirá as conversas
                </p>
              </div>

              <!-- Número -->
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: rgba(255, 255, 255, 0.95); font-size: 0.95rem;">
                  Número de Telefone *
                </label>
                <select
                  id="webhookPhone"
                  class="input-focus"
                  required
                >
                  <option value="">Carregando números...</option>
                </select>
                <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.55); margin-top: 0.5rem; line-height: 1.5;">
                  Número de telefone que será usado nas conversas
                </p>
              </div>

              <!-- Instância -->
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: rgba(255, 255, 255, 0.95); font-size: 0.95rem;">
                  Instância *
                </label>
                <select
                  id="webhookInstance"
                  class="input-focus"
                  required
                >
                  <option value="">Carregando instâncias...</option>
                </select>
                <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.55); margin-top: 0.5rem; line-height: 1.5;">
                  Instância conectada que será utilizada
                </p>
              </div>

              <!-- Campos Variáveis -->
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: rgba(255, 255, 255, 0.9); font-size: 0.95rem;">
                  Campos Variáveis Personalizados
                  <span style="background: rgba(165, 148, 255, 0.2); color: #A594FF; padding: 0.15rem 0.5rem; border-radius: 0.35rem; font-size: 0.75rem; margin-left: 0.5rem; font-weight: 700;">NOVO</span>
                </label>

                <div style="background: linear-gradient(135deg, rgba(165, 148, 255, 0.08), rgba(102, 126, 234, 0.05)); border: 1px solid rgba(165, 148, 255, 0.25); border-radius: 1rem; padding: 1.25rem;">
                  <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1rem;">
                    <div style="flex-shrink: 0;">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#A594FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <circle cx="12" cy="12" r="3"></circle>
                      </svg>
                    </div>
                    <div style="flex: 1;">
                      <h4 style="font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem; color: #ffffff;">Personalize suas conversas</h4>
                      <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); line-height: 1.5; margin-bottom: 1rem;">
                        Crie variáveis como <code style="background: rgba(165, 148, 255, 0.2); padding: 0.15rem 0.5rem; border-radius: 0.35rem; font-family: 'SF Mono', 'Monaco', monospace; font-size: 0.9em; color: #A594FF; border: 1px solid rgba(165, 148, 255, 0.3);">{{nome}}</code> para que a IA personalize automaticamente cada conversa com informações do lead.
                      </p>

                      <!-- Variables List Preview (if any) -->
                      <div id="webhookVariablesPreview" style="display: none; margin-bottom: 1rem;">
                        <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">
                          Variáveis configuradas:
                        </div>
                        <div id="webhookVariablesTags" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                          <!-- Variables tags will appear here -->
                        </div>
                      </div>

                      <button
                        type="button"
                        onclick="openVariablesPanel()"
                        style="background: linear-gradient(135deg, #A594FF, #764ba2); color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 0.75rem; font-family: 'Raleway', sans-serif; font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(165, 148, 255, 0.3); display: inline-flex; align-items: center; gap: 0.5rem; position: relative; overflow: hidden;"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(165, 148, 255, 0.5)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(165, 148, 255, 0.3)';"
                      >
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Gerenciar Campos Variáveis</span>
                      </button>
                    </div>
                  </div>
                </div>

                <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.5); margin-top: 0.75rem;">
                  Configure variáveis personalizadas para que a IA use informações específicas do formulário durante as conversas
                </p>
              </div>

              <!-- Buttons -->
              <div style="display: flex; gap: 1rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <button type="button" onclick="hideWebhookForm()" class="btn-secondary" style="flex: 1;">
                  <svg class="w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                  <span>Cancelar</span>
                </button>
                <button type="submit" id="generateWebhookBtn" class="btn-primary" style="flex: 1;" onclick="console.log('🔴 [TESTE] Botão foi clicado!');">
                  <svg class="w-6 webhook-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                  <div class="spinner webhook-spinner" style="display: none;"></div>
                  <span class="webhook-btn-text">Gerar Webhook</span>
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Empty State / Webhooks List -->
        <div id="webhooksList" style="display: block;">
          <!-- Empty State -->
          <div id="webhooksEmptyState" class="empty-state" style="display: none;">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#A594FF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 2rem;">
              <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            <h3 style="text-align: center; margin: 0 auto 1rem; max-width: 600px;">Nenhum Webhook Configurado</h3>
            <p style="text-align: center; margin: 0 auto; max-width: 600px; line-height: 1.8;">
              Você ainda não possui webhooks configurados.<br>
              Crie seu primeiro webhook para começar a receber leads!
            </p>
          </div>

          <!-- Webhooks Grid -->
          <div id="webhooksGrid" class="instances-grid" style="display: none;">
            <!-- Webhooks will be rendered here -->
          </div>
        </div>
      </div>
      <!-- End Webhook Content -->

    </div>
  </div>

  <!-- Variables Side Panel -->
  <div id="variablesSidePanel" class="variables-side-panel">
    <div class="variables-panel-overlay" onclick="closeVariablesPanel()"></div>
    <div class="variables-panel-content">
      <!-- Panel Header -->
      <div class="variables-panel-header">
        <div>
          <h2 class="variables-panel-title">Gerenciar Campos Variáveis</h2>
          <p class="variables-panel-subtitle">Personalize suas conversas com variáveis dinâmicas</p>
        </div>
        <button onclick="closeVariablesPanel()" class="variables-close-btn">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Panel Body -->
      <div class="variables-panel-body">
        <!-- Info Card -->
        <div class="variables-info-card">
          <div class="variables-info-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
          </div>
          <div>
            <h4 style="font-weight: 700; font-size: 0.95rem; margin-bottom: 0.25rem;">Como funcionam as variáveis?</h4>
            <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); line-height: 1.5;">
              Crie variáveis como <code>{{nome}}</code> e descreva seu significado. A IA usará essas variáveis para personalizar cada conversa automaticamente.
            </p>
          </div>
        </div>

        <!-- Warning Card - Telefone obrigatório -->
        <div class="variables-info-card" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05)); border: 1px solid rgba(34, 197, 94, 0.3);">
          <div class="variables-info-icon" style="color: #22C55E;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 15.92V18.92C21.0011 19.1985 20.9441 19.4742 20.8325 19.7293C20.7209 19.9845 20.5573 20.2136 20.3521 20.4019C20.1469 20.5901 19.9046 20.7335 19.6407 20.8227C19.3769 20.9119 19.0974 20.9451 18.82 20.92C15.7428 20.5856 12.7869 19.5341 10.19 17.85C7.77382 16.3147 5.72533 14.2662 4.18999 11.85C2.49997 9.2412 1.44824 6.27099 1.11999 3.18C1.095 2.90347 1.12787 2.62476 1.21649 2.36162C1.30512 2.09849 1.44756 1.85669 1.63476 1.65162C1.82196 1.44655 2.0498 1.28271 2.30379 1.17052C2.55777 1.05833 2.83233 1.00026 3.10999 1H6.10999C6.5953 0.995321 7.06579 1.16718 7.43376 1.48363C7.80173 1.80008 8.04207 2.23954 8.10999 2.72C8.23662 3.68007 8.47144 4.62273 8.80999 5.53C8.94454 5.88792 8.97366 6.27691 8.8939 6.65088C8.81415 7.02485 8.62886 7.36811 8.35999 7.64L7.08999 8.91C8.51355 11.4135 10.5864 13.4864 13.09 14.91L14.36 13.64C14.6319 13.3711 14.9751 13.1858 15.3491 13.1061C15.7231 13.0263 16.1121 13.0555 16.47 13.19C17.3773 13.5286 18.3199 13.7634 19.28 13.89C19.7658 13.9585 20.2094 14.2032 20.5265 14.5775C20.8437 14.9518 21.0122 15.4296 21 15.92Z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <h4 style="font-weight: 700; font-size: 0.95rem; margin-bottom: 0.25rem; color: #22C55E;">Telefone é obrigatório</h4>
            <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); line-height: 1.5;">
              Você deve mapear <strong style="color: #22C55E;">exatamente 1 campo como "Telefone"</strong> para que a IA saiba qual número contatar. Se seu formulário tiver outros números (telefone comercial, telefone do cônjuge, etc.), mapeie-os como tipo <strong>"Número"</strong>.
            </p>
          </div>
        </div>

        <!-- Create New Variable Form -->
        <div class="variables-create-section">
          <h3 class="variables-section-title">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            Nova Variável
          </h3>

          <form id="createVariableForm" class="variables-form">
            <div class="form-group">
              <label class="form-label">
                Nome da Variável
                <span style="color: #EF4444;">*</span>
              </label>
              <div class="variable-input-wrapper">
                <span class="variable-prefix">{{</span>
                <input
                  type="text"
                  id="variableName"
                  class="form-input variable-name-input"
                  placeholder="nome"
                  autocomplete="off"
                  maxlength="50"
                />
                <span class="variable-suffix">}}</span>
              </div>
              <div class="form-hint">Use apenas letras minúsculas, números e underscores. Ex: nome_cliente, telefone, email</div>
            </div>

            <div class="form-group">
              <label class="form-label">
                Tipo da Variável
                <span style="color: #EF4444;">*</span>
              </label>
              <select
                id="variableType"
                class="form-input"
                required
              >
                <option value="">Selecione o tipo</option>
                <option value="telefone">Telefone (obrigatório para contato)</option>
                <option value="nome">Nome</option>
                <option value="email">Email</option>
                <option value="texto">Texto</option>
                <option value="numero">Número</option>
                <option value="data">Data</option>
                <option value="outro">Outro</option>
              </select>
              <div class="form-hint">Defina o tipo de informação. <strong>Exatamente 1 telefone</strong> é obrigatório para a IA entrar em contato. Outros números devem ser do tipo "Número".</div>
            </div>

            <div class="form-group">
              <label class="form-label">
                Descrição da Variável
                <span style="color: #EF4444;">*</span>
              </label>
              <textarea
                id="variableDescription"
                class="form-input form-textarea"
                placeholder="Ex: O nome completo do cliente conforme cadastrado no formulário"
                rows="3"
                maxlength="500"
              ></textarea>
              <div class="form-hint">Descreva claramente o que essa variável representa para que a IA use corretamente</div>
            </div>

            <div class="form-group">
              <label class="form-label">
                Exemplo de Valor
                <span style="color: rgba(255, 255, 255, 0.5); font-weight: 400; font-size: 0.85rem;">(opcional)</span>
              </label>
              <input
                type="text"
                id="variableExample"
                class="form-input"
                placeholder="Ex: João Silva"
                maxlength="100"
              />
              <div class="form-hint">Um exemplo ajuda a IA a entender melhor o contexto</div>
            </div>

            <button type="submit" class="btn-create-variable">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Criar Variável
            </button>
          </form>
        </div>

        <!-- Variables List -->
        <div class="variables-list-section">
          <h3 class="variables-section-title">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            Variáveis Criadas
            <span class="variables-count" id="variablesCount">0</span>
          </h3>

          <!-- Empty State -->
          <div id="variablesEmptyState" class="variables-empty-state">
            <div style="margin-bottom: 1rem; opacity: 0.5;">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="rgba(255, 255, 255, 0.5)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
            </div>
            <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.95rem;">
              Nenhuma variável criada ainda.<br>
              Crie sua primeira variável acima!
            </p>
          </div>

          <!-- Variables Grid -->
          <div id="variablesGrid" class="variables-grid" style="display: none;">
            <!-- Variables will be rendered here -->
          </div>
        </div>
      </div>
    </div>
  </div>


  <script>
    console.log('🟢 [INIT] Script webhooks.html carregado!');

    let userData = null;
    let assistantsData = [];
    let numbersData = [];
    let followupsData = [];
    let instancesData = [];

    async function loadExistingWebhooks() {
      try {
        console.log('[DEBUG] 🔍 Buscando webhooks existentes...');

        // Verificar userData
        if (!userData || !userData.user || !userData.user.tenant_id) {
          console.error('[ERROR] userData não encontrado');
          showPopup('error', 'Erro!', 'Dados do usuário não encontrados. Faça login novamente.');
          return;
        }

        const tenantId = userData.user.tenant_id;
        console.log('[DEBUG] tenant_id:', tenantId);
        console.log('[DEBUG] Payload:', JSON.stringify({ tenant_id: tenantId }, null, 2));

        // Fazer POST para buscar webhooks
        const response = await fetch('https://sdr.salesdever.io/webhook/procura_webhooks', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            tenant_id: tenantId
          })
        });

        console.log('[DEBUG] Response status:', response.status);
        console.log('[DEBUG] Response ok:', response.ok);
        console.log('[DEBUG] Response headers:', [...response.headers.entries()]);

        // Verificar se a resposta não está OK (erro do servidor)
        if (!response.ok) {
          console.error('[ERROR] Response não OK. Status:', response.status);

          // Tentar ler mensagem de erro
          let errorMessage = 'Erro ao carregar webhooks';
          try {
            const errorData = await response.json();
            errorMessage = errorData.message || errorData.error || errorMessage;
          } catch (e) {
            errorMessage = `Erro ${response.status}: ${response.statusText}`;
          }

          console.error('[ERROR] Mensagem:', errorMessage);
          showPopup('error', 'Erro!', errorMessage);
          return;
        }

        // Resposta OK - processar dados
        console.log('[DEBUG] ✅ Requisição bem sucedida');

        // Verificar Content-Type
        const contentType = response.headers.get('content-type');
        console.log('[DEBUG] Content-Type:', contentType);

        let data;

        // Primeiro, clonar a resposta para poder ler o texto
        const textBody = await response.clone().text();
        console.log('[DEBUG] Response body (raw):', textBody);

        // Verificar se o body está vazio
        if (!textBody || textBody.trim() === '') {
          console.log('[INFO] ⚠️ Resposta vazia - nenhum webhook encontrado');
          renderWebhooks([]);
          return;
        }

        // Tentar parsear JSON
        try {
          data = JSON.parse(textBody);
          console.log('[DEBUG] Response data (parsed):', data);
          console.log('[DEBUG] Total de webhooks:', Array.isArray(data) ? data.length : 'N/A');

          // Renderizar webhooks na interface
          renderWebhooks(data);

        } catch (parseError) {
          console.error('[ERROR] Erro ao parsear JSON:', parseError);
          console.error('[ERROR] Body recebido:', textBody);

          // Se não conseguiu parsear, assumir que não há webhooks
          console.log('[INFO] ⚠️ Resposta não é JSON válido - assumindo lista vazia');
          renderWebhooks([]);
        }

      } catch (error) {
        console.error('[ERROR] Exception capturada:', error);
        console.error('[ERROR] Stack trace:', error.stack);
        showPopup('error', 'Erro!', `Erro ao conectar com o servidor: ${error.message}`);
      }
    }

    function renderWebhooks(webhooksData) {
      const webhooksGrid = document.getElementById('webhooksGrid');
      const emptyState = document.getElementById('webhooksEmptyState');

      console.log('[DEBUG] renderWebhooks chamado com:', webhooksData);
      console.log('[DEBUG] Tipo de dados:', typeof webhooksData);
      console.log('[DEBUG] É array?', Array.isArray(webhooksData));

      // Normalizar dados - pode vir como array direto ou objeto com propriedade
      let webhooks = webhooksData;

      // Se não for array, tentar extrair array de propriedades comuns
      if (!Array.isArray(webhooksData)) {
        console.log('[DEBUG] Dados não são array, tentando extrair...');

        if (webhooksData && typeof webhooksData === 'object') {
          // Tentar propriedades comuns
          webhooks = webhooksData.webhooks ||
                     webhooksData.data ||
                     webhooksData.results ||
                     [];

          console.log('[DEBUG] Webhooks extraídos:', webhooks);
        } else {
          webhooks = [];
        }
      }

      // Verificar se conseguimos um array válido
      if (!Array.isArray(webhooks)) {
        console.error('[ERROR] Não foi possível converter dados em array:', webhooksData);
        webhooks = [];
      }

      console.log('[DEBUG] Total de webhooks a renderizar:', webhooks.length);

      // Filtrar apenas webhooks ativos (se o campo 'ativo' existir)
      // Se o campo não existir, mostrar todos os webhooks
      let activeWebhooks = webhooks;
      
      // Verificar se pelo menos um webhook tem o campo 'ativo'
      const hasAtivoField = webhooks.some(webhook => 'ativo' in webhook || 'active' in webhook);
      
      if (hasAtivoField) {
        console.log('[DEBUG] Campo "ativo" encontrado, filtrando webhooks ativos...');
        activeWebhooks = webhooks.filter(webhook => {
          const ativo = webhook.ativo !== undefined ? webhook.ativo : webhook.active;
          // Se o campo existe, verificar se está ativo
          if (ativo !== undefined && ativo !== null) {
            return ativo === true || ativo === 1 || ativo === 'true' || ativo === '1';
          }
          // Se o campo existe mas está undefined/null, considerar como inativo
          return false;
        });
        console.log('[DEBUG] Total de webhooks ativos após filtro:', activeWebhooks.length);
      } else {
        console.log('[DEBUG] Campo "ativo" não encontrado, mostrando todos os webhooks');
      }

      if (!activeWebhooks || activeWebhooks.length === 0) {
        // Mostrar empty state
        webhooksGrid.style.display = 'none';
        emptyState.style.display = 'flex';
        return;
      }

      // Esconder empty state e mostrar grid
      emptyState.style.display = 'none';
      webhooksGrid.style.display = 'grid';

      // Limpar grid
      webhooksGrid.innerHTML = '';

      // Renderizar cada webhook ativo
      activeWebhooks.forEach((webhook, index) => {
        const card = createWebhookCard(webhook, index);
        webhooksGrid.innerHTML += card;
      });

      console.log('[DEBUG] ✅ Webhooks renderizados com sucesso');
    }

    function createWebhookCard(webhook, index) {
      // Formatar data (UTC-3)
      const formattedDate = formatDateBrazil(webhook.created_at);

      // Usar o webhook_url que vem do backend (sempre correto)
      const fullWebhookUrl = webhook.webhook_url;

      return `
        <div class="webhook-card" style="animation-delay: ${index * 0.1}s;" data-webhook-id="${webhook.id || webhook.webhook_id || ''}">
          <!-- Header -->
          <div class="webhook-card-header">
            <div class="webhook-card-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              ${webhook.webhook_name}
            </div>
            <div style="display: flex; gap: 0.5rem;">
              <button
                class="webhook-deactivate-btn-icon"
                onclick="desativarWebhook('${webhook.id || webhook.webhook_id || ''}', this)"
                title="Desativar webhook">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- URL -->
          <div class="webhook-card-url">
            <span class="webhook-url-text" title="${fullWebhookUrl}">${fullWebhookUrl}</span>
            <button class="webhook-copy-small-btn" onclick="copyWebhookUrlSmall('${fullWebhookUrl}', this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke-width="2"></rect>
                <path stroke-width="2" d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              <span>Copiar</span>
            </button>
          </div>

          <!-- Botões de Ação (sempre visíveis) -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1.5rem;">
            <button
              class="btn-action btn-logs"
              onclick="openWebhookLogs('${webhook.id || webhook.webhook_id || ''}')"
              title="Ver logs do webhook">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              LOGS
            </button>
            <button
              class="btn-action btn-edit"
              onclick="editarWebhook('${webhook.id || webhook.webhook_id || ''}', ${JSON.stringify(webhook).replace(/"/g, '&quot;')})"
              title="Editar webhook">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
              EDITAR
            </button>
          </div>

          <!-- Botão Ver Informações -->
          <button
            class="btn-info-toggle"
            onclick="toggleWebhookDetails('${webhook.id || webhook.webhook_id || ''}')"
            style="margin-top: 1rem;"
            data-webhook-btn="${webhook.id || webhook.webhook_id || ''}"
          >
            <span class="btn-text">VER INFORMAÇÕES</span>
            <svg class="info-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <!-- Área expandida (inicialmente escondida) -->
          <div class="webhook-details-expanded" style="max-height: 0; overflow: hidden; transition: max-height 0.4s ease;">
            <div style="padding-top: 1.5rem;">
              <!-- Info -->
              <div class="webhook-card-info">
                <!-- Assistente -->
                <div class="webhook-info-row">
                  <svg class="webhook-info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <div class="webhook-info-content">
                    <div class="webhook-info-label">Assistente</div>
                    <div class="webhook-info-value">${webhook.assistant_name || 'N/A'}</div>
                  </div>
                </div>

                <!-- Número -->
                <div class="webhook-info-row">
                  <svg class="webhook-info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                  </svg>
                  <div class="webhook-info-content">
                    <div class="webhook-info-label">Número</div>
                    <div class="webhook-info-value">${webhook.number_name || 'N/A'}${webhook.number_value ? ` • ${webhook.number_value}` : ''}</div>
                  </div>
                </div>

                <!-- Follow-up -->
                ${webhook.follow_up_name ? `
                <div class="webhook-info-row">
                  <svg class="webhook-info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                  </svg>
                  <div class="webhook-info-content">
                    <div class="webhook-info-label">Follow-up</div>
                    <div class="webhook-info-value">${webhook.follow_up_name}</div>
                  </div>
                </div>
                ` : ''}

                <!-- Instância -->
                ${webhook.instance_name ? `
                <div class="webhook-info-row">
                  <svg class="webhook-info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                  </svg>
                  <div class="webhook-info-content">
                    <div class="webhook-info-label">Instância</div>
                    <div class="webhook-info-value">${webhook.instance_name}</div>
                  </div>
                </div>
                ` : ''}

                <!-- Delay Primeiro Contato -->
                ${webhook.contact_delay !== undefined && webhook.contact_delay !== null ? `
                <div class="webhook-info-row">
                  <svg class="webhook-info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <div class="webhook-info-content">
                    <div class="webhook-info-label">Delay Primeiro Contato</div>
                    <div class="webhook-info-value">${webhook.contact_delay} ${webhook.contact_delay === 1 ? 'minuto' : 'minutos'}</div>
                  </div>
                </div>
                ` : ''}

                <!-- Horário de Atendimento -->
                ${webhook.working_hours ? `
                <div class="webhook-info-row">
                  <svg class="webhook-info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                  <div class="webhook-info-content">
                    <div class="webhook-info-label">Horário de Atendimento</div>
                    <div class="webhook-info-value">${webhook.working_hours === '00:00-23:59' ? '24 horas' : webhook.working_hours.replace('-', ' - ')}</div>
                  </div>
                </div>
                ` : ''}
              </div>

              <!-- Variáveis Customizadas -->
              ${webhook.custom_variables ? renderCustomVariables(webhook.custom_variables) : ''}

              <!-- Data -->
              <div class="webhook-date">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke-width="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6" stroke-width="2"></line>
                  <line x1="8" y1="2" x2="8" y2="6" stroke-width="2"></line>
                  <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"></line>
                </svg>
                Criado em ${formattedDate}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderCustomVariables(customVariablesString) {
      try {
        // Parse a string JSON
        const variables = JSON.parse(customVariablesString);

        if (!variables || variables.length === 0) {
          return '';
        }

        // Criar o HTML das variáveis
        const variablesHtml = variables.map(variable => {
          // Definir ícone e cor baseado no tipo
          let iconSvg = '';
          let typeColor = '#A594FF';
          let typeBadgeText = variable.type || 'outro';

          switch(variable.type) {
            case 'telefone':
              typeColor = '#22C55E';
              typeBadgeText = 'Telefone';
              iconSvg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${typeColor}">
                <path d="M21 15.92V18.92C21.0011 19.1985 20.9441 19.4742 20.8325 19.7293C20.7209 19.9845 20.5573 20.2136 20.3521 20.4019C20.1469 20.5901 19.9046 20.7335 19.6407 20.8227C19.3769 20.9119 19.0974 20.9451 18.82 20.92C15.7428 20.5856 12.7869 19.5341 10.19 17.85C7.77382 16.3147 5.72533 14.2662 4.18999 11.85C2.49997 9.2412 1.44824 6.27099 1.11999 3.18C1.095 2.90347 1.12787 2.62476 1.21649 2.36162C1.30512 2.09849 1.44756 1.85669 1.63476 1.65162C1.82196 1.44655 2.0498 1.28271 2.30379 1.17052C2.55777 1.05833 2.83233 1.00026 3.10999 1H6.10999C6.5953 0.995321 7.06579 1.16718 7.43376 1.48363C7.80173 1.80008 8.04207 2.23954 8.10999 2.72C8.23662 3.68007 8.47144 4.62273 8.80999 5.53C8.94454 5.88792 8.97366 6.27691 8.8939 6.65088C8.81415 7.02485 8.62886 7.36811 8.35999 7.64L7.08999 8.91C8.51355 11.4135 10.5864 13.4864 13.09 14.91L14.36 13.64C14.6319 13.3711 14.9751 13.1858 15.3491 13.1061C15.7231 13.0263 16.1121 13.0555 16.47 13.19C17.3773 13.5286 18.3199 13.7634 19.28 13.89C19.7658 13.9585 20.2094 14.2032 20.5265 14.5775C20.8437 14.9518 21.0122 15.4296 21 15.92Z" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>`;
              break;
            case 'nome':
              typeColor = '#3B82F6';
              typeBadgeText = 'Nome';
              iconSvg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${typeColor}">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>`;
              break;
            case 'email':
              typeColor = '#F59E0B';
              typeBadgeText = 'Email';
              iconSvg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${typeColor}">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>`;
              break;
            default:
              typeColor = '#A594FF';
              typeBadgeText = 'Outro';
              iconSvg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${typeColor}">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
              </svg>`;
          }

          return `
            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 0.75rem; padding: 0.875rem; margin-bottom: 0.5rem; transition: all 0.3s ease;">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                ${iconSvg}
                <span style="font-weight: 600; color: #ffffff; font-size: 0.9rem;">{{${variable.variable}}}</span>
                <span style="background: ${typeColor}20; color: ${typeColor}; padding: 0.15rem 0.5rem; border-radius: 0.5rem; font-size: 0.75rem; font-weight: 600; border: 1px solid ${typeColor}40;">${typeBadgeText}</span>
              </div>
              ${variable.description ? `<div style="color: rgba(255, 255, 255, 0.6); font-size: 0.8rem; margin-bottom: 0.25rem;">${variable.description}</div>` : ''}
              ${variable.example ? `<div style="color: rgba(255, 255, 255, 0.5); font-size: 0.75rem; font-style: italic;">Ex: ${variable.example}</div>` : ''}
            </div>
          `;
        }).join('');

        return `
          <div class="variables-accordion" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="variables-accordion-header" onclick="toggleVariablesAccordion(this)" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: rgba(165, 148, 255, 0.08); border-radius: 0.5rem; cursor: pointer; transition: all 0.3s ease;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#A594FF">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
              </svg>
              <span style="font-weight: 700; color: #A594FF; font-size: 0.95rem;">Variáveis Customizadas</span>
              <span style="background: rgba(165, 148, 255, 0.25); color: #A594FF; padding: 0.2rem 0.5rem; border-radius: 0.5rem; font-size: 0.75rem; font-weight: 700;">${variables.length}</span>
              <svg class="variables-chevron" style="width: 18px; height: 18px; margin-left: auto; transition: transform 0.3s ease;" viewBox="0 0 24 24" fill="none" stroke="#A594FF">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
              </svg>
            </div>
            <div class="variables-accordion-content" style="max-height: 0; overflow: hidden; transition: max-height 0.4s ease;">
              <div style="padding-top: 1rem;">
                ${variablesHtml}
              </div>
            </div>
          </div>
        `;
      } catch (error) {
        console.error('Erro ao processar custom_variables:', error);
        return '';
      }
    }

    function formatDateBrazil(dateString) {
      if (!dateString) return 'N/A';

      // Criar data e ajustar para UTC-3
      const date = new Date(dateString);
      const offset = -3 * 60; // UTC-3 em minutos
      const localDate = new Date(date.getTime() + offset * 60 * 1000);

      const day = String(localDate.getUTCDate()).padStart(2, '0');
      const month = String(localDate.getUTCMonth() + 1).padStart(2, '0');
      const year = localDate.getUTCFullYear();
      const hours = String(localDate.getUTCHours()).padStart(2, '0');
      const minutes = String(localDate.getUTCMinutes()).padStart(2, '0');

      return `${day}/${month}/${year} às ${hours}:${minutes}`;
    }

    function copyWebhookUrlSmall(url, button) {
      navigator.clipboard.writeText(url).then(() => {
        const originalHTML = button.innerHTML;
        button.classList.add('copied');
        button.innerHTML = `
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <polyline points="20 6 9 17 4 12" stroke-width="2"></polyline>
          </svg>
          <span>Copiado!</span>
        `;

        setTimeout(() => {
          button.classList.remove('copied');
          button.innerHTML = originalHTML;
        }, 2000);
      }).catch(err => {
        console.error('Erro ao copiar:', err);
        showPopup('error', 'Erro!', 'Não foi possível copiar a URL.');
      });
    }

    function showConfirmDeactivatePopup(webhookId, button) {
      if (!webhookId) {
        console.error('[ERROR] ID do webhook não encontrado');
        showPopup('error', 'Erro!', 'ID do webhook não encontrado.');
        return;
      }

      // Verificar userData
      if (!userData || !userData.user || !userData.user.tenant_id) {
        console.error('[ERROR] userData não encontrado');
        showPopup('error', 'Erro!', 'Dados do usuário não encontrados. Faça login novamente.');
        return;
      }

      // Mostrar popup de confirmação
      const confirmOverlay = document.getElementById('confirmPopupOverlay');
      confirmOverlay.classList.add('show');

      // Remover listeners anteriores
      const cancelBtn = document.getElementById('confirmCancelBtn');
      const confirmBtn = document.getElementById('confirmConfirmBtn');
      
      const newCancelBtn = cancelBtn.cloneNode(true);
      const newConfirmBtn = confirmBtn.cloneNode(true);
      cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
      confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);

      // Listener para cancelar
      newCancelBtn.addEventListener('click', () => {
        confirmOverlay.classList.remove('show');
      });

      // Listener para confirmar
      newConfirmBtn.addEventListener('click', async () => {
        confirmOverlay.classList.remove('show');
        await executeDeactivateWebhook(webhookId, button);
      });

      // Fechar ao clicar no overlay (fora do popup) - apenas uma vez
      const handleOverlayClick = (e) => {
        if (e.target === confirmOverlay) {
          confirmOverlay.classList.remove('show');
          confirmOverlay.removeEventListener('click', handleOverlayClick);
        }
      };
      confirmOverlay.addEventListener('click', handleOverlayClick);
    }

    async function executeDeactivateWebhook(webhookId, button) {
      // Desabilitar botão durante a requisição
      button.disabled = true;
      const originalHTML = button.innerHTML;
      button.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
      `;

      try {
        const response = await fetch('https://sdr.salesdever.io/webhook/desativa_webhook', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            webhook_id: webhookId,
            tenant_id: userData.user.tenant_id
          })
        });

        if (response.ok) {
          showPopup('success', 'Sucesso!', 'Webhook desativado com sucesso.');
          // Recarregar lista de webhooks
          await loadExistingWebhooks();
        } else {
          const errorData = await response.json().catch(() => ({}));
          const errorMessage = errorData.message || errorData.error || 'Erro ao desativar webhook';
          showPopup('error', 'Erro!', errorMessage);
          // Reabilitar botão em caso de erro
          button.disabled = false;
          button.innerHTML = originalHTML;
        }
      } catch (error) {
        console.error('[ERROR] Erro ao desativar webhook:', error);
        showPopup('error', 'Erro!', `Erro ao conectar com o servidor: ${error.message}`);
        // Reabilitar botão em caso de erro
        button.disabled = false;
        button.innerHTML = originalHTML;
      }
    }

    function desativarWebhook(webhookId, button) {
      showConfirmDeactivatePopup(webhookId, button);
    }

    // Função para editar webhook
    function editarWebhook(webhookId, webhookData) {
      try {
        // Parse dos dados do webhook se for string
        const webhook = typeof webhookData === 'string' ? JSON.parse(webhookData) : webhookData;

        // Abrir popup de edição
        showEditWebhookPopup(webhookId, webhook);
      } catch (error) {
        console.error('Erro ao abrir edição de webhook:', error);
        showPopup('error', 'Erro!', 'Erro ao carregar dados do webhook.');
      }
    }

    // Função para mostrar popup de edição
    async function showEditWebhookPopup(webhookId, webhook) {
      console.log('📝 Abrindo edição para webhook:', webhook);

      // Armazenar ID do webhook e dados originais para uso posterior
      window.currentEditWebhookId = webhookId;
      window.currentEditWebhookData = webhook;

      // Mostrar popup primeiro
      const overlay = document.getElementById('editWebhookOverlay');
      overlay.style.display = 'block';
      setTimeout(() => {
        overlay.classList.add('show');
      }, 10);

      // Preencher campos básicos imediatamente
      document.getElementById('editWebhookName').value = webhook.webhook_name || '';
      document.getElementById('editContactDelay').value = webhook.contact_delay || 5;
      document.getElementById('editWorkingHours').value = webhook.working_hours || '00:00-23:59';

      // Carregar dados dos selects e preencher após carregamento
      try {
        await loadEditWebhookData();

        // Aguardar os dados carregarem e pré-selecionar valores com múltiplas tentativas
        setTimeout(() => {
          console.log('🔧 Iniciando pré-seleção com dados do webhook:');
          console.log('📋 WEBHOOK COMPLETO:', JSON.stringify(webhook, null, 2));

          // Selecionar assistente - tentar diferentes propriedades
          const assistantSelect = document.getElementById('editAssistantSelect');
          console.log('🤖 Tentando selecionar assistente:', {
            assistant_id: webhook.assistant_id,
            assistente_id: webhook.assistente_id,
            assistant_name: webhook.assistant_name,
            options: assistantSelect.options.length
          });

          // Múltiplas tentativas para assistente
          const assistantFound = selectOptionByValue(assistantSelect, webhook.assistant_id, webhook.assistant_name) ||
                                selectOptionByValue(assistantSelect, webhook.assistente_id, webhook.assistant_name) ||
                                selectOptionByValue(assistantSelect, webhook.assistant_id, '') ||
                                selectOptionByValue(assistantSelect, webhook.assistente_id, '');

          if (!assistantFound) {
            console.log('❌ Assistente não encontrado, tentando com todos os campos possíveis...');
            console.log('Webhook completo:', JSON.stringify(webhook, null, 2));
          }

          // Selecionar número - tentar diferentes propriedades
          const numberSelect = document.getElementById('editNumberSelect');
          console.log('📱 Tentando selecionar número:', {
            number_id: webhook.number_id,
            number_name: webhook.number_name,
            number_value: webhook.number_value,
            phone_number: webhook.phone_number,
            options: numberSelect.options.length
          });

          const numberFound = selectOptionByValue(numberSelect, webhook.number_id, webhook.number_name) ||
                             selectOptionByValue(numberSelect, webhook.number_id, webhook.number_value) ||
                             selectOptionByValue(numberSelect, webhook.number_id, webhook.phone_number) ||
                             selectOptionByValue(numberSelect, webhook.number_id, '');

          if (!numberFound) {
            console.log('❌ Número não encontrado, tentando com todos os campos possíveis...');
          }

          // Selecionar follow-up - apenas se existir
          const followUpSelect = document.getElementById('editFollowUpSelect');
          console.log('🔄 Dados follow-up do webhook:', {
            follow_up_id: webhook.follow_up_id,
            follow_up_name: webhook.follow_up_name,
            strategy_name: webhook.strategy_name,
            options: followUpSelect.options.length
          });

          if (webhook.follow_up_id && webhook.follow_up_id !== '' && webhook.follow_up_id !== null && webhook.follow_up_id !== 'null') {
            const followUpFound = selectOptionByValue(followUpSelect, webhook.follow_up_id, webhook.follow_up_name) ||
                                 selectOptionByValue(followUpSelect, webhook.follow_up_id, webhook.strategy_name) ||
                                 selectOptionByValue(followUpSelect, webhook.follow_up_id, '');

            if (!followUpFound) {
              console.log('❌ Follow-up não encontrado, mas tem ID:', webhook.follow_up_id);
            }
          }

          // Selecionar instância
          const instanceSelect = document.getElementById('editInstanceSelect');
          console.log('🏢 Tentando selecionar instância:', {
            instance_id: webhook.instance_id,
            instance_name: webhook.instance_name,
            options: instanceSelect.options.length
          });

          const instanceFound = selectOptionByValue(instanceSelect, webhook.instance_id, webhook.instance_name) ||
                                selectOptionByValue(instanceSelect, webhook.instance_id, '');

          if (!instanceFound) {
            console.log('❌ Instância não encontrada, tentando com todos os campos possíveis...');
          }

          console.log('✅ Processo de pré-seleção finalizado');
        }, 2000); // Aumentei para 2 segundos

      } catch (error) {
        console.error('Erro ao carregar dados para edição:', error);
        showPopup('error', 'Erro!', 'Erro ao carregar dados para edição.');
      }
    }

    // Função auxiliar para selecionar option por valor ou texto (melhorada e mais robusta)
    function selectOptionByValue(selectElement, valueToFind, textToFind) {
      if (!selectElement || !selectElement.options) {
        console.log('❌ Select element não encontrado ou sem options');
        return false;
      }

      console.log(`🔍 Procurando option com valor: "${valueToFind}" ou texto: "${textToFind}"`);
      console.log(`📋 Total de options disponíveis: ${selectElement.options.length}`);

      // Resetar seleção atual
      for (let option of selectElement.options) {
        option.selected = false;
      }

      // Listar todas as options disponíveis para debug
      for (let i = 0; i < selectElement.options.length; i++) {
        const option = selectElement.options[i];
        console.log(`   Option ${i}: value="${option.value}" text="${option.textContent.trim()}"`);
      }

      // 1. Tentar por valor exato (string e número)
      if (valueToFind !== null && valueToFind !== undefined && valueToFind !== '') {
        for (let option of selectElement.options) {
          if (option.value === valueToFind.toString() || option.value === valueToFind ||
              option.value === String(valueToFind) || String(option.value) === String(valueToFind)) {
            option.selected = true;
            selectElement.value = option.value;
            console.log('✅ Selecionado por valor exato:', option.textContent.trim());
            return true;
          }
        }
      }

      // 2. Tentar por data attributes (se existirem)
      if (valueToFind !== null && valueToFind !== undefined && valueToFind !== '') {
        for (let option of selectElement.options) {
          const dataId = option.getAttribute('data-assistant-id') ||
                        option.getAttribute('data-number-id') ||
                        option.getAttribute('data-followup-id') ||
                        option.getAttribute('data-instance-id');

          if (dataId && (dataId === valueToFind.toString() || dataId === String(valueToFind))) {
            option.selected = true;
            selectElement.value = option.value;
            console.log('✅ Selecionado por data attribute:', option.textContent.trim());
            return true;
          }
        }
      }

      // 3. Tentar por texto contido (mais flexível)
      if (textToFind && textToFind.trim() !== '') {
        const searchText = textToFind.toLowerCase().trim();
        for (let option of selectElement.options) {
          const optionText = option.textContent.toLowerCase().trim();
          if (optionText.includes(searchText) && option.value !== '') {
            option.selected = true;
            selectElement.value = option.value;
            console.log('✅ Selecionado por texto contido:', option.textContent.trim());
            return true;
          }
        }
      }

      // 4. Tentar por texto exato
      if (textToFind && textToFind.trim() !== '') {
        const searchText = textToFind.toLowerCase().trim();
        for (let option of selectElement.options) {
          const optionText = option.textContent.toLowerCase().trim();
          if (optionText === searchText && option.value !== '') {
            option.selected = true;
            selectElement.value = option.value;
            console.log('✅ Selecionado por texto exato:', option.textContent.trim());
            return true;
          }
        }
      }

      // 5. Última tentativa: procurar por partes do texto
      if (textToFind && textToFind.trim() !== '') {
        const searchParts = textToFind.toLowerCase().trim().split(/\s+/);
        for (let option of selectElement.options) {
          const optionText = option.textContent.toLowerCase().trim();
          const matchesAll = searchParts.every(part => optionText.includes(part));
          if (matchesAll && option.value !== '') {
            option.selected = true;
            selectElement.value = option.value;
            console.log('✅ Selecionado por partes do texto:', option.textContent.trim());
            return true;
          }
        }
      }

      console.log(`❌ Não foi possível selecionar option para valor: "${valueToFind}" texto: "${textToFind}"`);
      return false;
    }

    // Função para carregar dados para os selects de edição (SEMPRE carrega dados frescos)
    async function loadEditWebhookData() {
      console.log('📊 Carregando dados FRESCOS para edição (garantindo compatibilidade com múltiplos webhooks)...');

      // SEMPRE carregar dados frescos da API para garantir consistência
      try {
        console.log('📊 Forçando carregamento de dados frescos...');

        // Limpar dados existentes para forçar reload
        assistantsData = [];
        numbersData = [];
        followupsData = [];
        instancesData = [];

        // Chamar a função original para carregar dados frescos
        await loadWebhookData();

        // Após carregar, popular os selects de edição
        populateEditAssistants();
        populateEditNumbers();
        populateEditFollowUps();
        populateEditInstances();

        console.log('✅ Dados FRESCOS carregados e selects populados para edição');
        console.log('📊 Resumo dos dados carregados:', {
          assistentes: assistantsData.length,
          numeros: numbersData.length,
          followups: followupsData.length,
          instancias: instancesData.length
        });
      } catch (error) {
        console.error('❌ Erro ao carregar dados para edição:', error);
        showPopup('error', 'Erro!', 'Erro ao carregar dados para edição.');
      }
    }

    // Função para popular assistentes no select de edição
    function populateEditAssistants() {
      const select = document.getElementById('editAssistantSelect');
      select.innerHTML = '<option value="">Selecione um assistente</option>';

      console.log('🤖 Populando assistentes para edição. Total:', assistantsData ? assistantsData.length : 0);

      if (!assistantsData || assistantsData.length === 0) {
        console.warn('❌ Nenhum assistente encontrado');
        return;
      }

      assistantsData.forEach((assistant, index) => {
        console.log(`🤖 Assistente ${index}:`, assistant);

        const option = document.createElement('option');
        // Usar a mesma lógica das funções originais
        const assistantId = assistant.assistente_id || assistant.assistant_id || assistant.id;
        const assistantName = assistant.name || assistant.assistant_name || 'Assistente sem nome';

        option.value = assistantId;
        option.textContent = assistantName;
        select.appendChild(option);

        console.log(`✅ Assistente adicionado: ${assistantName} (ID: ${assistantId})`);
      });
    }

    // Função para popular números no select de edição
    function populateEditNumbers() {
      const select = document.getElementById('editNumberSelect');
      select.innerHTML = '<option value="">Selecione um número</option>';

      console.log('📱 Populando números para edição. Total:', numbersData ? numbersData.length : 0);

      if (!numbersData || numbersData.length === 0) {
        console.warn('❌ Nenhum número encontrado');
        return;
      }

      numbersData.forEach((number, index) => {
        console.log(`📱 Número ${index}:`, number);

        const option = document.createElement('option');
        // Usar EXATAMENTE a mesma lógica da função original
        const numberId = number.number_id || number.id;
        const numberName = number.number_name || 'Número sem nome';
        const phoneNumber = number.phone_number || '';

        option.value = numberId;
        option.textContent = `${numberName} (${phoneNumber.trim()})`;
        option.setAttribute('data-number-id', numberId);
        option.setAttribute('data-number-name', numberName);
        option.setAttribute('data-number-value', phoneNumber);
        select.appendChild(option);

        console.log(`✅ Número adicionado: ${numberName} (${phoneNumber}) (ID: ${numberId})`);
      });
    }

    // Função para popular follow-ups no select de edição
    function populateEditFollowUps() {
      const select = document.getElementById('editFollowUpSelect');
      select.innerHTML = '<option value="">Nenhum follow up</option>';

      console.log('🔄 Populando follow-ups para edição. Total:', followupsData ? followupsData.length : 0);

      if (!followupsData || followupsData.length === 0) {
        console.warn('❌ Nenhum follow-up encontrado');
        return;
      }

      // Filtrar apenas follow-ups do tipo webhook (mesma lógica da função original)
      const webhookFollowUps = followupsData.filter(f =>
        f.follow_up_type && f.follow_up_type.toLowerCase() === 'webhook'
      );

      console.log('🔄 Follow-ups filtrados (webhook):', webhookFollowUps.length);

      webhookFollowUps.forEach((followup, index) => {
        console.log(`🔄 Follow-up ${index}:`, followup);

        const option = document.createElement('option');
        // Usar EXATAMENTE a mesma lógica da função original
        const followupId = followup.follow_up_id || followup.id || followup._uuid;
        const followupName = followup.strategy_name || followup.nome_followup || followup.name || 'Follow-up sem nome';

        option.value = followupId;
        option.textContent = followupName;
        option.setAttribute('data-followup-id', followupId);
        option.setAttribute('data-followup-name', followupName);
        select.appendChild(option);

        console.log(`✅ Follow-up adicionado: ${followupName} (ID: ${followupId})`);
      });
    }

    // Função para popular instâncias no select de edição
    function populateEditInstances() {
      const select = document.getElementById('editInstanceSelect');
      select.innerHTML = '<option value="">Selecione uma instância</option>';

      console.log('🏢 Populando instâncias para edição. Total:', instancesData ? instancesData.length : 0);

      if (!instancesData || instancesData.length === 0) {
        console.warn('❌ Nenhuma instância encontrada');
        return;
      }

      instancesData.forEach((instance, index) => {
        console.log(`🏢 Instância ${index}:`, instance);

        const option = document.createElement('option');
        // Usar a mesma lógica das funções originais
        const instanceId = instance.id || instance.uuid || instance._uuid;
        const instanceName = instance.name || instance.instance_name || 'Instância sem nome';

        option.value = instanceId;
        option.textContent = instanceName;
        select.appendChild(option);

        console.log(`✅ Instância adicionada: ${instanceName} (ID: ${instanceId})`);
      });
    }

    // Função para fechar popup de edição
    function closeEditWebhook() {
      const overlay = document.getElementById('editWebhookOverlay');
      overlay.classList.remove('show');
      setTimeout(() => {
        overlay.style.display = 'none';
        window.currentEditWebhookId = null;
        window.currentEditWebhookData = null; // Limpar dados originais também
      }, 300);
    }

    // Event listener para o formulário de edição
    document.addEventListener('DOMContentLoaded', function() {
      const editWebhookForm = document.getElementById('editWebhookForm');
      if (editWebhookForm) {
        editWebhookForm.addEventListener('submit', async function(e) {
          e.preventDefault();

          try {
            // Coletar dados do formulário
            const webhookName = document.getElementById('editWebhookName').value;
            const assistantId = document.getElementById('editAssistantSelect').value;
            const numberId = document.getElementById('editNumberSelect').value;
            const followUpId = document.getElementById('editFollowUpSelect').value || null;
            const contactDelay = parseInt(document.getElementById('editContactDelay').value) || 5;

            // Para instância, enviar o NOME em vez do ID
            const instanceSelect = document.getElementById('editInstanceSelect');
            const instanceId = instanceSelect.value; // Manter para validação
            const instanceName = instanceSelect.options[instanceSelect.selectedIndex]?.textContent || '';

            const workingHours = document.getElementById('editWorkingHours').value;

            console.log('📝 Dados coletados para edição:', {
              instanceId: instanceId,
              instanceName: instanceName,
              selectedOption: instanceSelect.options[instanceSelect.selectedIndex]
            });

            // Validação
            if (!webhookName || !assistantId || !numberId || !instanceId) {
              showPopup('error', 'Erro!', 'Por favor, preencha todos os campos obrigatórios.');
              return;
            }

            if (!window.currentEditWebhookId) {
              showPopup('error', 'Erro!', 'ID do webhook não encontrado.');
              return;
            }

            // Mostrar loading
            const submitBtn = document.querySelector('.edit-webhook-btn-confirm');
            const originalHTML = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner edit-webhook-spinner"></div><span>Salvando...</span>';

            // Obter dados originais do webhook para usar como fallback
            const originalWebhook = window.currentEditWebhookData || {};

            // Preparar dados para envio (usando dados originais como fallback)
            const webhookData = {
              webhook_id: window.currentEditWebhookId,
              webhook_name: webhookName || originalWebhook.webhook_name,
              assistant_id: assistantId || originalWebhook.assistant_id,
              number_id: numberId || originalWebhook.number_id,
              follow_up_id: followUpId || originalWebhook.follow_up_id || null,
              contact_delay: contactDelay || originalWebhook.contact_delay || 5,
              instance_id: instanceName || originalWebhook.instance_name || originalWebhook.instance_id, // NOME da instância com fallback
              working_hours: workingHours || originalWebhook.working_hours || '00:00-23:59',
              tenant_id: userData.user.tenant_id,
              org_private_key: userData.user.org_private_key || userData.user.organization?.org_private_key || userData.organization?.org_private_key,
              user_email: userData.user.email || userData.user.nome || ''
            };

            console.log('📋 Dados originais do webhook:', originalWebhook);
            console.log('📝 Dados que serão enviados:', webhookData);

            console.log('Enviando dados para edição:', webhookData);

            // Chamar API para editar webhook
            const response = await fetch('https://sdr.salesdever.io/webhook/editar-webhook-saas', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(webhookData)
            });

            const result = await response.json();

            if (!response.ok) {
              throw new Error(result.message || `Erro HTTP ${response.status}`);
            }

            // Sucesso
            console.log('Webhook editado com sucesso:', result);
            showPopup('success', 'Sucesso!', 'Webhook editado com sucesso!');

            // Fechar popup
            closeEditWebhook();

            // Recarregar lista de webhooks
            await loadExistingWebhooks();

            // Restaurar botão
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalHTML;

          } catch (error) {
            console.error('Erro ao editar webhook:', error);
            showPopup('error', 'Erro!', error.message || 'Erro ao editar webhook. Tente novamente.');

            // Restaurar botão
            const submitBtn = document.querySelector('.edit-webhook-btn-confirm');
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<svg class="w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg><span class="edit-webhook-btn-text">Salvar Alteração</span>';
            }
          }
        });
      }
    });

    async function showWebhookForm() {
      document.getElementById('webhookForm').style.display = 'block';
      document.getElementById('webhooksList').style.display = 'none';

      // Load webhook data
      await loadWebhookData();

      // Garantir que o event listener está anexado
      console.log('🔵 [DIAGNÓSTICO] showWebhookForm() chamada, anexando listener...');
      attachFormListener();
    }

    async function loadWebhookData() {
      try {
        if (!userData || !userData.user || !userData.user.tenant_id) {
          console.error('userData não encontrado');
          showPopup('error', 'Erro!', 'Dados do usuário não encontrados. Faça login novamente.');
          return;
        }

        const tenantId = userData.user.tenant_id;
        const userEmail = userData.user.email || userData.user.nome || '';

        // Buscar org_private_key em diferentes locais possíveis
        const orgPrivateKey = userData.user.org_private_key ||
                             userData.org_private_key ||
                             localStorage.getItem('org_private_key') ||
                             '';

        console.log('[DEBUG] Carregando dados do webhook...');
        console.log('[DEBUG] tenant_id:', tenantId);
        console.log('[DEBUG] userEmail:', userEmail);
        console.log('[DEBUG] org_private_key:', orgPrivateKey ? 'Encontrado' : 'Não encontrado');

        // Buscar Assistentes/Números, Follow-ups e Instâncias em paralelo
        const requests = [];

        // Request 1: Assistentes E Números (novo webhook)
        requests.push(
          fetch('https://sdr.salesdever.io/webhook/assistentes-saas-att', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              login: userEmail,
              tenant_id: tenantId,
              org_private_key: orgPrivateKey
            })
          }).catch(err => {
            console.error('Erro ao buscar assistentes/números:', err);
            return { ok: false, error: err };
          })
        );

        // Request 2: Follow-ups
        requests.push(
          fetch('https://sdr.salesdever.io/webhook/saas-buscar-follows-', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ tenant_id: tenantId })
          }).catch(err => {
            console.error('Erro ao buscar follow-ups:', err);
            return { ok: false, error: err };
          })
        );

        // Request 3: Instâncias
        requests.push(
          fetch('https://sdr.salesdever.io/webhook/saas-buscar-instancias', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ tenant_id: tenantId })
          }).catch(err => {
            console.error('Erro ao buscar instâncias:', err);
            return { ok: false, error: err };
          })
        );

        const [campanhasResponse, followupsResponse, instancesResponse] = await Promise.all(requests);

        // Processar Assistentes E Números
        if (campanhasResponse && campanhasResponse.ok) {
          try {
            const data = await campanhasResponse.json();

            // DEBUG DETALHADO - Estrutura completa da resposta
            console.log('[DEBUG] ========================================');
            console.log('[DEBUG] ESTRUTURA COMPLETA DA RESPOSTA:');
            console.log('[DEBUG] ========================================');
            console.log(JSON.stringify(data, null, 2));
            console.log('[DEBUG] ========================================');
            console.log('[DEBUG] Tipo da resposta:', typeof data);
            console.log('[DEBUG] É array?', Array.isArray(data));
            if (!Array.isArray(data)) {
              console.log('[DEBUG] Chaves disponíveis:', Object.keys(data));
            }
            console.log('[DEBUG] ========================================');

            // O n8n retorna um array mesclado com assistentes e números juntos
            // Precisamos separar por campos identificadores
            let mergedArray = [];

            // Se a resposta for array direto (caso do n8n merge)
            if (Array.isArray(data)) {
              console.log('[DEBUG] Resposta é array direto (merge do n8n)');
              mergedArray = data;
            }
            // Se vier em propriedades separadas
            else if (data.assistants || data.assistentes || data.numbers || data.numeros) {
              console.log('[DEBUG] Resposta com propriedades separadas');
              const assistantsList = data.assistants || data.assistentes || [];
              const numbersList = data.numbers || data.numeros || [];
              mergedArray = [...assistantsList, ...numbersList];
            }

            console.log('[DEBUG] Total de itens no array mesclado:', mergedArray.length);

            // Separar assistentes de números baseado nos campos
            // Assistentes têm campos como: assistant_id, assistant_name, name, prompt, etc
            // Números têm campos como: number, phone_number, phone, etc
            assistantsData = mergedArray.filter(item => {
              // Identificar assistentes por campos únicos
              const isAssistant = item.assistant_id ||
                                  item.assistant_name ||
                                  item.prompt ||
                                  item.system_message ||
                                  (item.name && !item.number && !item.phone_number && !item.phone);

              if (isAssistant) {
                console.log('[DEBUG] Item identificado como ASSISTENTE:', item);
              }
              return isAssistant;
            });

            numbersData = mergedArray.filter(item => {
              // IMPORTANTE: Se tem number_name E phone_number, é um NÚMERO!
              const isNumber = (item.number_name && item.phone_number);

              if (isNumber) {
                console.log('[DEBUG] Item identificado como NÚMERO:', item);
              }
              return isNumber;
            });

            console.log('[DEBUG] Total de assistentes separados:', assistantsData.length);
            console.log('[DEBUG] Total de números separados:', numbersData.length);
            console.log('[DEBUG] Assistentes completos:', assistantsData);
            console.log('[DEBUG] Números completos:', numbersData);

            populateAssistants();
            populateNumbers();

            console.log('[SUCCESS] ✅ Assistentes carregados:', assistantsData.length);
            console.log('[SUCCESS] ✅ Números carregados:', numbersData.length);

            // Se não houver dados, mostrar mensagem informativa (não erro)
            if (assistantsData.length === 0 && numbersData.length === 0) {
              console.log('[INFO] Nenhum assistente ou número encontrado - pode ser uma conta nova');
              console.log('[INFO] Verifique os logs acima para ver a estrutura retornada pelo webhook');
            }
          } catch (err) {
            console.error('[ERROR] Erro ao processar assistentes/números:', err);
            console.error('[ERROR] Stack trace:', err.stack);
          }
        } else {
          console.log('[INFO] Não foi possível carregar assistentes/números - pode ser uma conta nova ou sem dados configurados');
          if (campanhasResponse) {
            console.log('[DEBUG] Status da resposta:', campanhasResponse.status);
            console.log('[DEBUG] Status text:', campanhasResponse.statusText);
          }
        }

        // Processar Follow-ups
        if (followupsResponse && followupsResponse.ok) {
          try {
            const data = await followupsResponse.json();
            console.log('[DEBUG] 📋 Follow-ups recebidos (raw):', data);
            const dataArray = Array.isArray(data) ? data : [data];
            console.log('[DEBUG] 📋 Total de follow-ups recebidos:', dataArray.length);

            // Filtrar apenas follow-ups do tenant correto e tipo webhook
            followupsData = dataArray.filter(f => {
              const isSameTenant = f.tenant_id === tenantId;
              const isWebhook = f.follow_up_type && f.follow_up_type.toLowerCase() === 'webhook';
              console.log(`[DEBUG] 📋 Follow-up "${f.strategy_name}":`, {
                tenant_match: isSameTenant,
                type: f.follow_up_type,
                is_webhook: isWebhook,
                included: isSameTenant && isWebhook
              });
              return isSameTenant && isWebhook;
            }).map((f, index) => {
              // Usar follow_up_id como ID principal
              return {
                ...f,
                _uuid: f.follow_up_id || generateUUID(),
                _originalId: f.follow_up_id,
                _index: index
              };
            });

            console.log('[DEBUG] 📋 Follow-ups filtrados:', followupsData.length);
            console.log('[DEBUG] 📋 Follow-ups que serão populados:', followupsData);

            populateFollowups();
            console.log('[SUCCESS] ✅ Follow-ups carregados no select:', followupsData.length);
          } catch (err) {
            console.error('[ERROR] ❌ Erro ao processar follow-ups:', err);
          }
        } else {
          console.warn('[WARNING] ⚠️ Falha ao carregar follow-ups - Response não OK');
        }

        // Processar Instâncias
        if (instancesResponse && instancesResponse.ok) {
          try {
            const data = await instancesResponse.json();
            console.log('[DEBUG] Instâncias recebidas:', data);

            instancesData = Array.isArray(data) ? data : [data];
            populateInstances();
            console.log('[SUCCESS] Instâncias carregadas:', instancesData.length);
          } catch (err) {
            console.error('[ERROR] Erro ao processar instâncias:', err);
          }
        } else {
          console.warn('[WARNING] Falha ao carregar instâncias');
        }

        // Verificar se pelo menos um tipo de dado foi carregado
        // Mudança: apenas aviso no console se não houver dados, não erro para o usuário
        if (assistantsData.length === 0 && numbersData.length === 0 && followupsData.length === 0 && instancesData.length === 0) {
          console.log('[INFO] Nenhum dado foi carregado. Isso é normal para contas novas. Configure seus dados antes de criar webhooks.');
        }

      } catch (error) {
        console.error('[ERROR] Erro ao carregar dados do webhook:', error);
        showPopup('error', 'Erro!', 'Erro ao carregar dados. Tente novamente.');
      }
    }

    function populateAssistants() {
      const select = document.getElementById('webhookAssistant');
      select.innerHTML = '<option value="">Selecione um assistente</option>';

      console.log('[DEBUG] Populando assistentes. Total:', assistantsData.length);

      assistantsData.forEach((assistant, index) => {
        console.log(`[DEBUG] Assistente ${index} - OBJETO COMPLETO:`, JSON.stringify(assistant, null, 2));

        const option = document.createElement('option');
        // Verificar todas as possíveis propriedades de ID
        const assistantId = assistant.assistente_id || assistant.assistant_id || assistant.id;
        const assistantName = assistant.name || assistant.assistant_name || 'Assistente sem nome';

        console.log(`[DEBUG] assistente_id: ${assistant.assistente_id}, assistant_id: ${assistant.assistant_id}, id: ${assistant.id}`);
        console.log(`[DEBUG] ID SELECIONADO: ${assistantId}`);

        option.value = assistantId;
        option.textContent = assistantName;

        // Adicionar data attributes para consistência com outros selects
        option.setAttribute('data-assistant-id', assistantId);
        option.setAttribute('data-assistant-name', assistantName);

        select.appendChild(option);

        console.log(`[DEBUG] Opção criada - value: ${assistantId}, text: ${assistantName}`);
      });

      console.log('[SUCCESS] Assistentes populados no select');
    }

    function populateNumbers() {
      const select = document.getElementById('webhookPhone');

      console.log('[DEBUG] Populando números:', numbersData);

      // Limpar opções existentes
      select.innerHTML = '<option value="">Selecione um número</option>';

      if (!numbersData || numbersData.length === 0) {
        console.warn('[WARNING] Nenhum número disponível para popular');
        const noDataOption = document.createElement('option');
        noDataOption.value = '';
        noDataOption.textContent = 'Nenhum número disponível';
        noDataOption.disabled = true;
        select.appendChild(noDataOption);
        return;
      }

      numbersData.forEach(number => {
        console.log('[DEBUG] Processando número:', number);
        const option = document.createElement('option');
        // Usar number_id como value
        option.value = number.number_id || number.id;
        // Mostrar number_name e phone_number
        option.textContent = `${number.number_name} (${number.phone_number.trim()})`;
        option.setAttribute('data-number-id', number.number_id || number.id);
        option.setAttribute('data-number-name', number.number_name);
        option.setAttribute('data-number-value', number.phone_number);
        select.appendChild(option);
      });

      console.log('[SUCCESS] Números populados no select');
    }

    function populateInstances() {
      const select = document.getElementById('webhookInstance');

      console.log('[DEBUG] Populando instâncias:', instancesData);

      // Limpar opções existentes
      select.innerHTML = '<option value="">Selecione uma instância</option>';

      if (!instancesData || instancesData.length === 0) {
        console.warn('[WARNING] Nenhuma instância disponível para popular');
        const noDataOption = document.createElement('option');
        noDataOption.value = '';
        noDataOption.textContent = 'Nenhuma instância disponível';
        noDataOption.disabled = true;
        select.appendChild(noDataOption);
        return;
      }

      instancesData.forEach(instance => {
        console.log('[DEBUG] Processando instância:', instance);
        const option = document.createElement('option');
        // Usar o ID ou instance_key como value
        const instanceId = instance.id || instance.instance_key || instance.instance_id;
        const instanceName = instance.name || instance.instance_name || instance.instance_key || 'Instância sem nome';

        option.value = instanceId;
        option.textContent = instanceName;
        option.setAttribute('data-instance-id', instanceId);
        option.setAttribute('data-instance-name', instanceName);
        select.appendChild(option);
      });

      console.log('[SUCCESS] Instâncias populadas no select');
    }

    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function generateUniqueWebhookPath() {
      // Gerar um path único e humanamente legível
      // Formato: wh_[data]_[12-caracteres-aleatorios]
      // Exemplo: wh_20231016_a1b2c3d4e5f6

      const prefix = 'wh';

      // Data no formato YYYYMMDD (ex: 20231016)
      const date = new Date().toISOString().split('T')[0].replace(/-/g, '');

      // 12 caracteres aleatórios usando crypto (mais seguro que Math.random)
      const random = crypto.randomUUID().replace(/-/g, '').substring(0, 12);

      // Combinar em um path legível e único
      const webhookPath = `${prefix}_${date}_${random}`;

      console.log('[DEBUG] Webhook Path gerado:', webhookPath);
      return webhookPath;
    }


    function populateFollowups() {
      const select = document.getElementById('webhookFollowup');

      console.log('[DEBUG] Populando follow-ups:', followupsData);

      // Filtrar apenas follow-ups WEBHOOK
      const webhookFollowups = followupsData.filter(f =>
        f.follow_up_type && f.follow_up_type.toLowerCase() === 'webhook'
      );
      console.log('[DEBUG] Follow-ups webhook filtrados:', webhookFollowups);

      select.innerHTML = '<option value="">Selecione um follow-up webhook</option>';

      if (!webhookFollowups || webhookFollowups.length === 0) {
        console.warn('[WARNING] Nenhum follow-up webhook disponível');
        const noDataOption = document.createElement('option');
        noDataOption.value = '';
        noDataOption.textContent = 'Nenhum follow-up webhook disponível';
        noDataOption.disabled = true;
        select.appendChild(noDataOption);
        return;
      }

      webhookFollowups.forEach(followup => {
        console.log('[DEBUG] Processando follow-up webhook:', followup);
        const option = document.createElement('option');
        option.value = followup.follow_up_id || followup.id || followup._uuid;
        option.textContent = followup.strategy_name || followup.nome_followup || followup.name || 'Follow-up sem nome';
        option.setAttribute('data-followup-id', followup.follow_up_id || followup.id);
        option.setAttribute('data-followup-name', followup.strategy_name || followup.nome_followup || followup.name);
        select.appendChild(option);
      });

      console.log('[SUCCESS] Follow-ups webhook populados no select:', webhookFollowups.length);
    }

    function formatPhoneNumber(phoneNumber) {
      if (!phoneNumber) return '';

      const phone = phoneNumber.toString();
      if (phone.length === 13 && phone.startsWith('55')) {
        const area = phone.substring(2, 4);
        const number = phone.substring(4);
        return `+55 ${area} ${number.substring(0, 5)}-${number.substring(5)}`;
      } else if (phone.length === 12 && phone.startsWith('55')) {
        const area = phone.substring(2, 4);
        const number = phone.substring(4);
        return `+55 ${area} ${number.substring(0, 4)}-${number.substring(4)}`;
      }

      return `+${phone}`;
    }

    function hideWebhookForm() {
      document.getElementById('webhookForm').style.display = 'none';
      document.getElementById('webhooksList').style.display = 'block';

      // Reset form
      document.getElementById('createWebhookForm').reset();

      // Reset webhook success display
      document.getElementById('webhookSuccessDisplay').style.display = 'none';
      document.getElementById('webhookFormContent').style.display = 'block';
    }

    function displayWebhookSuccess(webhookName, webhookUrl) {
      // Ocultar formulário e mostrar display de sucesso
      document.getElementById('webhookFormContent').style.display = 'none';

      const successDisplay = document.getElementById('webhookSuccessDisplay');
      const nameElement = document.getElementById('webhookSuccessName');
      const urlInput = document.getElementById('webhookUrlDisplay');

      // Preencher dados
      nameElement.textContent = webhookName;
      urlInput.value = webhookUrl;

      // Mostrar com animação
      successDisplay.style.display = 'block';

      // Recarregar lista de webhooks em background
      loadExistingWebhooks();
    }

    function copyWebhookUrl() {
      const urlInput = document.getElementById('webhookUrlDisplay');
      const copyBtn = document.getElementById('copyWebhookBtn');
      const copyIcon = copyBtn.querySelector('.copy-icon');
      const checkIcon = copyBtn.querySelector('.check-icon');
      const copyText = copyBtn.querySelector('.copy-text');

      // Copiar para clipboard
      urlInput.select();
      urlInput.setSelectionRange(0, 99999); // Para mobile

      navigator.clipboard.writeText(urlInput.value).then(() => {
        // Feedback visual
        copyBtn.classList.add('copied');
        copyIcon.style.display = 'none';
        checkIcon.style.display = 'block';
        copyText.textContent = 'Copiado!';

        // Resetar após 2 segundos
        setTimeout(() => {
          copyBtn.classList.remove('copied');
          copyIcon.style.display = 'block';
          checkIcon.style.display = 'none';
          copyText.textContent = 'Copiar';
        }, 2000);
      }).catch(err => {
        console.error('Erro ao copiar:', err);
        showPopup('error', 'Erro!', 'Não foi possível copiar o webhook.');
      });
    }

    function createAnotherWebhook() {
      // Ocultar display de sucesso e mostrar formulário novamente
      document.getElementById('webhookSuccessDisplay').style.display = 'none';
      document.getElementById('webhookFormContent').style.display = 'block';
    }

    // First Contact Configuration Functions
    function updateFirstContactDelay(value) {
      document.getElementById('firstContactDelayValue').textContent = value;
    }

    function toggle24Hours(isChecked) {
      const startInput = document.getElementById('workingHoursStart');
      const endInput = document.getElementById('workingHoursEnd');
      const container = document.getElementById('timeInputsContainer');

      if (isChecked) {
        // Atendimento 24h
        startInput.value = '00:00';
        endInput.value = '23:59';
        startInput.disabled = true;
        endInput.disabled = true;
        container.style.opacity = '0.5';
        container.style.pointerEvents = 'none';
      } else {
        // Voltar ao horário padrão
        startInput.value = '08:00';
        endInput.value = '22:00';
        startInput.disabled = false;
        endInput.disabled = false;
        container.style.opacity = '1';
        container.style.pointerEvents = 'auto';
      }
    }

    function toggleVariablesAccordion(header) {
      const accordion = header.closest('.variables-accordion');
      const content = accordion.querySelector('.variables-accordion-content');
      const chevron = header.querySelector('.variables-chevron');
      const isExpanded = content.style.maxHeight && content.style.maxHeight !== '0px';

      if (isExpanded) {
        // Collapse
        content.style.maxHeight = '0';
        chevron.style.transform = 'rotate(0deg)';
        header.style.background = 'rgba(165, 148, 255, 0.08)';
      } else {
        // Expand
        content.style.maxHeight = content.scrollHeight + 'px';
        chevron.style.transform = 'rotate(180deg)';
        header.style.background = 'rgba(165, 148, 255, 0.15)';
      }
    }

    // Variável para garantir que só anexamos o listener uma vez
    let formListenerAttached = false;

    // Função para anexar o listener ao formulário
    function attachFormListener() {
      console.log('🟡 [DIAGNÓSTICO] attachFormListener() CHAMADA!');

      if (formListenerAttached) {
        console.log('🔵 [DIAGNÓSTICO] Listener já foi anexado anteriormente, pulando...');
        return;
      }

      const createWebhookForm = document.getElementById('createWebhookForm');
      console.log('🔵 [DIAGNÓSTICO] attachFormListener() - Formulário encontrado?', !!createWebhookForm);
      console.log('🔵 [DIAGNÓSTICO] Formulário objeto:', createWebhookForm);

      if (!createWebhookForm) {
        console.error('❌ [DIAGNÓSTICO] Formulário createWebhookForm NÃO foi encontrado!');
        return;
      }

      console.log('✅ [DIAGNÓSTICO] Anexando event listener ao formulário...');
      formListenerAttached = true;

      createWebhookForm.addEventListener('submit', async function(e) {
        e.preventDefault();

        console.log('🔵 [DIAGNÓSTICO] Event listener disparado!');
        console.log('🔵 [DIAGNÓSTICO] userData existe?', !!userData);
        console.log('🔵 [DIAGNÓSTICO] userData.user existe?', !!userData?.user);
        console.log('🔵 [DIAGNÓSTICO] tenant_id existe?', userData?.user?.tenant_id);

          try {
            // Coletar dados do formulário
            const webhookName = document.getElementById('webhookName').value;
            console.log('🔵 [DIAGNÓSTICO] webhookName:', webhookName);

            // Pegar os selects
            const followupSelect = document.getElementById('webhookFollowup');
            const assistantSelect = document.getElementById('webhookAssistant');
            const phoneSelect = document.getElementById('webhookPhone');
            const instanceSelect = document.getElementById('webhookInstance');

            console.log('🔵 [DIAGNÓSTICO] Valores dos selects:');
            console.log('  - followupSelect.value:', followupSelect?.value);
            console.log('  - assistantSelect.value:', assistantSelect?.value);
            console.log('  - phoneSelect.value:', phoneSelect?.value);
            console.log('  - instanceSelect.value:', instanceSelect?.value);

            // Validações
            if (!webhookName || !followupSelect.value || !assistantSelect.value || !phoneSelect.value || !instanceSelect.value) {
              console.log('❌ [DIAGNÓSTICO] Validação FALHOU! Campos vazios detectados.');
              console.log('  - webhookName vazio?', !webhookName);
              console.log('  - followupSelect vazio?', !followupSelect.value);
              console.log('  - assistantSelect vazio?', !assistantSelect.value);
              console.log('  - phoneSelect vazio?', !phoneSelect.value);
              console.log('  - instanceSelect vazio?', !instanceSelect.value);
              showPopup('error', 'Atenção!', 'Por favor, preencha todos os campos obrigatórios.');
              return;
            }

            console.log('✅ [DIAGNÓSTICO] Validação passou! Todos os campos preenchidos.');

            // Pegar os IDs dos selects
            const followupId = followupSelect.value;
            const assistantId = assistantSelect.selectedOptions[0].getAttribute('data-assistant-id');
            const numberId = phoneSelect.value;
            const instanceId = instanceSelect.value;

            // Pegar os NOMES dos selects
            const followupName = followupSelect.selectedOptions[0].getAttribute('data-followup-name') || followupSelect.selectedOptions[0].textContent;
            const assistantName = assistantSelect.selectedOptions[0].getAttribute('data-assistant-name') || assistantSelect.selectedOptions[0].textContent;
            const numberName = phoneSelect.selectedOptions[0].getAttribute('data-number-name');
            const actualNumberValue = phoneSelect.selectedOptions[0].getAttribute('data-number-value');
            const instanceName = instanceSelect.selectedOptions[0].getAttribute('data-instance-name');

            // Gerar path único para o webhook
            const webhookPath = generateUniqueWebhookPath();

            // Montar webhook URL completo
            const webhookBaseUrl = 'https://sdr.salesdever.io/webhook/1ae4a0f7-b7ce-43a1-9c1f-b7c49546f86c/';
            const webhookUrl = webhookBaseUrl + webhookPath;

            // Debug: verificar dados capturados
            console.log('[DEBUG] Dados capturados:', {
              webhookName,
              followupId,
              followupName,
              assistantId,
              assistantName,
              numberId,
              numberName,
              actualNumberValue,
              instanceId,
              instanceName,
              webhookPath,
              webhookUrl
            });

            // Coletar variáveis mapeadas
            const mappedVariables = getWebhookMappedVariables();
            console.log('🔵 [DIAGNÓSTICO] Variáveis mapeadas:', mappedVariables);

            // Validar variáveis de telefone (APENAS se houver variáveis criadas)
            if (mappedVariables.length > 0) {
              const phoneVariables = mappedVariables.filter(v => v.type === 'telefone');
              console.log('🔵 [DIAGNÓSTICO] Variáveis de telefone encontradas:', phoneVariables.length);

              // Se tem variáveis mas não tem telefone, avisar
              if (phoneVariables.length === 0) {
                console.log('⚠️ [AVISO] Você criou variáveis mas nenhuma é do tipo telefone. Isso pode limitar a personalização.');
                console.log('💡 [DICA] Considere adicionar uma variável do tipo "Telefone" para enviar o número do lead via webhook.');
              }

              // Se tem mais de 1 telefone, bloquear
              if (phoneVariables.length > 1) {
                console.log('❌ [DIAGNÓSTICO] MÚLTIPLAS variáveis de telefone encontradas:', phoneVariables.length);
                showPopup('error', 'Apenas 1 Telefone!', 'Você só pode mapear 1 telefone para contato. Detectamos ' + phoneVariables.length + ' telefones mapeados. Por favor, mantenha apenas 1 como tipo "Telefone" e altere os demais para tipo "Número".');
                return;
              }

              if (phoneVariables.length === 1) {
                console.log('✅ [DIAGNÓSTICO] Validação de telefone passou! Exatamente 1 telefone mapeado.');
              }
            } else {
              console.log('ℹ️ [INFO] Nenhuma variável customizada criada. Isso é opcional - o webhook funcionará normalmente.');
            }

            // Coletar configuração de tempo de espera para primeiro contato
            const firstContactDelay = document.getElementById('firstContactDelay').value;

            // Coletar horários de atendimento
            const is24Hours = document.getElementById('is24Hours').checked;
            const workingHoursStart = document.getElementById('workingHoursStart').value;
            const workingHoursEnd = document.getElementById('workingHoursEnd').value;

            // Payload com IDs, NOMES, webhook_path e webhook_url completo
            const webhookPayload = {
              webhook_name: webhookName,
              webhook_path: webhookPath,
              webhook_url: webhookUrl,
              followup_id: followupId,
              followup_name: followupName,
              assistant_id: assistantId,
              assistant_name: assistantName,
              number_id: numberId,
              number_name: numberName,
              actual_number_value: actualNumberValue,
              instance_id: instanceId,
              instance_name: instanceName,
              tenant_id: userData.user.tenant_id,
              created_at: new Date().toISOString(),
              custom_variables: mappedVariables,
              first_contact_delay: parseInt(firstContactDelay),
              is_24_hours: is24Hours,
              working_hours_start: workingHoursStart,
              working_hours_end: workingHoursEnd
            };

            console.log('🚀 Webhook Payload:', webhookPayload);
            console.log('📋 Variáveis Mapeadas:', mappedVariables);
            console.log('⏱️ Delay Primeiro Contato:', firstContactDelay + ' minutos');
            console.log('🕐 Horário de Atendimento:', is24Hours ? '24 horas' : workingHoursStart + ' - ' + workingHoursEnd);

            console.log('✅ [DIAGNÓSTICO] Todas as validações passaram! Preparando para enviar webhook...');

            // Ativar estado de loading no botão
            const submitBtn = document.getElementById('generateWebhookBtn');
            const btnIcon = submitBtn.querySelector('.webhook-icon');
            const btnSpinner = submitBtn.querySelector('.webhook-spinner');
            const btnText = submitBtn.querySelector('.webhook-btn-text');

            console.log('🔵 [DIAGNÓSTICO] Elementos do botão encontrados:', {
              submitBtn: !!submitBtn,
              btnIcon: !!btnIcon,
              btnSpinner: !!btnSpinner,
              btnText: !!btnText
            });

            submitBtn.disabled = true;
            btnIcon.style.display = 'none';
            btnSpinner.style.display = 'block';
            btnText.textContent = 'Criando...';

            console.log('🚀 [DIAGNÓSTICO] Iniciando chamada ao webhook...');
            console.log('🚀 [DIAGNÓSTICO] URL:', 'https://sdr.salesdever.io/webhook/cria_webhook');

            // Enviar para o webhook
            try {
              const response = await fetch('https://sdr.salesdever.io/webhook/cria_webhook', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(webhookPayload)
              });

              const result = await response.json();
              console.log('[DEBUG] Resposta do webhook:', result);

              if (response.ok) {
                // Usar o webhook_url retornado pelo servidor
                const returnedWebhookUrl = result.webhook_url || webhookUrl;

                console.log('[SUCCESS] Webhook criado! URL:', returnedWebhookUrl);

                // Sucesso - Exibir o componente destacado com o webhook
                displayWebhookSuccess(webhookName, returnedWebhookUrl);

                // Reset form
                document.getElementById('createWebhookForm').reset();
              } else {
                // Erro retornado pelo servidor
                throw new Error(result.message || result.error || 'Erro ao criar webhook');
              }

            } catch (error) {
              console.error('❌ [DIAGNÓSTICO] ERRO no fetch/processamento:', error);
              console.error('❌ [DIAGNÓSTICO] Stack trace:', error.stack);
              showPopup('error', 'Erro ao Criar Webhook', error.message || 'Não foi possível criar o webhook. Tente novamente.');
            } finally {
              console.log('🔵 [DIAGNÓSTICO] Resetando estado do botão...');
              // Resetar estado do botão
              submitBtn.disabled = false;
              btnIcon.style.display = 'block';
              btnSpinner.style.display = 'none';
              btnText.textContent = 'Gerar Webhook';
            }

          } catch (error) {
            console.error('❌ [DIAGNÓSTICO] ERRO GERAL no try/catch externo:', error);
            console.error('❌ [DIAGNÓSTICO] Stack trace:', error.stack);
            showPopup('error', 'Erro!', 'Erro ao criar webhook. Tente novamente.');
          }
      });
    }

    // Anexar listener quando DOM carregar
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🔵 [DIAGNÓSTICO] DOMContentLoaded disparado, tentando anexar listener...');
      attachFormListener();
    });

    function loadUserData() {
      try {
        console.log('[DEBUG] 🔍 Tentando carregar userData do localStorage...');
        
        // Tentar múltiplas chaves do localStorage
        let storedData = localStorage.getItem('userData') || 
                        localStorage.getItem('finalSelections') ||
                        localStorage.getItem('user') ||
                        localStorage.getItem('loginData');
        
        console.log('[DEBUG] 📦 Dados encontrados:', storedData ? 'SIM' : 'NÃO');
        
        if (!storedData) {
          console.error('[DEBUG] ❌ Nenhum dado encontrado no localStorage');
          console.log('[DEBUG] 📋 Tentando buscar dados individuais...');
          
          // Tentar pegar dados individuais
          const email = localStorage.getItem('userEmail');
          const tenantId = localStorage.getItem('tenant_id');
          
          if (email && tenantId) {
            console.log('[DEBUG] ✅ Dados individuais encontrados, montando userData');
            userData = {
              user: {
                email: email,
                tenant_id: tenantId,
                id: localStorage.getItem('user_id') || tenantId
              }
            };
            console.log('[DEBUG] ✅ userData montado:', userData);
            return true;
          }
          
          showError('Dados de usuário não encontrados. Faça login novamente.');
          return false;
        }

        const parsed = JSON.parse(storedData);
        console.log('[DEBUG] ✅ Dados parseados:', parsed);
        
        // Tentar extrair tenant_id de múltiplas estruturas possíveis
        const tenantId = parsed?.tenant_id || 
                        parsed?.user?.tenant_id || 
                        parsed?.userData?.tenant_id ||
                        parsed?.[0]?.tenant_id ||
                        parsed?.[0]?.user?.tenant_id;
        
        const userEmail = parsed?.email ||
                         parsed?.user?.email ||
                         parsed?.userData?.email ||
                         parsed?.login ||
                         parsed?.[0]?.email;
        
        console.log('[DEBUG] 🔑 Tenant ID extraído:', tenantId);
        console.log('[DEBUG] 📧 Email extraído:', userEmail);
        
        if (!tenantId) {
          console.error('[DEBUG] ❌ tenant_id não encontrado na estrutura');
          showError('Dados incompletos. Faça login novamente.');
          return false;
        }
        
        // Criar estrutura normalizada
        userData = {
          user: {
            tenant_id: tenantId,
            email: userEmail || 'usuario@email.com',
            id: parsed?.id || parsed?.user?.id || tenantId,
            nome: parsed?.nome || parsed?.user?.nome || userEmail
          }
        };
        
        console.log('[DEBUG] ✅ userData normalizado:', userData);
        return true;
        
      } catch (error) {
        console.error('[DEBUG] ❌ Erro ao carregar dados do usuário:', error);
        console.error('[DEBUG] 📛 Stack:', error.stack);
        showError('Erro ao processar dados do usuário.');
        return false;
      }
    }

    window.addEventListener('load', () => {
      console.log('[DEBUG] 🚀 ========== PÁGINA CARREGADA ==========');
      console.log('[DEBUG] 📍 URL atual:', window.location.href);
      console.log('[DEBUG] 💾 localStorage keys:', Object.keys(localStorage));
      console.log('[DEBUG] 📦 Todos os dados do localStorage:');
      
      // Log de TODOS os itens do localStorage
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        console.log(`[DEBUG]   - ${key}:`, value?.substring(0, 100) + (value?.length > 100 ? '...' : ''));
      }
      
      console.log('[DEBUG] 🔄 Tentando carregar userData...');
      
      if (loadUserData()) {
        console.log('[DEBUG] ✅ userData carregado com sucesso!');
        console.log('[DEBUG] 📊 userData completo:', JSON.stringify(userData, null, 2));
        console.log('[DEBUG] 🔄 Carregando webhooks...');
        loadExistingWebhooks();
      } else {
        console.error('[DEBUG] ❌ Falha ao carregar userData');
        console.log('[DEBUG] ⏱️ Redirecionando para login em 3 segundos...');
        setTimeout(() => {
          console.log('[DEBUG] 🔄 Redirecionando...');
          window.location.href = 'login.html';
        }, 3000);
      }
    });

    // ============================================
    // VARIABLES PANEL FUNCTIONS
    // ============================================

    function openVariablesPanel() {
      const panel = document.getElementById('variablesSidePanel');
      panel.classList.add('active');
      document.body.style.overflow = 'hidden'; // Prevent scrolling
    }

    function closeVariablesPanel() {
      const panel = document.getElementById('variablesSidePanel');
      panel.classList.remove('active');
      document.body.style.overflow = ''; // Restore scrolling
    }

    // Handle form submission
    document.getElementById('createVariableForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const name = document.getElementById('variableName').value.trim();
      const type = document.getElementById('variableType').value;
      const description = document.getElementById('variableDescription').value.trim();
      const example = document.getElementById('variableExample').value.trim();

      if (!name || !type || !description) {
        alert('Por favor, preencha o nome, tipo e descrição da variável.');
        return;
      }

      // Validate variable name (only lowercase letters, numbers, and underscores)
      const validName = /^[a-z0-9_]+$/;
      if (!validName.test(name)) {
        alert('O nome da variável deve conter apenas letras minúsculas, números e underscores.');
        return;
      }

      // Validar se já existe uma variável do tipo telefone
      if (type === 'telefone') {
        const grid = document.getElementById('variablesGrid');
        const existingPhone = Array.from(grid.children).some(card =>
          card.getAttribute('data-variable-type') === 'telefone'
        );

        if (existingPhone) {
          alert('Atenção! Você só pode mapear 1 telefone para contato.\n\nJá existe um telefone mapeado. Se você precisa mapear outros números (telefone comercial, telefone do cônjuge, etc.), use o tipo "Número" ao invés de "Telefone".');
          return;
        }
      }

      // Create variable object
      const variable = {
        id: generateVariableId(),
        name: name,
        type: type,
        description: description,
        example: example || null,
        createdAt: new Date().toISOString()
      };

      // TODO: Save to backend
      console.log('Nova variável criada:', variable);

      // Add to variables list
      addVariableToList(variable);

      // Clear form
      document.getElementById('createVariableForm').reset();

      // Show success feedback
      showSuccessMessage('Variável criada com sucesso!');
    });

    function generateVariableId() {
      return 'var_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function addVariableToList(variable) {
      const grid = document.getElementById('variablesGrid');
      const emptyState = document.getElementById('variablesEmptyState');

      // Hide empty state if this is the first variable
      if (grid.children.length === 0) {
        emptyState.style.display = 'none';
        grid.style.display = 'flex';
      }

      // Create variable card
      const card = document.createElement('div');
      card.className = 'variable-card';
      card.setAttribute('data-variable-id', variable.id);
      card.setAttribute('data-variable-type', variable.type);

      // Define type icon and label
      const typeIconsSVG = {
        'telefone': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"></path></svg>',
        'nome': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
        'email': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>',
        'texto': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>',
        'numero': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;"><line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line></svg>',
        'data': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
        'outro': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>'
      };

      const typeLabels = {
        'telefone': 'Telefone',
        'nome': 'Nome',
        'email': 'Email',
        'texto': 'Texto',
        'numero': 'Número',
        'data': 'Data',
        'outro': 'Outro'
      };

      const typeIcon = typeIconsSVG[variable.type] || typeIconsSVG['outro'];
      const typeLabel = typeLabels[variable.type] || 'Outro';
      const isTelefone = variable.type === 'telefone';

      card.innerHTML = `
        <div class="variable-card-header">
          <div class="variable-tag">{{${variable.name}}}</div>
          <div class="variable-actions">
            <button class="variable-action-btn" onclick="copyVariable('${variable.name}')" title="Copiar variável">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
            </button>
            <button class="variable-action-btn delete" onclick="deleteVariable('${variable.id}')" title="Excluir variável">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </div>
        </div>
        <div style="margin-bottom: 0.5rem;">
          <span style="display: inline-block; background: ${isTelefone ? 'rgba(34, 197, 94, 0.15)' : 'rgba(165, 148, 255, 0.15)'}; color: ${isTelefone ? '#22C55E' : '#A594FF'}; padding: 0.25rem 0.65rem; border-radius: 0.4rem; font-size: 0.8rem; font-weight: 600; border: 1px solid ${isTelefone ? 'rgba(34, 197, 94, 0.3)' : 'rgba(165, 148, 255, 0.3)'};">
            ${typeIcon}${typeLabel}${isTelefone ? ' • Obrigatório' : ''}
          </span>
        </div>
        <div class="variable-description">${variable.description}</div>
        ${variable.example ? `<div class="variable-example">Exemplo: ${variable.example}</div>` : ''}
      `;

      grid.insertBefore(card, grid.firstChild); // Add to the top

      // Update count, preview and phone field availability
      updateVariablesCount();
      updateWebhookVariablesPreview();
      updatePhoneFieldAvailability();
    }

    function copyVariable(variableName) {
      const text = `{{${variableName}}}`;
      navigator.clipboard.writeText(text).then(() => {
        showSuccessMessage('Variável copiada!');
      }).catch(err => {
        console.error('Erro ao copiar:', err);
        alert('Erro ao copiar variável');
      });
    }

    function deleteVariable(variableId) {
      if (!confirm('Tem certeza que deseja excluir esta variável?')) {
        return;
      }

      const card = document.querySelector(`[data-variable-id="${variableId}"]`);
      if (card) {
        card.style.transition = 'all 0.3s ease';
        card.style.opacity = '0';
        card.style.transform = 'translateX(-20px)';

        setTimeout(() => {
          card.remove();

          // Show empty state if no variables left
          const grid = document.getElementById('variablesGrid');
          const emptyState = document.getElementById('variablesEmptyState');

          if (grid.children.length === 0) {
            grid.style.display = 'none';
            emptyState.style.display = 'block';
          }

          updateVariablesCount();
          updateWebhookVariablesPreview();
          updatePhoneFieldAvailability();
          showSuccessMessage('Variável excluída com sucesso!');
        }, 300);
      }

      // TODO: Delete from backend
      console.log('Variável deletada:', variableId);
    }

    function updateVariablesCount() {
      const grid = document.getElementById('variablesGrid');
      const count = grid.children.length;
      document.getElementById('variablesCount').textContent = count;
    }

    function updatePhoneFieldAvailability() {
      const grid = document.getElementById('variablesGrid');
      const variableTypeSelect = document.getElementById('variableType');

      if (!variableTypeSelect) return;

      // Verificar se já existe uma variável do tipo telefone
      const hasPhoneVariable = Array.from(grid.children).some(card =>
        card.getAttribute('data-variable-type') === 'telefone'
      );

      // Encontrar a opção de telefone
      const phoneOption = variableTypeSelect.querySelector('option[value="telefone"]');

      if (phoneOption) {
        if (hasPhoneVariable) {
          // Desabilitar e adicionar texto indicativo
          phoneOption.disabled = true;
          phoneOption.textContent = 'Telefone (já mapeado - limite: 1)';
          phoneOption.style.color = '#999';
        } else {
          // Habilitar novamente
          phoneOption.disabled = false;
          phoneOption.textContent = 'Telefone (obrigatório para contato)';
          phoneOption.style.color = '';
        }
      }
    }

    function updateWebhookVariablesPreview() {
      const grid = document.getElementById('variablesGrid');
      const preview = document.getElementById('webhookVariablesPreview');
      const tagsContainer = document.getElementById('webhookVariablesTags');

      if (grid.children.length === 0) {
        preview.style.display = 'none';
        return;
      }

      // Show preview
      preview.style.display = 'block';

      // Clear and rebuild tags
      tagsContainer.innerHTML = '';

      // Get all variables
      const variables = Array.from(grid.children).map(card => {
        const tag = card.querySelector('.variable-tag');
        return tag ? tag.textContent : '';
      }).filter(v => v);

      // Create tag elements
      variables.forEach(varName => {
        const tag = document.createElement('span');
        tag.style.cssText = `
          background: rgba(165, 148, 255, 0.2);
          color: #A594FF;
          padding: 0.35rem 0.75rem;
          border-radius: 0.5rem;
          font-size: 0.85rem;
          font-family: 'SF Mono', 'Monaco', monospace;
          font-weight: 600;
          border: 1px solid rgba(165, 148, 255, 0.3);
          display: inline-block;
        `;
        tag.textContent = varName;
        tagsContainer.appendChild(tag);
      });
    }

    function getWebhookMappedVariables() {
      const grid = document.getElementById('variablesGrid');

      // Array para armazenar as variáveis
      const variables = [];

      // Iterar por todos os cards de variáveis
      Array.from(grid.children).forEach(card => {
        const tagElement = card.querySelector('.variable-tag');
        const descriptionElement = card.querySelector('.variable-description');
        const exampleElement = card.querySelector('.variable-example');
        const variableType = card.getAttribute('data-variable-type');

        if (tagElement) {
          // Extrair o nome da variável (remover {{ e }})
          const fullTag = tagElement.textContent.trim();
          const variableName = fullTag.replace(/^\{\{/, '').replace(/\}\}$/, '');

          // Extrair descrição
          const description = descriptionElement ? descriptionElement.textContent.trim() : '';

          // Extrair exemplo (se existir)
          let exampleText = null;
          if (exampleElement) {
            exampleText = exampleElement.textContent.replace('Exemplo: ', '').trim();
          }

          // Criar objeto completo com tipo
          const variableObj = {
            variable: variableName,
            type: variableType || 'outro',
            description: description
          };

          // Adicionar exemplo apenas se existir
          if (exampleText) {
            variableObj.example = exampleText;
          }

          variables.push(variableObj);
        }
      });

      return variables;
    }

    function showSuccessMessage(message) {
      // Create temporary success message
      const msgDiv = document.createElement('div');
      msgDiv.style.cssText = `
        position: fixed;
        top: 2rem;
        right: 2rem;
        background: linear-gradient(135deg, #22C55E, #16A34A);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 16px rgba(34, 197, 94, 0.4);
        z-index: 100001;
        font-weight: 600;
        animation: slideInRight 0.3s ease;
      `;
      msgDiv.textContent = message;

      document.body.appendChild(msgDiv);

      setTimeout(() => {
        msgDiv.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => msgDiv.remove(), 300);
      }, 2000);
    }

    // Add CSS animation for success message
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInRight {
        from { transform: translateX(400px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(400px); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // Auto-format variable name as user types (lowercase, replace spaces with underscores)
    document.getElementById('variableName').addEventListener('input', function(e) {
      let value = e.target.value;
      value = value.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
      e.target.value = value;
    });

    // ============================================
    // POPUP FUNCTIONS
    // ============================================
    function showPopup(type, title, message) {
      const overlay = document.getElementById('popupOverlay');
      const popup = document.getElementById('popup');
      const icon = document.getElementById('popupIcon');
      const titleEl = document.getElementById('popupTitle');
      const messageEl = document.getElementById('popupMessage');
      const pathEl = document.getElementById('popupPath');

      // Remove classes anteriores
      popup.classList.remove('popup-success', 'popup-error');

      // Definir tipo
      if (type === 'success') {
        popup.classList.add('popup-success');
        pathEl.setAttribute('d', 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z');
      } else {
        popup.classList.add('popup-error');
        pathEl.setAttribute('d', 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z');
      }

      // Preencher conteúdo
      titleEl.textContent = title;
      messageEl.innerHTML = message;

      // Mostrar popup
      overlay.classList.add('show');
    }

    function closePopup() {
      const overlay = document.getElementById('popupOverlay');
      overlay.classList.remove('show');
    }

    // Fechar popup ao clicar no overlay
    document.getElementById('popupOverlay').addEventListener('click', function(e) {
      if (e.target === this) {
        closePopup();
      }
    });

    // ============================================
    // WEBHOOK DETAILS TOGGLE FUNCTIONS
    // ============================================
    function toggleWebhookDetails(webhookId) {
      const webhookCard = document.querySelector(`[data-webhook-id="${webhookId}"]`);
      if (!webhookCard) return;

      const detailsDiv = webhookCard.querySelector('.webhook-details-expanded');
      const button = webhookCard.querySelector(`[data-webhook-btn="${webhookId}"]`);
      const buttonText = button?.querySelector('.btn-text');

      if (!detailsDiv || !button || !buttonText) return;

      const isExpanded = detailsDiv.style.maxHeight && detailsDiv.style.maxHeight !== '0px';

      if (isExpanded) {
        // Fechar
        detailsDiv.style.maxHeight = '0px';
        buttonText.textContent = 'VER INFORMAÇÕES';
        button.classList.remove('expanded');
      } else {
        // Abrir - usar auto para altura dinâmica
        detailsDiv.style.maxHeight = 'none';

        // Aguardar um frame e então aplicar altura calculada
        requestAnimationFrame(() => {
          const realHeight = detailsDiv.scrollHeight;
          detailsDiv.style.maxHeight = '0px';

          requestAnimationFrame(() => {
            detailsDiv.style.maxHeight = realHeight + 'px';

            // Após a animação, deixar como auto para expansão dinâmica
            setTimeout(() => {
              if (detailsDiv.style.maxHeight !== '0px') {
                detailsDiv.style.maxHeight = 'none';
              }
            }, 400);
          });
        });
        buttonText.textContent = 'OCULTAR INFORMAÇÕES';
        button.classList.add('expanded');
      }
    }

    // ============================================
    // WEBHOOK LOGS FUNCTIONS
    // ============================================
    let currentWebhookId = null;

    function openWebhookLogs(webhookId) {
      currentWebhookId = webhookId;
      const overlay = document.getElementById('logsPopupOverlay');

      // Mostrar popup
      overlay.classList.add('show');

      // Carregar dados dos logs
      loadWebhookLogs(webhookId);
    }

    function closeLogsPopup() {
      const overlay = document.getElementById('logsPopupOverlay');
      overlay.classList.remove('show');
      currentWebhookId = null;
    }

    async function loadWebhookLogs(webhookId) {
      try {
        console.log('[LOGS] Carregando logs reais para webhook:', webhookId);

        // Verificar userData
        if (!userData || !userData.user || !userData.user.tenant_id) {
          console.error('[LOGS] userData não encontrado');
          showPopup('error', 'Erro!', 'Dados do usuário não encontrados. Faça login novamente.');
          return;
        }

        const tenantId = userData.user.tenant_id;

        // Mostrar loading nos stats
        document.getElementById('totalLeads').textContent = '...';
        document.getElementById('successfulLeads').textContent = '...';
        document.getElementById('failedLeads').textContent = '...';

        // Limpar tabela
        const tableBody = document.getElementById('logsTableBody');
        tableBody.innerHTML = '<div style="padding: 2rem; text-align: center; color: rgba(255, 255, 255, 0.6);">Carregando logs...</div>';

        // Primeiro, buscar o webhook para pegar o wh_path
        console.log('[LOGS] Buscando webhook para obter wh_path...');

        // Buscar todos os webhooks para encontrar o wh_path do webhook atual
        const webhooksResponse = await fetch('https://sdr.salesdever.io/webhook/procura_webhooks', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            tenant_id: tenantId
          })
        });

        let currentWebhookPath = null;

        if (webhooksResponse.ok) {
          const webhooksData = await webhooksResponse.json();
          const webhooks = Array.isArray(webhooksData) ? webhooksData : [];

          // Encontrar o webhook atual
          const currentWebhook = webhooks.find(wh =>
            (wh.id && wh.id.toString() === webhookId.toString()) ||
            (wh.webhook_id && wh.webhook_id.toString() === webhookId.toString())
          );

          if (currentWebhook) {
            currentWebhookPath = currentWebhook.webhook_url ?
              currentWebhook.webhook_url.split('/').pop() : // Extrair o path da URL
              currentWebhook.wh_path;

            console.log('[LOGS] Webhook encontrado:', currentWebhook);
            console.log('[LOGS] wh_path extraído:', currentWebhookPath);
          } else {
            console.warn('[LOGS] Webhook não encontrado para ID:', webhookId);
          }
        }

        // Se não conseguiu obter o wh_path, usar o ID como fallback
        if (!currentWebhookPath) {
          currentWebhookPath = webhookId;
          console.log('[LOGS] Usando webhook ID como wh_path fallback:', currentWebhookPath);
        }

        // Agora buscar os leads e logs usando os webhooks reais
        const [leadsResponse, logsResponse] = await Promise.allSettled([
          // Webhook de leads
          fetch('https://sdr.salesdever.io/webhook/leads_webhook_saas', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              tenant_id: tenantId
            })
          }),
          // Webhook de logs
          fetch('https://sdr.salesdever.io/webhook/logs_webhook_saas', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              tenant_id: tenantId
            })
          })
        ]);

        console.log('[LOGS] Respostas dos webhooks:', {
          leads: leadsResponse.status,
          logs: logsResponse.status
        });

        let allLeads = [];
        let allLogs = [];

        // Processar resposta de leads
        if (leadsResponse.status === 'fulfilled' && leadsResponse.value.ok) {
          try {
            const leadsData = await leadsResponse.value.json();
            console.log('[LOGS] Dados de leads recebidos:', leadsData);

            allLeads = Array.isArray(leadsData) ? leadsData : [];

            // Debug: mostrar wh_paths únicos nos leads
            const uniqueWhPaths = [...new Set(allLeads.map(lead => lead.wh_path))];
            console.log('[LOGS] 🎯 wh_paths únicos encontrados nos leads:', uniqueWhPaths);
            console.log('[LOGS] 🎯 wh_path procurado:', currentWebhookPath);
            console.log('[LOGS] 🎯 Total de leads antes do filtro:', allLeads.length);

            // Filtrar leads por wh_path do webhook atual
            const filteredLeads = allLeads.filter(lead => {
              const leadWhPath = lead.wh_path;
              const matches = leadWhPath === currentWebhookPath;

              if (matches) {
                console.log('[LOGS] ✅ Lead correspondente encontrado:', {
                  lead_wh_path: leadWhPath,
                  current_wh_path: currentWebhookPath,
                  lead_data: lead
                });
              }

              return matches;
            });

            allLeads = filteredLeads;
            allLeadsData = allLeads; // Armazenar na variável global
            console.log('[LOGS] 🔍 Total de leads filtrados para este webhook:', allLeads.length);
            console.log('[LOGS] 🔍 Amostra dos leads filtrados:', allLeads.slice(0, 2));

            // Se não encontrou nenhum lead, mostrar informação útil e tentar fallback
            if (allLeads.length === 0 && uniqueWhPaths.length > 0) {
              console.warn('[LOGS] ⚠️ Nenhum lead encontrado para wh_path:', currentWebhookPath);
              console.warn('[LOGS] ⚠️ wh_paths disponíveis:', uniqueWhPaths);

              // FALLBACK: Se não encontrou leads específicos para este webhook,
              // mostrar pelo menos alguns leads de exemplo (primeiros 5)
              console.log('[LOGS] 🔄 Aplicando fallback - mostrando leads de exemplo');
              const leadsBackup = Array.isArray(leadsData) ? leadsData.slice(0, 5) : [];
              allLeads = leadsBackup;
              allLeadsData = allLeads; // Armazenar na variável global
              console.log('[LOGS] 🔄 Fallback aplicado com', allLeads.length, 'leads');
            }
          } catch (error) {
            console.error('[LOGS] Erro ao processar dados de leads:', error);
          }
        } else {
          console.warn('[LOGS] Falha ao obter leads:', leadsResponse.reason || leadsResponse.value?.statusText);
        }

        // Processar resposta de logs
        if (logsResponse.status === 'fulfilled' && logsResponse.value.ok) {
          try {
            const logsData = await logsResponse.value.json();
            console.log('[LOGS] Dados de logs recebidos:', logsData);
            allLogs = Array.isArray(logsData) ? logsData : [];
          } catch (error) {
            console.error('[LOGS] Erro ao processar dados de logs:', error);
          }
        } else {
          console.warn('[LOGS] Falha ao obter logs:', logsResponse.reason || logsResponse.value?.statusText);
        }

        // Calcular métricas baseadas nos dados reais
        const totalLeads = allLeads.length;

        console.log('[LOGS] ========== MÉTRICAS ==========');
        console.log('[LOGS] Total de leads filtrados para este webhook:', totalLeads);
        console.log('[LOGS] Leads completos:', allLeads);

        // Total de interações = somar apenas os campos de contato que estão como "true"
        // Todos os campos de contato conforme especificado pelo usuário na imagem
        const contactFields = [
          'd0_1st', 'd0_30min', 'd0_3horas',
          'd1_9_00', 'd1_12_30', 'd1_19_00',
          'd3_8_00', 'd3_12_30', 'd3_20_00',
          'd5_9_00', 'd5_11_00', 'd5_16_00',
          'd7_11_00', 'd7_17_00', 'd7_20_00',
          'd10_16_00'
        ];

        const totalInteractions = allLeads.reduce((sum, lead) => {
          // Contar apenas os campos de contato que estão como true
          const trueContactsCount = contactFields.filter(field => lead[field] === true).length;

          console.log('[LOGS] Lead:', lead.nome || lead.telefone, 'Contatos true:', trueContactsCount, {
            contacts: contactFields.filter(field => lead[field] === true)
          });

          return sum + trueContactsCount;
        }, 0);

        // Total de falhas vem dos logs (configuração futura - por enquanto 0)
        const totalFailures = 0; // Será configurado quando o webhook de logs estiver funcionando

        // Armazenar total de interações na variável global
        totalInteractionsCalculated = totalInteractions;

        console.log('[LOGS] ========== MÉTRICAS FINAIS ==========');
        console.log('[LOGS] Total de Leads:', totalLeads);
        console.log('[LOGS] Total de Interações:', totalInteractions);
        console.log('[LOGS] Total de Falhas:', totalFailures);
        console.log('[LOGS] ==========================================');

        // Debug das métricas calculadas
        console.log('[LOGS] 🔢 Atualizando métricas:', {
          totalLeads,
          totalInteractions,
          totalFailures
        });

        // Atualizar as métricas no dashboard
        console.log('[LOGS] 🎯 FORÇANDO atualização das métricas no DOM...');
        const totalLeadsEl = document.getElementById('totalLeads');
        const successfulLeadsEl = document.getElementById('successfulLeads');
        const failedLeadsEl = document.getElementById('failedLeads');

        console.log('[LOGS] 🎯 Elementos DOM encontrados:', {
          totalLeadsEl: !!totalLeadsEl,
          successfulLeadsEl: !!successfulLeadsEl,
          failedLeadsEl: !!failedLeadsEl
        });

        if (totalLeadsEl) totalLeadsEl.textContent = totalLeads;
        if (successfulLeadsEl) successfulLeadsEl.textContent = totalInteractions;
        if (failedLeadsEl) failedLeadsEl.textContent = totalFailures;

        console.log('[LOGS] 🎯 Valores definidos:', {
          totalLeads: totalLeadsEl?.textContent,
          totalInteractions: successfulLeadsEl?.textContent,
          totalFailures: failedLeadsEl?.textContent
        });

        // Preparar dados para a tabela de logs
        const displayLogs = allLeads.map((lead, index) => {
          // Montar dados do lead apenas com informações que existem
          const leadParts = [];

          // Verificar campos mais comuns primeiro
          if (lead.nome && lead.nome.trim()) leadParts.push(lead.nome.trim());
          if (lead.name && lead.name.trim()) leadParts.push(lead.name.trim());

          // Apenas telefone (sem email por enquanto como solicitado)
          if (lead.telefone && lead.telefone.trim()) leadParts.push(lead.telefone.trim());
          if (lead.phone && lead.phone.trim()) leadParts.push(lead.phone.trim());
          if (lead.number && lead.number.trim()) leadParts.push(lead.number.trim());

          // Se não tem nenhum dado, mostrar apenas telefone se existir
          let leadData = leadParts.length > 0 ? leadParts.join(' - ') : 'Lead sem dados';

          console.log('[LOGS] Dados do lead processados:', {
            original: lead,
            leadParts,
            finalData: leadData
          });

          return {
            id: index + 1,
            date: lead.created_at || new Date().toISOString(),
            status: 'success',
            leadData: leadData,
            action: 'Lead recebido'
          };
        });

        // Adicionar logs de erro apenas se realmente houver logs válidos
        if (allLogs && allLogs.length > 0) {
          allLogs.forEach((log, index) => {
            // Só adicionar se o log tem dados válidos de erro
            if (log.message || log.error || log.status === 'error') {
              displayLogs.push({
                id: displayLogs.length + 1,
                date: log.created_at || log.timestamp || new Date().toISOString(),
                status: 'error',
                leadData: `Log de erro: ${log.message || log.error || 'Erro não especificado'}`,
                action: 'Erro no processamento'
              });
            }
          });
        }

        console.log('[LOGS] Logs finais para exibição:', displayLogs);

        // Armazenar dados globalmente para filtros
        allLogsData = displayLogs;
        filteredLogsData = displayLogs;

        // Debug dos logs preparados
        console.log('[LOGS] 📊 Dados preparados para renderização:', {
          totalDisplayLogs: displayLogs.length,
          displayLogs: displayLogs.slice(0, 3), // Mostrar apenas os 3 primeiros para debug
          allLogsDataLength: allLogsData.length,
          filteredLogsDataLength: filteredLogsData.length
        });

        // Renderizar logs
        renderLogs(displayLogs);

        // FORÇAR atualização das métricas e ativar filtro padrão
        setTimeout(() => {
          console.log('[LOGS] 🔄 TIMEOUT - Garantindo estado inicial correto...');

          // Garantir que o filtro "Todos" está ativo e as métricas estão corretas
          filterLogsByType('all');

          console.log('[LOGS] 🔄 Filtro "Todos" ativado e métricas atualizadas');
        }, 100);

        // Atualizar título do popup para mostrar o nome do webhook
        const logsTitle = document.querySelector('.logs-popup-title');
        if (logsTitle && currentWebhook) {
          logsTitle.textContent = `Dashboard de Logs - ${currentWebhook.webhook_name}`;
        } else if (logsTitle) {
          logsTitle.textContent = `Dashboard de Logs`;
        }

      } catch (error) {
        console.error('[LOGS] ❌ CATCH - Erro capturado:', error);
        console.error('[LOGS] ❌ Stack trace completo:', error.stack);
        console.error('[LOGS] ❌ Tipo do erro:', error.name);
        console.error('[LOGS] ❌ Mensagem do erro:', error.message);

        // Verificar se os dados foram carregados com sucesso apesar do erro
        const totalLeadsEl = document.getElementById('totalLeads');
        const hasValidData = totalLeadsEl && totalLeadsEl.textContent && totalLeadsEl.textContent !== '...' && totalLeadsEl.textContent !== '0';

        console.log('[LOGS] ✅ Verificando se dados foram carregados:', {
          hasValidData,
          totalLeadsValue: totalLeadsEl?.textContent,
          errorType: error.name,
          errorMessage: error.message
        });

        // IMPORTANTE: Só mostrar popup para erros críticos que impedem o carregamento
        const isNetworkError = error.message.includes('fetch') || error.message.includes('network') || error.message.includes('Failed to fetch');
        const isCriticalError = error.name === 'TypeError' && error.message.includes('Cannot read');

        if ((isNetworkError || isCriticalError) && !hasValidData) {
          console.error('[LOGS] ❌ Erro crítico detectado - mostrando popup');
          showPopup('error', 'Erro de conexão', 'Erro de conexão com o servidor. Verifique sua conexão.');

          // Mostrar empty state apenas para erros críticos
          document.getElementById('logsEmpty').style.display = 'block';
          document.getElementById('logsTableBody').innerHTML = '';

          // Resetar métricas apenas para erros críticos
          document.getElementById('totalLeads').textContent = '0';
          document.getElementById('successfulLeads').textContent = '0';
          document.getElementById('failedLeads').textContent = '0';
        } else {
          // Para outros erros ou quando os dados já foram carregados, apenas log no console
          console.error('[LOGS] ❌ Erro não crítico detectado - apenas logging (não mostrar popup)');
          console.error('[LOGS] ❌ Dados foram carregados com sucesso, erro pode ser ignorado');
        }
      }
    }

    function renderLogs(logs) {
      console.log('[LOGS] 🎬 renderLogs chamada com:', {
        logs: logs ? logs.length : 'null/undefined',
        firstLog: logs ? logs[0] : 'N/A'
      });

      const tableBody = document.getElementById('logsTableBody');
      const emptyState = document.getElementById('logsEmpty');

      if (!logs || logs.length === 0) {
        console.log('[LOGS] ❌ Nenhum log para renderizar - mostrando empty state');
        emptyState.style.display = 'block';
        tableBody.innerHTML = '';

        // Verificar se é resultado de pesquisa vazia
        const searchInput = document.getElementById('logsSearchInput');
        if (searchInput && searchInput.value.trim()) {
          emptyState.innerHTML = `
            <div style="text-align: center; padding: 3rem;">
              <svg width="64" height="64" style="margin-bottom: 1rem; opacity: 0.6; color: #A594FF;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <h3 style="color: #ffffff; margin-bottom: 0.5rem;">Nenhum resultado encontrado</h3>
              <p style="color: rgba(255, 255, 255, 0.6);">Tente buscar por outros termos</p>
            </div>
          `;
        } else {
          emptyState.innerHTML = `
            <div style="text-align: center; padding: 3rem;">
              <svg width="64" height="64" style="margin-bottom: 1rem; opacity: 0.6; color: #A594FF;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              <h3 style="color: #ffffff; margin-bottom: 0.5rem;">Nenhum log encontrado</h3>
              <p style="color: rgba(255, 255, 255, 0.6);">Este webhook ainda não possui registros</p>
            </div>
          `;
        }
        return;
      }

      console.log('[LOGS] ✅ Renderizando', logs.length, 'logs');
      emptyState.style.display = 'none';

      tableBody.innerHTML = logs.map((log, index) => {
        const formattedDate = formatDateBrazil(log.date);
        const statusClass = log.status === 'success' ? 'logs-status-success' : 'logs-status-error';
        const statusText = log.status === 'success' ? 'Sucesso' : 'Erro';

        return `
          <div class="logs-table-row" onclick="showLeadInteractions('${log.leadData}', ${index})" style="cursor: pointer; transition: all 0.3s ease;">
            <div class="logs-table-cell">${formattedDate}</div>
            <div class="logs-table-cell">
              <span class="logs-status ${statusClass}">${statusText}</span>
            </div>
            <div class="logs-table-cell">${log.leadData}</div>
            <div class="logs-table-cell">${log.action}</div>
          </div>
        `;
      }).join('');

      // Adicionar hover effect nas linhas
      const tableRows = tableBody.querySelectorAll('.logs-table-row');
      tableRows.forEach(row => {
        row.addEventListener('mouseenter', function() {
          this.style.background = 'rgba(165, 148, 255, 0.1)';
          this.style.transform = 'translateX(4px)';
        });
        row.addEventListener('mouseleave', function() {
          this.style.background = '';
          this.style.transform = '';
        });
      });
    }

    // Função para mostrar interações de um lead específico
    function showLeadInteractions(leadData, logIndex) {
      console.log('[LEAD INTERACTIONS] Clique no lead:', leadData, 'Index:', logIndex);

      // Definir campos de contato para contar interações
      const contactFields = [
        'd0_1st', 'd0_30min', 'd0_3horas',
        'd1_9_00', 'd1_12_30', 'd1_19_00',
        'd3_8_00', 'd3_12_30', 'd3_20_00',
        'd5_9_00', 'd5_11_00', 'd5_16_00',
        'd7_11_00', 'd7_17_00', 'd7_20_00',
        'd10_16_00'
      ];

      // Usar o índice diretamente para acessar o lead correto
      const specificLead = allLeadsData[logIndex];

      console.log('[LEAD INTERACTIONS] Lead procurado:', leadData);
      console.log('[LEAD INTERACTIONS] Índice recebido:', logIndex);
      console.log('[LEAD INTERACTIONS] Total de leads disponíveis:', allLeadsData.length);
      console.log('[LEAD INTERACTIONS] Lead encontrado no índice:', specificLead);

      let totalInteractions = 0;

      // Verificar se o índice é válido e se o lead existe
      if (specificLead && logIndex >= 0 && logIndex < allLeadsData.length) {
        // Contar apenas os campos de contato que estão como true
        const trueFields = contactFields.filter(field => specificLead[field] === true);
        totalInteractions = trueFields.length;

        console.log('[LEAD INTERACTIONS] Lead ID:', specificLead.id || specificLead.lead_id || 'sem ID');
        console.log('[LEAD INTERACTIONS] Nome:', specificLead.nome || specificLead.name || 'sem nome');
        console.log('[LEAD INTERACTIONS] Telefone:', specificLead.telefone || specificLead.phone || 'sem telefone');
        console.log('[LEAD INTERACTIONS] Campos true encontrados:', trueFields);
        console.log('[LEAD INTERACTIONS] Total de interações para este lead:', totalInteractions);
      } else {
        console.warn('[LEAD INTERACTIONS] Índice inválido ou lead não encontrado:', {
          index: logIndex,
          totalLeads: allLeadsData.length,
          leadExists: !!specificLead
        });

        // Fallback: tentar encontrar por string matching como antes
        const fallbackLead = allLeadsData.find(lead => {
          const leadParts = [];
          if (lead.nome && lead.nome.trim()) leadParts.push(lead.nome.trim());
          if (lead.name && lead.name.trim()) leadParts.push(lead.name.trim());
          if (lead.telefone && lead.telefone.trim()) leadParts.push(lead.telefone.trim());
          if (lead.phone && lead.phone.trim()) leadParts.push(lead.phone.trim());
          if (lead.number && lead.number.trim()) leadParts.push(lead.number.trim());
          const constructedLeadData = leadParts.length > 0 ? leadParts.join(' - ') : 'Lead sem dados';
          return constructedLeadData === leadData;
        });

        if (fallbackLead) {
          const trueFields = contactFields.filter(field => fallbackLead[field] === true);
          totalInteractions = trueFields.length;
          console.log('[LEAD INTERACTIONS] Fallback bem-sucedido. Total de interações:', totalInteractions);
        }
      }

      // Criar popup customizado
      const popupHtml = `
        <div id="leadInteractionsOverlay" class="popup-overlay show" style="z-index: 10001;">
          <div class="popup" style="max-width: 400px;">
            <div class="popup-icon" style="background: linear-gradient(135deg, #A594FF, #8B5CF6) !important; margin-bottom: 1.5rem;">
              <svg class="w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-white mb-3">Interações do Lead</h3>
            <div style="background: rgba(165, 148, 255, 0.1); border: 1px solid rgba(165, 148, 255, 0.3); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem;">
              <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; margin-bottom: 0.5rem;"><strong>Lead:</strong></p>
              <p style="color: #A594FF; font-weight: 600; word-break: break-word;">${leadData}</p>
            </div>
            <div style="text-align: center; margin-bottom: 1.5rem;">
              <div style="font-size: 2rem; font-weight: 700; color: #A594FF; margin-bottom: 0.5rem;">${totalInteractions}</div>
              <div style="color: rgba(255, 255, 255, 0.8); font-weight: 600;">Total de Interações</div>
              <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin-top: 0.25rem;">Baseado em status "Sucesso"</div>
            </div>
            <button onclick="closeLeadInteractionsPopup()" class="btn-primary px-6 py-2 rounded-xl font-semibold w-full">
              Fechar
            </button>
          </div>
        </div>
      `;

      // Adicionar ao DOM
      document.body.insertAdjacentHTML('beforeend', popupHtml);
    }

    // Função para fechar popup de interações
    function closeLeadInteractionsPopup() {
      const popup = document.getElementById('leadInteractionsOverlay');
      if (popup) {
        popup.classList.remove('show');
        setTimeout(() => {
          popup.remove();
        }, 300);
      }
    }

    // Fechar popup de logs ao clicar no overlay
    document.getElementById('logsPopupOverlay').addEventListener('click', function(e) {
      if (e.target === this) {
        closeLogsPopup();
      }
    });

    // Variáveis globais para logs
    let allLogsData = [];
    let filteredLogsData = [];
    let allLeadsData = []; // Variável global para dados dos leads
    let totalInteractionsCalculated = 0; // Armazenar total de interações calculado corretamente

    // Função de filtro por tipo
    function filterLogsByType(type) {
      console.log('[LOGS] 🔍 Filtrando por tipo:', type);

      // Atualizar botões ativos
      document.querySelectorAll('.logs-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.filter === type) {
          btn.classList.add('active');
        }
      });

      // Filtrar dados
      if (type === 'all') {
        filteredLogsData = allLogsData;
      } else {
        filteredLogsData = allLogsData.filter(log => log.status === type);
      }

      // RECALCULAR e ATUALIZAR as métricas baseadas nos dados filtrados
      const totalLeadsFiltered = allLogsData.length; // Total sempre mostra todos os leads
      // Usar valor já calculado corretamente da variável global
      const totalInteractionsFiltered = totalInteractionsCalculated;
      const totalFailuresFiltered = allLogsData.filter(log => log.status === 'error').length; // Contar falhas reais

      console.log('[LOGS] 🔍 Métricas recalculadas no filtro:', {
        type,
        totalLeadsFiltered,
        totalInteractionsFiltered,
        totalFailuresFiltered,
        filteredLogsCount: filteredLogsData.length
      });

      // Atualizar métricas no DOM
      const totalLeadsEl = document.getElementById('totalLeads');
      const successfulLeadsEl = document.getElementById('successfulLeads');
      const failedLeadsEl = document.getElementById('failedLeads');

      if (totalLeadsEl) totalLeadsEl.textContent = totalLeadsFiltered;
      if (successfulLeadsEl) successfulLeadsEl.textContent = totalInteractionsFiltered;
      if (failedLeadsEl) failedLeadsEl.textContent = totalFailuresFiltered;

      // Re-renderizar logs
      renderLogs(filteredLogsData);
    }

    // Função de pesquisa
    function searchLogs(searchTerm) {
      console.log('[LOGS] Pesquisando por:', searchTerm);

      if (!searchTerm.trim()) {
        // Se não há termo de pesquisa, mostrar logs filtrados pelo tipo atual
        const activeFilter = document.querySelector('.logs-filter-btn.active')?.dataset.filter || 'all';
        filterLogsByType(activeFilter);
        return;
      }

      // Filtrar logs pelo termo de pesquisa
      const searchResults = allLogsData.filter(log => {
        const searchIn = `${log.leadData} ${log.action} ${formatDateBrazil(log.date)}`.toLowerCase();
        return searchIn.includes(searchTerm.toLowerCase());
      });

      // Aplicar filtro de tipo se ativo
      const activeFilter = document.querySelector('.logs-filter-btn.active')?.dataset.filter || 'all';
      if (activeFilter !== 'all') {
        filteredLogsData = searchResults.filter(log => log.status === activeFilter);
      } else {
        filteredLogsData = searchResults;
      }

      renderLogs(filteredLogsData);
    }

    // Event listeners para os filtros e pesquisa
    document.addEventListener('DOMContentLoaded', function() {
      // Event listener para pesquisa
      const searchInput = document.getElementById('logsSearchInput');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          searchLogs(this.value);
        });
      }

      // Event listeners para botões de filtro
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('logs-filter-btn')) {
          const filterType = e.target.dataset.filter;
          filterLogsByType(filterType);
        }
      });
    });

  </script>
</body>
</html>
