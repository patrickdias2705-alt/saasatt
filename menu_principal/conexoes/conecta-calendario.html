<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="https://imagens-zipline.hgabnb.easypanel.host/u/2FsJTY.png">
    <link rel="shortcut icon" type="image/png" href="https://imagens-zipline.hgabnb.easypanel.host/u/2FsJTY.png">
    <link rel="apple-touch-icon" href="https://imagens-zipline.hgabnb.easypanel.host/u/2FsJTY.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário - Salesdever</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cores Principais - Salesdever */
            --primary: #A594FF;
            --primary-dark: #764ba2;
            --primary-light: #c4b5fd;

            /* Background DARK */
            --bg-dark: #0a0420;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-card-hover: rgba(255, 255, 255, 0.08);
            --bg-sidebar: rgba(15, 8, 40, 0.95);

            /* Status */
            --success: #22C55E;
            --warning: #FBBF24;
            --danger: #EF4444;
            --info: #3B82F6;

            /* Texto */
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.4);

            /* Bordas */
            --border: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(165, 148, 255, 0.3);

            /* Event Colors */
            --event-purple: #A594FF;
            --event-green: #22C55E;
            --event-blue: #3B82F6;
            --event-orange: #FBBF24;
            --event-pink: #EC4899;
        }

        /* ========== ÍCONES SVG ========== */
        .icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            display: inline-block;
            vertical-align: middle;
        }

        .icon-xs { width: 14px; height: 14px; }
        .icon-sm { width: 16px; height: 16px; }
        .icon-md { width: 20px; height: 20px; }
        .icon-lg { width: 24px; height: 24px; }
        .icon-xl { width: 32px; height: 32px; }
        .icon-2xl { width: 48px; height: 48px; }

        /* ========== AVATARES ========== */
        .avatar {
            position: relative;
            border-radius: 50%;
            overflow: visible;
            flex-shrink: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .avatar-fallback {
            display: none;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
        }

        .avatar .status-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid var(--bg-dark);
        }

        /* Tamanhos */
        .avatar-xs { width: 24px; height: 24px; font-size: 0.6rem; }
        .avatar-sm { width: 32px; height: 32px; font-size: 0.7rem; }
        .avatar-md { width: 40px; height: 40px; font-size: 0.85rem; }
        .avatar-lg { width: 56px; height: 56px; font-size: 1.1rem; }
        .avatar-xl { width: 72px; height: 72px; font-size: 1.4rem; }

        /* ========== EFEITOS FUTURISTAS ========== */

        /* Background com gradientes animados */
        body {
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(165, 148, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(102, 126, 234, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(165, 148, 255, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
            animation: ambientFloat 20s ease-in-out infinite;
        }

        @keyframes ambientFloat {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        /* Glassmorphism */
        .glass {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Glow hover effect */
        .glow-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glow-hover:hover {
            box-shadow:
                0 0 20px rgba(165, 148, 255, 0.4),
                0 0 40px rgba(165, 148, 255, 0.2),
                0 8px 32px rgba(0, 0, 0, 0.3);
            border-color: rgba(165, 148, 255, 0.5);
            transform: translateY(-2px);
        }

        /* Gradient border */
        .gradient-border {
            position: relative;
            background: var(--bg-card);
        }

        .gradient-border::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(
                135deg,
                rgba(165, 148, 255, 0.6),
                rgba(102, 126, 234, 0.3),
                rgba(165, 148, 255, 0.1)
            );
            -webkit-mask:
                linear-gradient(#fff 0 0) content-box,
                linear-gradient(#fff 0 0);
            mask:
                linear-gradient(#fff 0 0) content-box,
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }

        /* Shine animation */
        .shine {
            position: relative;
            overflow: hidden;
        }

        .shine::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 40%,
                rgba(255, 255, 255, 0.05) 50%,
                transparent 60%
            );
            transform: rotate(45deg);
            animation: shine 4s ease-in-out infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        /* Card lift effect */
        .card-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-lift:hover {
            transform: translateY(-4px);
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(165, 148, 255, 0.2);
        }

        /* Status dot pulsante */
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: relative;
        }

        .status-dot.online {
            background: var(--success);
        }

        .status-dot.online::after {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            background: var(--success);
            opacity: 0;
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.4); opacity: 0; }
        }

        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.03) 25%,
                rgba(255, 255, 255, 0.1) 50%,
                rgba(255, 255, 255, 0.03) 75%
            );
            background-size: 200% 100%;
            animation: skeletonWave 1.5s ease-in-out infinite;
            border-radius: 8px;
        }

        @keyframes skeletonWave {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ========== ONBOARDING STYLES ========== */

        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-dark);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            overflow-y: auto;
        }

        .onboarding-container {
            max-width: 900px;
            width: 100%;
            padding: 3rem;
            border-radius: 24px;
            position: relative;
        }

        .onboarding-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .onboarding-logo {
            margin: 0 auto 1.5rem;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 32px rgba(165, 148, 255, 0.3);
        }

        .onboarding-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .onboarding-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 500px;
            margin: 0 auto;
        }

        .onboarding-steps {
            min-height: 400px;
            position: relative;
        }

        .onboarding-step {
            display: none;
            opacity: 0;
            transform: translateX(50px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .onboarding-step.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(165, 148, 255, 0.4);
        }

        .step-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .step-header + p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .step-content {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--border);
        }

        .onboarding-form .form-group {
            margin-bottom: 1.5rem;
        }

        .btn-connect-google {
            background: linear-gradient(135deg, #4285f4, #34a853);
            border: none;
            color: white;
            font-weight: 600;
            padding: 1rem 2rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(66, 133, 244, 0.3);
        }

        .btn-connect-google:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(66, 133, 244, 0.4);
        }

        .connected-accounts {
            margin-top: 1.5rem;
            padding: 1rem 0;
        }

        .account-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .account-info {
            flex: 1;
        }

        .account-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .account-email {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .availability-grid {
            display: grid;
            gap: 1rem;
        }

        .availability-day {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .day-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .time-inputs {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .time-inputs input[type="time"] {
            flex: 1;
            min-width: 100px;
        }

        .time-inputs span {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .onboarding-summary {
            padding: 1.5rem;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .summary-item svg {
            color: var(--primary);
        }

        .onboarding-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .onboarding-dots {
            display: flex;
            gap: 0.5rem;
        }

        .onboarding-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .onboarding-dot.active {
            background: var(--primary);
            transform: scale(1.2);
        }

        .onboarding-dot.completed {
            background: var(--success);
        }

        /* Responsive onboarding */
        @media (max-width: 768px) {
            .onboarding-container {
                padding: 2rem;
            }

            .onboarding-title {
                font-size: 2rem;
            }

            .availability-day {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                text-align: center;
            }

            .time-inputs {
                justify-content: center;
            }

            .onboarding-navigation {
                flex-direction: column;
                gap: 1rem;
            }

            .onboarding-navigation .btn-secondary,
            .onboarding-navigation .btn-primary {
                order: 2;
            }

            .onboarding-dots {
                order: 1;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Raleway', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ========== HEADER PRINCIPAL ========== */
        .main-header {
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            height: 60px;
            background: rgba(10, 4, 32, 0.95);
            border-bottom: 1px solid rgba(165, 148, 255, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.1rem;
            color: #ffffff;
        }

        .logo svg {
            color: #A594FF;
        }

        /* Botão Adicionar Calendário */
        .btn-add-calendar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px dashed rgba(165, 148, 255, 0.4);
            background: rgba(165, 148, 255, 0.1);
            color: #A594FF;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-add-calendar:hover {
            background: rgba(165, 148, 255, 0.2);
            border-color: #A594FF;
            transform: scale(1.05);
        }

        /* ========== ABAS DOS CALENDÁRIOS (Estilo Chrome) ========== */
        .calendar-tabs-container {
            flex: 1;
            overflow: hidden;
            margin: 0 1rem;
        }

        .calendar-tabs {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 100%;
            overflow-x: auto;
            padding-bottom: 0;
            scrollbar-width: none;
        }

        .calendar-tabs::-webkit-scrollbar {
            display: none;
        }

        .calendar-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 160px;
            max-width: 280px;
            position: relative;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .calendar-tab:hover {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.9);
        }

        .calendar-tab.active {
            background: linear-gradient(180deg, rgba(165, 148, 255, 0.15) 0%, rgba(10, 4, 32, 1) 100%);
            border-color: rgba(165, 148, 255, 0.3);
            color: #ffffff;
            font-weight: 600;
        }

        .calendar-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #A594FF;
        }

        .tab-icon {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            background: rgba(165, 148, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .tab-icon svg {
            width: 12px;
            height: 12px;
            color: #A594FF;
        }

        .tab-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab-close {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .calendar-tab:hover .tab-close {
            opacity: 1;
        }

        .tab-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }


        /* Aba vazia/criar */
        .calendar-tab.empty-tab {
            border: 1px dashed rgba(165, 148, 255, 0.3);
            background: transparent;
        }

        .calendar-tab.empty-tab:hover {
            border-color: #A594FF;
            background: rgba(165, 148, 255, 0.1);
        }

        /* Header center e right */
        .header-center {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-btn:hover {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.12) 0%,
                rgba(255, 255, 255, 0.06) 100%
            );
            border-color: rgba(165, 148, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(165, 148, 255, 0.2);
        }

        .period-display {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 200px;
            text-align: center;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .view-tabs {
            display: flex;
            background: linear-gradient(
                135deg,
                rgba(16, 7, 49, 0.85) 0%,
                rgba(10, 4, 32, 0.9) 100%
            );
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 6px;
            border: 1px solid rgba(165, 148, 255, 0.25);
            box-shadow:
                0 12px 40px rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(165, 148, 255, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
            gap: 4px;
        }

        .view-tab {
            padding: 6px 20px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            position: relative;
            min-width: 80px;
            text-align: center;
            letter-spacing: 0.025em;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .view-tab:hover {
            color: rgba(255, 255, 255, 0.9);
            background: linear-gradient(
                135deg,
                rgba(165, 148, 255, 0.15) 0%,
                rgba(165, 148, 255, 0.05) 100%
            );
            border: 1px solid rgba(165, 148, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 148, 255, 0.2);
        }

        .view-tab.active {
            background: linear-gradient(
                135deg,
                #A594FF 0%,
                #8B7AFF 100%
            );
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow:
                0 6px 20px rgba(165, 148, 255, 0.5),
                0 3px 10px rgba(165, 148, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.25);
            transform: none !important;
            font-weight: 700;
            padding: 6px 20px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            line-height: 1 !important;
        }


        .btn-primary {
            background: linear-gradient(
                135deg,
                #A594FF 0%,
                #8B7AFF 100%
            );
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            position: relative;
            letter-spacing: 0.025em;
            box-shadow:
                0 6px 20px rgba(165, 148, 255, 0.4),
                0 3px 10px rgba(165, 148, 255, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: all 0.6s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(
                135deg,
                #B8A8FF 0%,
                #9C8AFF 100%
            );
            transform: translateY(-3px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow:
                0 8px 30px rgba(165, 148, 255, 0.5),
                0 4px 15px rgba(165, 148, 255, 0.35),
                inset 0 1px 0 rgba(255, 255, 255, 0.35);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:active {
            transform: translateY(-1px);
            box-shadow:
                0 4px 12px rgba(165, 148, 255, 0.3),
                0 2px 6px rgba(165, 148, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .btn-secondary:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        /* ========== LAYOUT PRINCIPAL - 3 COLUNAS ========== */
        .main-layout {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            height: calc(100vh - 80px);
            gap: 1px;
            background: var(--border);
        }

        /* ========== SIDEBAR ESQUERDA ========== */
        .sidebar-left {
            background: var(--bg-sidebar);
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* ========== MINI CALENDÁRIO - CORRIGIDO ========== */
        .mini-calendar-section {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            overflow: hidden; /* IMPORTANTE */
        }

        .mini-calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0 4px;
        }

        .mini-nav {
            width: 28px;
            height: 28px;
            min-width: 28px; /* Evita encolher */
            border: 1px solid var(--border);
            border-radius: 6px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            padding: 0;
        }

        .mini-nav:hover {
            color: var(--text-primary);
            border-color: var(--primary);
            background: rgba(165, 148, 255, 0.1);
        }

        .mini-nav svg {
            width: 16px;
            height: 16px;
        }

        .mini-month-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.85rem;
            text-align: center;
            flex: 1;
            white-space: nowrap;
            text-transform: capitalize;
        }

        .mini-calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0;
            margin-bottom: 4px;
        }

        .mini-calendar-weekdays span {
            text-align: center;
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 600;
            padding: 4px 0;
            text-transform: uppercase;
        }

        .mini-calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .mini-day {
            aspect-ratio: 1; /* Mantém quadrado */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
            position: relative;
            min-width: 0; /* Permite encolher */
        }

        .mini-day:hover {
            background: var(--bg-card-hover);
        }

        .mini-day.other-month {
            color: var(--text-muted);
            opacity: 0.5;
        }

        .mini-day.today {
            background: var(--primary);
            color: white;
            font-weight: 700;
        }

        .mini-day.selected {
            background: rgba(165, 148, 255, 0.2);
            border: 1px solid var(--primary);
        }

        .mini-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
        }

        .mini-day.today.has-events::after {
            background: white;
        }

        /* Estatísticas */
        .statistics-section {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .section-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .stat-item:hover {
            background: rgba(165, 148, 255, 0.08);
            border-color: var(--border-hover);
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(165, 148, 255, 0.15);
            border-radius: 10px;
            flex-shrink: 0;
        }

        .stat-icon svg {
            color: var(--primary);
        }

        .stat-content {
            flex: 1;
            min-width: 0;
        }

        .stat-value {
            display: block;
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary);
            line-height: 1.1;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: block;
            margin-top: 2px;
        }

        /* ========== CALENDÁRIO PRINCIPAL (CENTRO) ========== */
        .calendar-main {
            background: var(--bg-dark);
            overflow: hidden;
            position: relative;
        }

        .calendar-container {
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Week View */
        .week-header {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .time-gutter-header {
            border-right: 1px solid var(--border);
        }

        .day-header {
            padding: 1rem 0.5rem;
            text-align: center;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .day-header:last-child {
            border-right: none;
        }

        .day-header.today {
            background: rgba(165, 148, 255, 0.1);
        }

        .day-name {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .day-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .day-number.today {
            background: var(--primary);
            color: white;
        }

        .week-body {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
        }

        .hour-row {
            display: contents;
        }

        .time-gutter {
            padding: 0 12px;
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
            border-right: 1px solid var(--border);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            height: 60px;
            padding-top: 8px;
        }

        .day-slot {
            min-height: 60px;
            border-right: 1px solid rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            position: relative;
            cursor: pointer;
            transition: background 0.2s ease;
            padding: 2px;
        }

        .day-slot:last-child {
            border-right: none;
        }

        .day-slot:hover {
            background: rgba(165, 148, 255, 0.05);
        }

        .day-slot.today {
            background: rgba(165, 148, 255, 0.02);
        }

        /* Month View */
        .month-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border);
        }

        .month-day-name {
            padding: 1rem;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-right: 1px solid var(--border);
        }

        .month-day-name:last-child {
            border-right: none;
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(6, 1fr);
            height: calc(100vh - 200px);
        }

        .month-day {
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            padding: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .month-day:hover {
            background: var(--bg-card);
        }

        .month-day.other-month {
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-muted);
        }

        .month-day.today {
            background: rgba(165, 148, 255, 0.1);
        }

        .month-day-num {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .month-day-num.today {
            color: var(--primary);
        }

        .month-events {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .month-event {
            background: rgba(165, 148, 255, 0.2);
            color: var(--text-primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-left: 2px solid var(--primary);
        }

        .month-more {
            font-size: 0.7rem;
            color: var(--text-muted);
            cursor: pointer;
        }

        /* Day View */
        .day-view-header {
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
        }

        .day-view-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-primary);
            display: block;
            line-height: 1;
        }

        .day-view-number.today {
            color: var(--primary);
        }

        .day-view-name {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .day-view-body {
            display: grid;
            grid-template-columns: 60px 1fr;
        }

        .day-slot.single {
            border-right: none;
        }

        /* Event Blocks */
        .event-block {
            position: absolute;
            left: 4px;
            right: 4px;
            padding: 4px 8px;
            margin: 1px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 2;
            font-size: 0.75rem;
            min-height: 24px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .event-block:hover {
            transform: translateX(2px);
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .event-block.color-purple {
            background: rgba(165, 148, 255, 0.3);
            border-left: 3px solid var(--event-purple);
            color: white;
        }

        .event-block.color-green {
            background: rgba(34, 197, 94, 0.3);
            border-left: 3px solid var(--event-green);
            color: white;
        }

        .event-block.color-blue {
            background: rgba(59, 130, 246, 0.3);
            border-left: 3px solid var(--event-blue);
            color: white;
        }

        .event-block.color-orange {
            background: rgba(251, 191, 36, 0.3);
            border-left: 3px solid var(--event-orange);
            color: white;
        }

        .event-time {
            font-weight: 700;
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .event-title {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Eventos sobrepostos - sistema de divisão automática */
        .event-block.overlapped {
            margin: 0;
            padding: 2px 6px;
            min-height: 20px;
            font-size: 0.7rem;
        }

        .event-block.overlapped .event-title {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.7rem;
        }

        .event-block.overlapped .event-time {
            display: none; /* Ocultar horário em eventos pequenos */
        }

        /* ========== SIDEBAR DIREITA - SESSIONS ========== */
        .sidebar-right {
            background: var(--bg-sidebar);
            padding: 2rem;
            overflow-y: auto;
        }

        .sessions-section {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .sessions-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .session-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            margin-bottom: 12px;
        }

        .session-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            transform: translateY(-1px);
        }

        .session-color {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
            border-radius: 3px 0 0 3px;
        }

        .session-content {
            margin-left: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .session-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.85rem;
            line-height: 1.25;
            flex: 1;
        }

        .session-badge {
            background: rgba(165, 148, 255, 0.2);
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .session-meta {
            color: var(--text-secondary);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .session-time {
            color: var(--text-secondary);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .session-icon {
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .session-duration {
            color: var(--text-muted);
        }

        .empty-message {
            text-align: center;
            color: var(--text-muted);
            padding: 2rem;
            font-style: italic;
        }

        /* ========== CORES DOS MODAIS - IDENTIDADE SALESDEVER ========== */

        /* Overlay do modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 4, 32, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Container do modal */
        .modal {
            background: linear-gradient(
                165deg,
                rgba(30, 15, 60, 0.98) 0%,
                rgba(15, 8, 40, 0.99) 50%,
                rgba(10, 4, 32, 1) 100%
            );
            border: 1px solid rgba(165, 148, 255, 0.2);
            border-radius: 20px;
            max-width: 520px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            box-shadow:
                0 0 0 1px rgba(165, 148, 255, 0.1),
                0 25px 60px rgba(0, 0, 0, 0.5),
                0 0 100px rgba(165, 148, 255, 0.1);
        }

        .modal-lg {
            max-width: 580px;
        }

        /* Header do modal */
        .modal-header {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(165, 148, 255, 0.15);
            background: rgba(165, 148, 255, 0.05);
        }

        .modal-header h2 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Botão fechar */
        .btn-close {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1.5rem;
            line-height: 1;
        }

        .btn-close:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
            color: #EF4444;
        }

        /* Tabs do modal */
        .modal-tabs {
            display: flex;
            gap: 6px;
            background: rgba(0, 0, 0, 0.3);
            margin: 1rem 1.5rem;
            border-radius: 12px;
            padding: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }



        /* Body do modal */
        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: calc(85vh - 200px);
            background: transparent;
        }

        /* Inputs dentro do modal */
        .modal .form-input,
        .modal .form-select {
            background: rgba(16, 7, 49, 0.6) !important;
            border: 1px solid rgba(165, 148, 255, 0.3) !important;
            color: #ffffff !important;
            transition: all 0.3s ease;
        }

        .modal .form-input:focus,
        .modal .form-select:focus {
            border-color: #A594FF !important;
            background: rgba(16, 7, 49, 0.8) !important;
            box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2) !important;
        }

        .modal .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5) !important;
        }

        .modal input[type="checkbox"] {
            accent-color: #A594FF !important;
        }

        .modal input[type="time"],
        .modal input[type="datetime-local"] {
            background: rgba(16, 7, 49, 0.6) !important;
            border: 1px solid rgba(165, 148, 255, 0.3) !important;
            color: #ffffff !important;
        }

        /* Labels */
        .modal .form-group label,
        .modal label {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 600;
        }

        .modal .checkbox-label {
            color: rgba(255, 255, 255, 0.85) !important;
        }

        /* List items dentro do modal */
        .modal .list-item {
            background: rgba(16, 7, 49, 0.4) !important;
            border: 1px solid rgba(165, 148, 255, 0.2) !important;
        }

        .modal .list-item:hover {
            background: rgba(16, 7, 49, 0.6) !important;
            border-color: rgba(165, 148, 255, 0.4) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(10, 4, 32, 0.3) !important;
        }

        .modal .list-item-name {
            color: #ffffff !important;
        }

        .modal .list-item-email {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        /* Empty message */
        .modal .empty-message,
        .modal .empty-state {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .modal .empty-state svg {
            opacity: 0.4;
        }

        /* Botões dentro do modal */
        .modal .btn-secondary {
            background: rgba(16, 7, 49, 0.6) !important;
            border: 1px solid rgba(165, 148, 255, 0.3) !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .modal .btn-secondary:hover {
            background: rgba(16, 7, 49, 0.8) !important;
            border-color: rgba(165, 148, 255, 0.5) !important;
            color: #ffffff !important;
        }

        .modal .btn-primary {
            background: linear-gradient(135deg, #A594FF, #8B7FFF) !important;
            border: none !important;
            color: #ffffff !important;
        }

        .modal .btn-primary:hover {
            background: linear-gradient(135deg, #9485FF, #7B6FFF) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(165, 148, 255, 0.3) !important;
        }

        /* Botões de ação pequenos (remover, editar) */
        .modal .btn-sm {
            background: rgba(16, 7, 49, 0.4) !important;
            border: 1px solid rgba(165, 148, 255, 0.2) !important;
            color: rgba(255, 255, 255, 0.8) !important;
        }

        .modal .btn-sm:hover {
            background: rgba(165, 148, 255, 0.2) !important;
            border-color: rgba(165, 148, 255, 0.4) !important;
            color: #ffffff !important;
        }

        .modal .btn-danger:hover {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.4) !important;
            color: #ef4444 !important;
        }

        /* ========== ESTADO SEM CALENDÁRIOS ========== */
        .no-calendars-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 400px;
            text-align: center;
            padding: 3rem;
        }

        .no-calendars-state .empty-icon {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(165, 148, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .no-calendars-state .empty-icon svg {
            color: #A594FF;
            opacity: 0.7;
        }

        .no-calendars-state h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .no-calendars-state p {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 2rem;
            max-width: 300px;
        }

        /* Form row */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Spinner pequeno */
        .spinner-sm {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ========== MODAL REDESIGN ========== */
        .modal-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-title svg {
            color: var(--primary);
        }

        .modal-title h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .btn-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-card);
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        /* Tabs Container */
        .modal-tabs-container {
            padding: 1rem 2rem 1rem 2rem;
            background: rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            justify-content: center;
        }

        .modal-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 6px;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 6px;
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
            margin: 0 auto;
        }

        .modal-tab {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 8px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-height: 50px;
            text-align: center;
        }

        .modal-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .modal-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(165, 148, 255, 0.3);
        }

        .modal-tab svg {
            flex-shrink: 0;
        }

        .tab-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .modal-tab.active .tab-badge {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab-badge.success {
            background: rgba(34, 197, 94, 0.3);
            color: var(--success);
        }

        .modal-tab.active .tab-badge.success {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        /* Invite Form */
        .invite-form-container {
            max-width: 100%;
        }

        .invite-illustration {
            text-align: center;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: rgba(165, 148, 255, 0.05);
            border-radius: 16px;
            border: 1px dashed rgba(165, 148, 255, 0.2);
        }

        .invite-illustration svg {
            margin-bottom: 12px;
            opacity: 0.8;
        }

        .invite-illustration p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
        }

        /* List Items - Conectados e Pendentes */
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .list-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .list-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Avatar no List Item */
        .list-item-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: visible;
            flex-shrink: 0;
            position: relative;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .list-item-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .list-item-avatar .avatar-fallback {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            color: white;
            text-transform: uppercase;
        }

        .list-item-avatar .status-indicator {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 14px;
            height: 14px;
            border: none;
            border-radius: 50%;
            transition: all 0.2s ease;
            z-index: 15;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .list-item-avatar .status-indicator.active {
            background: var(--success);
        }

        .list-item-avatar .status-indicator.inactive {
            background: #ff6b6b;
        }

        /* Status text styling */
        .status-text {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
            text-transform: uppercase;
        }

        .status-text.connected {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .status-text.disconnected {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        /* List item states */
        .list-item.connected {
            border-color: rgba(34, 197, 94, 0.3);
        }

        .list-item.disconnected {
            border-color: rgba(255, 107, 107, 0.3);
            opacity: 0.8;
        }

        .btn-action.primary {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        .btn-action.primary:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }

        .btn-action.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .btn-action.danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .list-item-info {
            flex: 1;
            min-width: 0;
        }

        .list-item-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-size: 0.95rem;
        }

        .list-item-email {
            color: var(--text-secondary);
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .list-item-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        /* Botões de ação */
        .btn-action {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            border: none;
        }

        .btn-action.success {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .btn-action.success:hover {
            background: var(--success);
            color: white;
        }

        .btn-action.danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-action.danger:hover {
            background: var(--danger);
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-muted);
        }

        .empty-state svg {
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            margin: 0;
            font-size: 0.9rem;
        }

        /* Form improvements */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .form-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(0, 0, 0, 0.4);
            box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.15);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .btn-block {
            width: 100%;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group label {
            display: block;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-input,
        .form-select {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.15);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .checkbox-label {
            display: flex !important;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            margin-bottom: 0 !important;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }

        .btn-block {
            width: 100%;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .list-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .list-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .list-item-info {
            flex: 1;
            min-width: 0;
        }

        .list-item-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .list-item-email {
            color: var(--text-secondary);
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .list-item-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border: none;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--success);
            color: white;
            border: none;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-sidebar);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast.info {
            border-left: 4px solid var(--info);
        }

        /* Responsividade */
        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 280px 1fr 330px;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }

            .sidebar-left,
            .sidebar-right {
                padding: 1rem;
            }

            .main-header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .header-center {
                order: -1;
            }

            .view-tabs {
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 1rem;
            }

            .period-display {
                min-width: auto;
                font-size: 1rem;
            }

            .modal {
                margin: 1rem;
                max-width: calc(100vw - 2rem);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .week-header,
            .week-body {
                grid-template-columns: 50px repeat(7, 1fr);
            }

            .day-header {
                padding: 0.5rem 0.25rem;
            }

            .day-number {
                font-size: 1.2rem;
                width: 28px;
                height: 28px;
            }

            .time-gutter {
                padding: 0 8px;
                font-size: 0.7rem;
            }
        }

        /* Scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }

        *::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        *::-webkit-scrollbar-track {
            background: transparent;
        }

        *::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <!-- HEADER PRINCIPAL -->
    <header class="main-header">
        <div class="header-left">
            <!-- Logo + Título -->
            <div class="logo">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>Calendário</span>
            </div>

            <!-- Botão Adicionar Calendário -->
            <button id="addCalendarBtn" class="btn-add-calendar" onclick="openCreateCalendarModal()" title="Novo Calendário">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </button>

        </div>

        <!-- ABAS DOS CALENDÁRIOS (Estilo Chrome) -->
        <div class="calendar-tabs-container">
            <div class="calendar-tabs" id="calendarTabs">
                <!-- Renderizado via JavaScript -->
            </div>
        </div>

        <!-- Navegação e botões existentes -->
        <div class="header-center">
            <button class="nav-btn" onclick="navigateCalendar(-1)">‹</button>
            <span class="period-display" id="periodDisplay">14 - 20 de dez. 2025</span>
            <button class="nav-btn" onclick="navigateCalendar(1)">›</button>
        </div>

        <div class="header-right">
            <div class="view-tabs">
                <button class="view-tab" data-view="day">Dia</button>
                <button class="view-tab active" data-view="week">Semana</button>
                <button class="view-tab" data-view="month">Mês</button>
            </div>
            <button id="inviteButton" class="btn-primary shine" onclick="openInviteModal()">+ Contas</button>
            <button class="btn-icon" onclick="openSettingsModal()">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </button>
        </div>
    </header>

    <!-- ONBOARDING SCREEN -->
    <!-- ONBOARDING SCREEN REMOVED - Going directly to calendar -->
    <div id="onboardingScreen" class="onboarding-overlay" style="display: none;">
        <div class="onboarding-container glass glow-hover gradient-border">
            <div class="onboarding-header">
                <div class="onboarding-logo">
                    <svg class="icon icon-2xl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="15" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                        <path d="m9 16 2 2 4-4"/>
                    </svg>
                </div>
                <h1 class="onboarding-title">Bem-vindo ao Calendário Salesdever</h1>
                <p class="onboarding-subtitle">Configure seu primeiro calendário em apenas alguns passos</p>
            </div>

            <div class="onboarding-steps">
                <div class="onboarding-step active" data-step="1">
                    <div class="step-header">
                        <div class="step-number">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <h3>Conectar Conta Google</h3>
                    </div>
                    <p>Primeiro, você precisa conectar uma conta do Google Calendar para gerenciar seus agendamentos.</p>
                    <div class="step-content">
                        <button class="btn-primary btn-connect-google" onclick="connectGoogleCalendar()">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Conectar com Google
                        </button>
                        <div class="connected-accounts" id="onboardingConnectedAccounts" style="display: none;">
                            <div class="account-item glass">
                                <div class="avatar avatar-sm">
                                    <img id="connectedAccountAvatar" src="" alt="" style="display: none;">
                                    <div class="avatar-fallback" id="connectedAccountFallback"></div>
                                </div>
                                <div class="account-info">
                                    <div class="account-name" id="connectedAccountName"></div>
                                    <div class="account-email" id="connectedAccountEmail"></div>
                                </div>
                                <div class="status-dot online"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="onboarding-step" data-step="2">
                    <div class="step-header">
                        <div class="step-number">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="15" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </div>
                        <h3>Configurar Calendário</h3>
                    </div>
                    <p>Defina as configurações básicas do seu calendário de agendamentos.</p>
                    <div class="step-content">
                        <form class="onboarding-form" id="onboardingCalendarForm">
                            <div class="form-group">
                                <label>Nome do Calendário</label>
                                <input type="text" class="form-input" id="onboardingCalendarName" placeholder="Ex: Calendário Principal" value="Calendário Principal">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Duração padrão</label>
                                    <select class="form-select" id="onboardingDuration">
                                        <option value="15">15 minutos</option>
                                        <option value="30" selected>30 minutos</option>
                                        <option value="45">45 minutos</option>
                                        <option value="60">1 hora</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Antecedência máxima</label>
                                    <select class="form-select" id="onboardingMaxDays">
                                        <option value="7">7 dias</option>
                                        <option value="15">15 dias</option>
                                        <option value="30" selected>30 dias</option>
                                        <option value="60">60 dias</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="onboarding-step" data-step="3">
                    <div class="step-header">
                        <div class="step-number">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12,6 12,12 16,14"/>
                            </svg>
                        </div>
                        <h3>Horários de Funcionamento</h3>
                    </div>
                    <p>Configure os horários em que você está disponível para agendamentos.</p>
                    <div class="step-content">
                        <div class="availability-grid" id="onboardingAvailability">
                            <div class="availability-day" data-day="monday">
                                <div class="day-label">Segunda-feira</div>
                                <div class="time-inputs">
                                    <input type="time" class="form-input time-start" value="09:00">
                                    <span>até</span>
                                    <input type="time" class="form-input time-end" value="18:00">
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span>Disponível</span>
                                </label>
                            </div>
                            <div class="availability-day" data-day="tuesday">
                                <div class="day-label">Terça-feira</div>
                                <div class="time-inputs">
                                    <input type="time" class="form-input time-start" value="09:00">
                                    <span>até</span>
                                    <input type="time" class="form-input time-end" value="18:00">
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span>Disponível</span>
                                </label>
                            </div>
                            <div class="availability-day" data-day="wednesday">
                                <div class="day-label">Quarta-feira</div>
                                <div class="time-inputs">
                                    <input type="time" class="form-input time-start" value="09:00">
                                    <span>até</span>
                                    <input type="time" class="form-input time-end" value="18:00">
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span>Disponível</span>
                                </label>
                            </div>
                            <div class="availability-day" data-day="thursday">
                                <div class="day-label">Quinta-feira</div>
                                <div class="time-inputs">
                                    <input type="time" class="form-input time-start" value="09:00">
                                    <span>até</span>
                                    <input type="time" class="form-input time-end" value="18:00">
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span>Disponível</span>
                                </label>
                            </div>
                            <div class="availability-day" data-day="friday">
                                <div class="day-label">Sexta-feira</div>
                                <div class="time-inputs">
                                    <input type="time" class="form-input time-start" value="09:00">
                                    <span>até</span>
                                    <input type="time" class="form-input time-end" value="18:00">
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span>Disponível</span>
                                </label>
                            </div>
                            <div class="availability-day" data-day="saturday">
                                <div class="day-label">Sábado</div>
                                <div class="time-inputs">
                                    <input type="time" class="form-input time-start" value="09:00">
                                    <span>até</span>
                                    <input type="time" class="form-input time-end" value="14:00">
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span>Disponível</span>
                                </label>
                            </div>
                            <div class="availability-day" data-day="sunday">
                                <div class="day-label">Domingo</div>
                                <div class="time-inputs">
                                    <input type="time" class="form-input time-start" value="09:00" disabled>
                                    <span>até</span>
                                    <input type="time" class="form-input time-end" value="18:00" disabled>
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox">
                                    <span>Disponível</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="onboarding-step" data-step="4">
                    <div class="step-header">
                        <div class="step-number">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20,6 9,17 4,12"/>
                            </svg>
                        </div>
                        <h3>Pronto para Começar!</h3>
                    </div>
                    <p>Seu calendário está configurado e pronto para receber agendamentos. Você pode convidar outras pessoas para se conectarem.</p>
                    <div class="step-content">
                        <div class="onboarding-summary glass">
                            <div class="summary-item">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                <span id="summaryAccountName">Conta conectada</span>
                            </div>
                            <div class="summary-item">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="15" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                <span id="summaryCalendarName">Calendário configurado</span>
                            </div>
                            <div class="summary-item">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12,6 12,12 16,14"/>
                                </svg>
                                <span id="summaryAvailability">Horários definidos</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="onboarding-navigation">
                <button class="btn-secondary" id="onboardingPrev" onclick="previousOnboardingStep()" style="display: none;">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15,18 9,12 15,6"/>
                    </svg>
                    Anterior
                </button>
                <div class="onboarding-dots">
                    <span class="onboarding-dot active" data-step="1"></span>
                    <span class="onboarding-dot" data-step="2"></span>
                    <span class="onboarding-dot" data-step="3"></span>
                    <span class="onboarding-dot" data-step="4"></span>
                </div>
                <button class="btn-primary" id="onboardingNext" onclick="nextOnboardingStep()">
                    Próximo
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9,18 15,12 9,6"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- LAYOUT PRINCIPAL - 3 COLUNAS (ESTILO KALEE) -->
    <main class="main-layout" id="mainLayout">

        <!-- ========== SIDEBAR ESQUERDA ========== -->
        <aside class="sidebar-left">
            <!-- Mini Calendário do Mês -->
            <div class="mini-calendar-section card-lift glow-hover">
                <div class="mini-calendar-header">
                    <button class="mini-nav" onclick="navigateMiniMonth(-1)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15,18 9,12 15,6"/>
                        </svg>
                    </button>
                    <span class="mini-month-title" id="miniMonthTitle">dezembro de 2025</span>
                    <button class="mini-nav" onclick="navigateMiniMonth(1)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9,18 15,12 9,6"/>
                        </svg>
                    </button>
                </div>
                <div class="mini-calendar-weekdays">
                    <span>Seg</span>
                    <span>Ter</span>
                    <span>Qua</span>
                    <span>Qui</span>
                    <span>Sex</span>
                    <span>Sáb</span>
                    <span>Dom</span>
                </div>
                <div class="mini-calendar-days" id="miniCalendarDays">
                    <!-- Renderizado via JS -->
                </div>
            </div>

            <!-- Estatísticas -->
            <div class="statistics-section card-lift glow-hover">
                <h3 class="section-label">Estatísticas</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="statWeeklySessions">0</span>
                            <span class="stat-label">Agendamentos semanais</span>
                        </div>
                    </div>

                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"/>
                                <line x1="12" y1="20" x2="12" y2="4"/>
                                <line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="statMonthlySessions">0</span>
                            <span class="stat-label">Agendamentos mensais</span>
                        </div>
                    </div>

                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 2v4"/>
                                <path d="M16 2v4"/>
                                <rect x="3" y="4" width="18" height="18" rx="2"/>
                                <path d="M3 10h18"/>
                                <path d="M8 14h8"/>
                                <path d="M8 18h5"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="statTotalSessions">0</span>
                            <span class="stat-label">Agendamentos totais</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ========== CALENDÁRIO PRINCIPAL (CENTRO) ========== -->
        <section class="calendar-main">
            <div class="calendar-container" id="calendarContainer">
                <!-- Renderizado via JS: Day View, Week View, ou Month View -->
                <div class="empty-message" id="calendarLoadingMessage">Carregando calendário...</div>
            </div>
        </section>

        <!-- ========== SIDEBAR DIREITA - PRÓXIMOS EVENTOS ========== -->
        <aside class="sidebar-right">
            <div class="sessions-section card-lift glow-hover">
                <h3 class="section-label">Próximos Eventos</h3>
                <div class="sessions-list" id="sessionsList">
                    <!-- Renderizado via JS -->
                    <div class="empty-message" id="eventsLoadingMessage">Carregando eventos...</div>
                </div>
            </div>
        </aside>
    </main>

    <!-- ========== MODAIS ========== -->

    <!-- Modal: Gerenciar Contas - REDESIGN -->
    <div class="modal-overlay" id="inviteModal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <div class="modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <h2>Gerenciar Contas</h2>
                </div>
                <button class="btn-close" onclick="closeInviteModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>

            <!-- Tabs Redesenhadas -->
            <div class="modal-tabs-container">
                <div class="modal-tabs">
                    <button class="modal-tab active" data-tab="send" onclick="switchModalTab('send')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                        <span>Enviar Convite</span>
                    </button>
                    <button class="modal-tab" data-tab="pending" onclick="switchModalTab('pending')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                        <span>Pendentes</span>
                        <span class="tab-badge" id="pendingCount">0</span>
                    </button>
                    <button class="modal-tab" data-tab="connected" onclick="switchModalTab('connected')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22,4 12,14.01 9,11.01"/>
                        </svg>
                        <span>Conectados</span>
                        <span class="tab-badge success" id="connectedCount">0</span>
                    </button>
                </div>
            </div>

            <div class="modal-body">
                <!-- Tab: Enviar Convite -->
                <div class="tab-content active" id="tabSend">
                    <div class="invite-form-container">
                        <div class="invite-illustration">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="1">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22,6 12,13 2,6"/>
                            </svg>
                            <p>Convide colaboradores para conectar suas agendas Google</p>
                        </div>
                        <form id="inviteForm" onsubmit="handleSendInvite(event)">
                            <div class="form-group">
                                <label>Nome do colaborador</label>
                                <input type="text" class="form-input" id="inviteName" placeholder="Nome completo" required>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" class="form-input" id="inviteEmail" placeholder="email@empresa.com" required>
                            </div>
                            <button type="submit" class="btn-primary btn-block">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                                </svg>
                                Enviar Convite
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Tab: Convites Pendentes -->
                <div class="tab-content" id="tabPending">
                    <div class="list-container" id="pendingList">
                        <!-- Renderizado via JS -->
                    </div>
                </div>

                <!-- Tab: Contas Conectadas -->
                <div class="tab-content" id="tabConnected">
                    <div class="list-container" id="connectedList">
                        <!-- Renderizado via JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Configurações do Calendário -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h2>
                    <svg class="icon icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    Configurações do Calendário
                </h2>
                <button class="btn-close" onclick="closeSettingsModal()">×</button>
            </div>

            <!-- ABAS DO SISTEMA -->
            <div style="display: flex; border-bottom: 1px solid var(--border); background: rgba(255, 255, 255, 0.02);">
                <button class="settings-tab active" data-tab="configuracoes" onclick="switchSettingsTab('configuracoes')" style="flex: 1; padding: 16px 24px; background: transparent; border: none; color: var(--text-primary); font-weight: 600; cursor: pointer; border-bottom: 3px solid var(--primary); transition: all 0.3s;">
                    Configurações
                </button>
                <button class="settings-tab" data-tab="lembretes" onclick="switchSettingsTab('lembretes')" style="flex: 1; padding: 16px 24px; background: transparent; border: none; color: var(--text-secondary); font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s;">
                    Lembretes
                </button>
                <button class="settings-tab" data-tab="notificacoes" onclick="switchSettingsTab('notificacoes')" style="flex: 1; padding: 16px 24px; background: transparent; border: none; color: var(--text-secondary); font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s;">
                    Notificações
                </button>
            </div>

            <!-- CONTEÚDO DAS ABAS -->
            <div class="modal-body" style="padding: 32px;">

                <!-- ABA: Configurações -->
                <div id="tabConfiguracoes" class="settings-tab-content active">
                    <form id="settingsForm" onsubmit="handleSaveSettings(event)">
                        <div class="form-group">
                            <label>Nome do Calendário</label>
                            <input type="text" class="form-input" id="calendarName" placeholder="Calendário Principal">
                        </div>
                        <div class="form-group">
                            <label>Duração padrão dos eventos</label>
                            <select class="form-select" id="defaultDuration">
                                <option value="15">15 minutos</option>
                                <option value="30" selected>30 minutos</option>
                                <option value="45">45 minutos</option>
                                <option value="60">1 hora</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Máximo de dias para agendamento</label>
                            <select class="form-select" id="maxDays">
                                <option value="7">7 dias</option>
                                <option value="15">15 dias</option>
                                <option value="30" selected>30 dias</option>
                                <option value="60">60 dias</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeSettingsModal()">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar</button>
                        </div>
                    </form>
                </div>

                <!-- ABA: Lembretes -->
                <div id="tabLembretes" class="settings-tab-content" style="display: none;">
                    <div style="margin-bottom: 24px; padding: 16px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 8px; display: flex; gap: 12px;">
                        <svg class="icon" style="color: var(--info); flex-shrink: 0; margin-top: 2px;" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">Configure lembretes automáticos por WhatsApp para leads antes dos agendamentos</p>
                    </div>

                    <form onsubmit="saveReminderSettings(event)">
                        <div class="form-group" style="margin-bottom: 24px;">
                            <label for="reminderTemplate" style="display: block; margin-bottom: 8px; font-weight: 600;">Mensagem do Lembrete</label>
                            <textarea id="reminderTemplate" class="form-control" rows="4" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;" placeholder="Olá {{nome}}, lembrete da sua reunião em {{data_hora}}.">Olá {{nome}}, lembrete da sua reunião em {{data_hora}}.</textarea>
                            <small style="display: block; margin-top: 6px; color: var(--text-muted); font-size: 0.85rem;">Variáveis: {{nome}}, {{data_hora}}</small>
                        </div>

                        <!-- Preset de Lembretes -->
                        <div style="margin-bottom: 24px;">
                            <label for="reminderPreset" style="display: block; margin-bottom: 8px; font-weight: 600;">Lembretes Automáticos</label>
                            <select id="reminderPreset" class="form-control" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); cursor: pointer;">
                                <option value="nenhum">Desativado</option>
                                <option value="basico">Básico (24h + 1h antes)</option>
                                <option value="completo">Completo (24h + 4h + 1h + 10min antes)</option>
                                <option value="personalizado">Personalizado</option>
                            </select>
                        </div>

                        <!-- Campos de Personalização dos Lembretes -->
                        <div id="msg24hGroup" class="form-group" style="margin-bottom: 24px; display: none;">
                            <label for="msg24h" style="display: block; margin-bottom: 8px; font-weight: 600;">Mensagem 24h antes</label>
                            <textarea id="msg24h" class="form-control" rows="3" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;" placeholder="Olá {{nome}}, amanhã temos nossa reunião às {{data_hora}}!">Olá {{nome}}, amanhã temos nossa reunião às {{data_hora}}!</textarea>
                        </div>

                        <div id="msg4hGroup" class="form-group" style="margin-bottom: 24px; display: none;">
                            <label for="msg4h" style="display: block; margin-bottom: 8px; font-weight: 600;">Mensagem 4h antes</label>
                            <textarea id="msg4h" class="form-control" rows="3" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;" placeholder="Oi {{nome}}! Faltam 4 horas para nossa reunião!">Oi {{nome}}! Faltam 4 horas para nossa reunião!</textarea>
                        </div>

                        <div id="msg1hGroup" class="form-group" style="margin-bottom: 24px; display: none;">
                            <label for="msg1h" style="display: block; margin-bottom: 8px; font-weight: 600;">Mensagem 1h antes</label>
                            <textarea id="msg1h" class="form-control" rows="3" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;" placeholder="Oi {{nome}}! Falta 1 hora para nossa reunião!">Oi {{nome}}! Falta 1 hora para nossa reunião!</textarea>
                        </div>

                        <div id="msg10mGroup" class="form-group" style="margin-bottom: 24px; display: none;">
                            <label for="msg10m" style="display: block; margin-bottom: 8px; font-weight: 600;">Mensagem 10min antes</label>
                            <textarea id="msg10m" class="form-control" rows="3" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;" placeholder="Em 10 minutos entramos online! Até já {{nome}}!">Em 10 minutos entramos online! Até já {{nome}}!</textarea>
                        </div>

                        <!-- Instância WhatsApp -->
                        <div class="form-group" style="margin-bottom: 24px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Instância WhatsApp</label>
                            <select id="whatsappInstanceReminder" class="form-control" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); cursor: pointer;">
                                <option value="">Selecione uma instância</option>
                            </select>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeSettingsModal()">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Lembretes</button>
                        </div>
                    </form>
                </div>

                <!-- ABA: Notificações -->
                <div id="tabNotificacoes" class="settings-tab-content" style="display: none;">
                    <div style="margin-bottom: 24px; padding: 16px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 8px; display: flex; gap: 12px;">
                        <svg class="icon" style="color: var(--info); flex-shrink: 0; margin-top: 2px;" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">Receba notificação no WhatsApp quando uma reunião for agendada</p>
                    </div>

                    <form onsubmit="saveNotificationSettings(event)">
                        <div style="margin-bottom: 24px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="notifyEnabled" style="width: 18px; height: 18px; cursor: pointer;">
                                <label for="notifyEnabled" style="cursor: pointer; font-weight: 600; color: var(--text-primary); font-size: 1.05rem;">Notificar quando agendar</label>
                            </div>
                        </div>

                        <div id="notificationFields" style="display: none;">
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Instância WhatsApp</label>
                                <select id="whatsappInstanceNotif" class="form-control" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); cursor: pointer;">
                                    <option value="">Selecione uma instância</option>
                                </select>
                            </div>

                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Contato para Notificações</label>
                                <button type="button" onclick="selectWhatsAppGroup()" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; transition: all 0.2s;">
                                    <svg class="icon icon-sm" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                                    </svg>
                                    Selecionar Contato
                                </button>

                                <div id="selectedGroup" style="display: none; margin-top: 12px; padding: 12px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 8px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <svg class="icon" style="color: var(--success);" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        <span style="font-weight: 600;" id="selectedGroupName"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group" style="margin-bottom: 24px;">
                                <label for="notificationTemplate" style="display: block; margin-bottom: 8px; font-weight: 600;">Mensagem da Notificação</label>
                                <textarea id="notificationTemplate" rows="4" class="form-control" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;" placeholder="Nova reunião agendada com {{lead_name}} para {{data_hora}}.">Nova reunião agendada com {{lead_name}} para {{data_hora}}.</textarea>
                                <small style="display: block; margin-top: 6px; color: var(--text-muted); font-size: 0.85rem;">Variáveis: {{closer_name}}, {{data_hora}}, {{lead_name}}, {{lead_phone}}, {{lead_email}}</small>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeSettingsModal()">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Notificações</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal: Criar Evento Manual -->
    <div class="modal-overlay" id="createEventModal">
        <div class="modal">
            <div class="modal-header">
                <h2>
                    <svg class="icon icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="15" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                        <line x1="12" y1="14" x2="12" y2="18"/>
                        <line x1="10" y1="16" x2="14" y2="16"/>
                    </svg>
                    Novo Agendamento
                </h2>
                <button class="btn-close" onclick="closeCreateEventModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="createEventForm" onsubmit="handleCreateEvent(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Data e Hora</label>
                            <input type="datetime-local" class="form-input" id="eventDateTime" required>
                        </div>
                        <div class="form-group">
                            <label>Duração</label>
                            <select class="form-select" id="eventDuration">
                                <option value="15">15 min</option>
                                <option value="30" selected>30 min</option>
                                <option value="45">45 min</option>
                                <option value="60">1 hora</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Título do Evento</label>
                        <input type="text" class="form-input" id="eventTitle" placeholder="Ex: Reunião com Cliente">
                    </div>
                    <div class="form-group">
                        <label>Nome do Cliente</label>
                        <input type="text" class="form-input" id="eventClientName" placeholder="Nome do cliente">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-input" id="eventClientEmail" placeholder="email@cliente.com">
                        </div>
                        <div class="form-group">
                            <label>Telefone</label>
                            <input type="tel" class="form-input" id="eventClientPhone" placeholder="+55 11 99999-9999">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Responsável (Agenda)</label>
                        <select class="form-select" id="eventConnection">
                            <!-- Populado via JS com as contas conectadas -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="createMeetLink" checked>
                            <span>Criar link do Google Meet automaticamente</span>
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeCreateEventModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">Criar Evento</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Detalhes do Evento -->
    <div class="modal-overlay" id="eventDetailModal">
        <div class="modal">
            <div class="modal-header">
                <h2>
                    <svg class="icon icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10,9 9,9 8,9"/>
                    </svg>
                    Detalhes do Evento
                </h2>
                <button class="btn-close" onclick="closeEventDetailModal()">×</button>
            </div>
            <div class="modal-body" id="eventDetailContent">
                <!-- Renderizado via JS -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Modal: Criar Novo Calendário -->
    <div class="modal-overlay" id="createCalendarModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <h2>Novo Calendário</h2>
                </div>
                <button class="btn-close" onclick="closeCreateCalendarModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <form id="createCalendarForm" onsubmit="handleCreateCalendar(event)">
                    <div class="form-group">
                        <label>Nome do Calendário</label>
                        <input type="text" class="form-input" id="newCalendarName"
                               placeholder="Ex: Reuniões de Vendas" required>
                    </div>

                    <div class="form-group">
                        <label>Título do Evento</label>
                        <input type="text" class="form-input" id="newCalendarEventTitle"
                               placeholder="Ex: Reunião - Sua Empresa" required>
                        <small class="form-hint">Como os eventos serão nomeados no Google Agenda</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Duração (minutos)</label>
                            <select class="form-input" id="newCalendarDuration">
                                <option value="15">15 min</option>
                                <option value="30" selected>30 min</option>
                                <option value="45">45 min</option>
                                <option value="60">60 min</option>
                                <option value="90">90 min</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Antecedência máxima</label>
                            <select class="form-input" id="newCalendarMaxDays">
                                <option value="7">7 dias</option>
                                <option value="14">14 dias</option>
                                <option value="30" selected>30 dias</option>
                                <option value="60">60 dias</option>
                                <option value="90">90 dias</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary btn-block">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Criar Calendário
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Aviso para Criar Calendário -->
    <div class="modal-overlay" id="createCalendarWarningModal" style="display: none;">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                        <line x1="12" y1="14" x2="12" y2="18"></line>
                        <line x1="10" y1="16" x2="14" y2="16"></line>
                    </svg>
                    <h2>Crie seu calendário</h2>
                </div>
            </div>

            <div class="modal-body" style="text-align: center; padding: 2rem;">
                <div style="margin-bottom: 1.5rem;">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="1" style="opacity: 0.6; margin-bottom: 1rem;">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                        <line x1="12" y1="14" x2="12" y2="18"></line>
                        <line x1="10" y1="16" x2="14" y2="16"></line>
                    </svg>
                </div>

                <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Bem-vindo ao Calendário!</h3>
                <p style="color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.5;">
                    Para começar a receber agendamentos e utilizar a plataforma, você precisa criar seu primeiro calendário.
                </p>

                <button class="btn-primary" onclick="openCreateCalendarFromWarning()" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 20px; margin-bottom: 1rem;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0;">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span style="line-height: 1;">Criar meu calendário</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== ESTADO GLOBAL =====
        const state = {
            currentView: 'week',           // 'day' | 'week' | 'month'
            currentDate: new Date(),       // Data sendo visualizada
            miniCalendarDate: new Date(),  // Mês do mini calendário
            calendar: null,                // Calendário atual
            events: [],                    // Eventos carregados
            connections: [],               // Contas Google conectadas
            invites: [],                   // Convites pendentes
            members: [],                   // Membros do calendário
            userData: null                 // { tenant_id, email }
        };

        // ===== ESTADO DOS CALENDÁRIOS (SISTEMA DE ABAS) =====
        let calendars = [];               // Lista de todos os calendários
        let activeCalendarId = null;      // ID do calendário ativo
        let calendarEvents = {};          // Cache de eventos por calendário { calendar_id: [events] }

        // ===== ENDPOINTS DA API =====
        const API_BASE = 'https://sdr.salesdever.io/webhook/';

        const ENDPOINTS = {
            // Conexões Google Calendar
            listConnections: 'calendar-listar-conexoes',      // POST { tenant_id }
            disconnectCalendar: 'calendar-desconectar',       // POST { connection_id }

            // Convites
            listInvites: 'calendar-listar-convites',          // POST { tenant_id }
            sendInvite: 'calendar-enviar-convite',            // POST { tenant_id, name, email }
            resendInvite: 'calendar-reenviar-convite',        // POST { invite_id }
            deleteInvite: 'calendar-deletar-convite',         // POST { invite_id }

            // Calendários (CORRIGIDO - apenas path, sem API_BASE)
            listCalendars: 'calendarios-listar',
            createCalendar: 'calendarios-criar',
            updateCalendar: 'calendarios-atualizar',
            deleteCalendar: 'calendarios-deletar',
            getCalendarDetails: 'calendarios-detalhes',

            // Membros do Calendário
            listMembers: 'calendarios-membros-listar',
            addMember: 'calendarios-membros-adicionar',
            removeMember: 'calendarios-membros-remover',

            // Eventos (CORRIGIDO - apenas path, sem API_BASE)
            listEvents: 'calendarios-eventos-listar',
            createEvent: 'calendar-criar-evento',             // POST { tenant_id, connection_id, start_time, duration, event_title, lead_name, lead_email, lead_phone, source, create_meet }

            // ===== LEMBRETES (ADICIONE AQUI) =====
            saveReminderSettings: 'calendar-reminder-settings-save',
            getReminderSettings: 'calendar-reminder-settings-get',
            saveNotificationSettings: 'calendar-notification-settings-save',
            getNotificationSettings: 'calendar-notification-settings-get',
            getWhatsAppGroups: 'calendar-whatsapp-groups',
            getWhatsAppInstances: 'saas-buscar-instancias'
        };

        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', initApp);

        async function initApp() {
            console.log('[INIT] Inicializando aplicação...');

            // 1. Carregar dados do usuário
            state.userData = getUserData();

            console.log('[INIT] User data:', state.userData);

            if (!state.userData || !state.userData.tenant_id) {
                showToast('Erro: faça login novamente', 'error');
                console.error('[INIT] Dados do usuário não encontrados');
                return;
            }

            showToast('Carregando dados...', 'info');

            try {
                // 2. Carregar dados básicos primeiro
                const [connectionsRes, calendarsRes] = await Promise.all([
                    apiCall(ENDPOINTS.listConnections, { tenant_id: state.userData.tenant_id }),
                    apiCall(ENDPOINTS.listCalendars, { tenant_id: state.userData.tenant_id })
                ]);

                console.log('[INIT] ========= DEBUG CALENDÁRIOS =========');
                console.log('[INIT] connectionsRes:', connectionsRes);
                console.log('[INIT] calendarsRes:', calendarsRes);

                state.connections = connectionsRes.conexoes || [];

                // Filtrar apenas calendários válidos (com ID e nome)
                const rawCalendars = calendarsRes.calendarios || [];
                console.log('[INIT] Raw calendars from webhook:', rawCalendars);
                console.log('[INIT] Tipo de rawCalendars:', typeof rawCalendars);
                console.log('[INIT] Array.isArray(rawCalendars):', Array.isArray(rawCalendars));

                state.calendars = rawCalendars.filter(cal =>
                    cal &&
                    typeof cal === 'object' &&
                    cal.id &&
                    cal.name &&
                    cal.name.trim() !== ''
                );

                console.log('[INIT] Valid calendars after filtering:', state.calendars);
                console.log('[INIT] state.calendars.length:', state.calendars.length);
                console.log('[INIT] ========= FIM DEBUG CALENDÁRIOS =========');

                // 3. Renderizar abas dos calendários
                renderCalendarTabs();

                // 4. Pular onboarding - ir direto ao calendário
                console.log('[INIT] Pulando onboarding - indo direto ao calendário');

                // Se não há calendários, apenas mostrar estado vazio
                if (state.calendars.length === 0) {
                    console.log('[INIT] Sem calendários - mostrar estado vazio');
                    showNoCalendarsState();
                    return; // Parar aqui para não continuar carregamento
                }

                // 5. Restaurar mensagens normais e ativar o primeiro calendário
                restoreNormalLoadingMessages();
                updateInviteButtonVisibility();
                updateAddCalendarButtonVisibility();
                if (state.calendars.length > 0) {
                    await switchToCalendar(state.calendars[0].id);
                }

                // 6. Carregar dados completos
                await loadAllData();

                // 7. Garantir que o layout principal está visível
                document.getElementById('mainLayout').style.display = 'grid';

                // 8. Renderizar interface
                renderMiniCalendar();
                renderMainCalendar();
                renderSessionsList();
                updateStatistics();
                updatePeriodDisplay();

                // 9. Setup eventos
                setupEventListeners();

                showToast('Calendário carregado com sucesso!', 'success');

            } catch (error) {
                console.error('Erro na inicialização:', error);
                showToast('Erro ao carregar dados do calendário', 'error');
            }
        }

        function getUserData() {
            try {
                const userData = JSON.parse(localStorage.getItem('userData'));
                if (userData && userData.tenant_id) {
                    return userData;
                }

                // Fallback para localStorage direto
                const tenant_id = localStorage.getItem('tenant_id');
                const email = localStorage.getItem('userEmail');

                // Buscar nome da empresa/conta em diferentes possibilidades
                const companyName = localStorage.getItem('companyName') ||
                                  localStorage.getItem('company_name') ||
                                  localStorage.getItem('tenant_name') ||
                                  localStorage.getItem('accountName') ||
                                  localStorage.getItem('userName');

                if (tenant_id) {
                    return {
                        tenant_id,
                        email,
                        company_name: companyName
                    };
                }

                return null;
            } catch (error) {
                console.error('Erro ao obter dados do usuário:', error);
                return null;
            }
        }

        async function loadAllData() {
            try {
                // Carregar em paralelo
                const [calendarsRes, connectionsRes, invitesRes] = await Promise.all([
                    apiCall(ENDPOINTS.listCalendars, { tenant_id: state.userData.tenant_id }),
                    apiCall(ENDPOINTS.listConnections, { tenant_id: state.userData.tenant_id }),
                    apiCall(ENDPOINTS.listInvites, { tenant_id: state.userData.tenant_id })
                ]);

                state.connections = connectionsRes.conexoes || [];
                state.invites = invitesRes.convites || [];

                const calendarsList = calendarsRes.calendarios || [];
                console.log('[LOAD_ALL_DATA] Raw calendars from webhook:', calendarsList);

                // Filtrar apenas calendários válidos (com ID e nome)
                const validCalendars = calendarsList.filter(cal =>
                    cal &&
                    typeof cal === 'object' &&
                    cal.id &&
                    cal.name &&
                    cal.name.trim() !== ''
                );

                console.log('[LOAD_ALL_DATA] Valid calendars after filtering:', validCalendars);
                calendars = validCalendars; // Update global calendars variable
                if (validCalendars.length > 0) {
                    // Restaurar mensagens de carregamento normais quando há calendários
                    restoreNormalLoadingMessages();

                    // Mostrar botão "Enviar Convite"
                    updateInviteButtonVisibility();
                    updateAddCalendarButtonVisibility();

                    state.calendar = validCalendars[0];

                    // Carregar membros e eventos
                    const [membersRes, eventsRes] = await Promise.all([
                        apiCall(ENDPOINTS.listMembers, { calendar_id: state.calendar.id }),
                        apiCall(ENDPOINTS.listEvents, { tenant_id: state.userData.tenant_id, calendar_id: state.calendar.id })
                    ]);

                    state.members = membersRes.membros || [];
                    state.events = eventsRes.eventos || [];
                } else {
                    // Quando não há calendários, limpar estados e mostrar UI apropriada
                    state.calendar = null;
                    state.members = [];
                    state.events = [];

                    // Atualizar as abas para refletir estado vazio
                    renderCalendarTabs();

                    // Pular onboarding - mostrar estado sem calendários
                    console.log('[INIT] Sem calendários - mostrando estado padrão');
                    showNoCalendarsState();
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                throw error;
            }
        }


        // ===== API HELPER =====
        async function apiCall(endpoint, data) {
            try {
                console.log(`[API] Calling endpoint: ${endpoint}`, data);

                const response = await fetch(API_BASE + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                console.log(`[API] Response status: ${response.status}`);

                // Verificar se a resposta tem conteúdo
                const contentType = response.headers.get('content-type');
                const responseText = await response.text();

                console.log(`[API] Content-Type: ${contentType}`);
                console.log(`[API] Response text:`, responseText);

                // Se não há conteúdo ou resposta vazia
                if (!responseText || responseText.trim() === '') {
                    if (response.ok) {
                        return { success: true, message: 'Operação realizada com sucesso' };
                    } else {
                        throw new Error(`HTTP ${response.status}: Erro na operação`);
                    }
                }

                let result;

                // Tentar parsear JSON apenas se há conteúdo
                try {
                    result = JSON.parse(responseText);
                } catch (jsonError) {
                    console.error('[API] JSON Parse Error:', jsonError);
                    // Se não conseguir parsear, mas a resposta foi bem-sucedida
                    if (response.ok) {
                        return { success: true, message: responseText };
                    } else {
                        throw new Error(`Resposta inválida: ${responseText}`);
                    }
                }

                // Alguns endpoints retornam array
                if (Array.isArray(result)) {
                    result = result[0] || { success: false };
                }

                if (!result.success && result.error) {
                    throw new Error(result.error);
                }

                return result;
            } catch (error) {
                console.error(`[API] Error (${endpoint}):`, error);
                throw error;
            }
        }

        // ===== RENDERIZAÇÃO DO CALENDÁRIO =====

        function renderMainCalendar() {
            const container = document.getElementById('calendarContainer');

            switch (state.currentView) {
                case 'day':
                    container.innerHTML = renderDayView();
                    break;
                case 'week':
                    container.innerHTML = renderWeekView();
                    break;
                case 'month':
                    container.innerHTML = renderMonthView();
                    break;
            }

            setupCalendarClickEvents();
        }

        function renderWeekView() {
            const weekStart = getWeekStart(state.currentDate);
            const days = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date(weekStart);
                d.setDate(weekStart.getDate() + i);
                days.push(d);
            }

            // Header
            let html = `
                <div class="week-header">
                    <div class="time-gutter-header"></div>
                    ${days.map(d => `
                        <div class="day-header ${isToday(d) ? 'today' : ''}">
                            <span class="day-name">${d.toLocaleDateString('pt-BR', { weekday: 'short' }).toUpperCase()}</span>
                            <span class="day-number ${isToday(d) ? 'today' : ''}">${d.getDate()}</span>
                        </div>
                    `).join('')}
                </div>
            `;

            // Grid de horas (7h às 19h)
            html += '<div class="week-body">';
            for (let hour = 7; hour < 20; hour++) {
                html += `
                    <div class="hour-row">
                        <div class="time-gutter">${hour.toString().padStart(2, '0')}:00</div>
                        ${days.map(d => {
                            const slotEvents = getEventsForSlot(d, hour);
                            const eventsWithLayout = calculateEventLayout(slotEvents);
                            return `
                                <div class="day-slot ${isToday(d) ? 'today' : ''}"
                                     data-date="${d.toISOString()}" data-hour="${hour}">
                                    ${eventsWithLayout.map((e, i) => renderEventBlockWithLayout(e, i)).join('')}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            html += '</div>';

            return html;
        }

        function renderMonthView() {
            const year = state.currentDate.getFullYear();
            const month = state.currentDate.getMonth();
            const firstDay = new Date(year, month, 1);

            // Ajustar para começar na segunda-feira
            const startDate = new Date(firstDay);
            const dayOfWeek = startDate.getDay();
            startDate.setDate(startDate.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

            const dayNames = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];

            let html = `
                <div class="month-header">
                    ${dayNames.map(n => `<div class="month-day-name">${n}</div>`).join('')}
                </div>
                <div class="month-grid">
            `;

            const current = new Date(startDate);
            for (let i = 0; i < 42; i++) {
                const isCurrentMonth = current.getMonth() === month;
                const dayEvents = getEventsForDay(current);

                html += `
                    <div class="month-day ${!isCurrentMonth ? 'other-month' : ''} ${isToday(current) ? 'today' : ''}"
                         data-date="${current.toISOString()}">
                        <span class="month-day-num ${isToday(current) ? 'today' : ''}">${current.getDate()}</span>
                        <div class="month-events">
                            ${dayEvents.slice(0, 3).map(e => `
                                <div class="month-event" onclick="showEventDetail('${e.id}')">${e.event_title || e.lead_name || 'Reunião'}</div>
                            `).join('')}
                            ${dayEvents.length > 3 ? `<span class="month-more">+${dayEvents.length - 3}</span>` : ''}
                        </div>
                    </div>
                `;
                current.setDate(current.getDate() + 1);
            }

            html += '</div>';
            return html;
        }

        function renderDayView() {
            const date = state.currentDate;

            let html = `
                <div class="day-view-header">
                    <span class="day-view-number ${isToday(date) ? 'today' : ''}">${date.getDate()}</span>
                    <span class="day-view-name">${date.toLocaleDateString('pt-BR', { weekday: 'long', month: 'long', year: 'numeric' })}</span>
                </div>
                <div class="day-view-body">
            `;

            for (let hour = 7; hour < 20; hour++) {
                const slotEvents = getEventsForSlot(date, hour);
                const eventsWithLayout = calculateEventLayout(slotEvents);
                html += `
                    <div class="hour-row">
                        <div class="time-gutter">${hour.toString().padStart(2, '0')}:00</div>
                        <div class="day-slot single" data-date="${date.toISOString()}" data-hour="${hour}">
                            ${eventsWithLayout.map((e, i) => renderEventBlockWithLayout(e, i)).join('')}
                        </div>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        function renderEventBlock(event, index) {
            const colors = ['purple', 'green', 'blue', 'orange'];
            const color = colors[index % colors.length];
            const startTime = new Date(event.start_time);

            return `
                <div class="event-block color-${color}" onclick="showEventDetail('${event.id}')">
                    <span class="event-time">${startTime.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</span>
                    <span class="event-title">${event.event_title || event.lead_name || 'Reunião'}</span>
                </div>
            `;
        }

        // Nova função para renderizar eventos com layout de sobreposição
        function renderEventBlockWithLayout(event, index) {
            const colors = ['purple', 'green', 'blue', 'orange'];
            const color = colors[index % colors.length];
            const startTime = new Date(event.start_time);

            const overlappedClass = event.isOverlapped ? 'overlapped' : '';
            const widthStyle = event.isOverlapped ? `width: calc(${event.layoutWidth}% - 2px);` : '';
            const leftStyle = event.isOverlapped ? `left: calc(${event.layoutLeft}% + 4px);` : '';

            return `
                <div class="event-block color-${color} ${overlappedClass}"
                     style="${widthStyle} ${leftStyle}"
                     onclick="showEventDetail('${event.id}')">
                    <span class="event-time">${startTime.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</span>
                    <span class="event-title">${event.event_title || event.lead_name || 'Reunião'}</span>
                </div>
            `;
        }

        // ===== MINI CALENDÁRIO =====

        function renderMiniCalendar() {
            const container = document.getElementById('miniCalendarDays');
            const titleEl = document.getElementById('miniMonthTitle');

            const year = state.miniCalendarDate.getFullYear();
            const month = state.miniCalendarDate.getMonth();

            titleEl.textContent = state.miniCalendarDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            const dayOfWeek = startDate.getDay();
            startDate.setDate(startDate.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

            let html = '';
            const current = new Date(startDate);

            for (let i = 0; i < 42; i++) {
                const isCurrentMonth = current.getMonth() === month;
                const isSelected = current.toDateString() === state.currentDate.toDateString();
                const isTodayDate = isToday(current);
                const hasEvents = getEventsForDay(current).length > 0;

                html += `
                    <div class="mini-day ${!isCurrentMonth ? 'other-month' : ''} ${isTodayDate ? 'today' : ''} ${isSelected ? 'selected' : ''} ${hasEvents ? 'has-events' : ''}"
                         onclick="selectDate('${current.toISOString()}')">
                        ${current.getDate()}
                    </div>
                `;
                current.setDate(current.getDate() + 1);
            }

            container.innerHTML = html;
        }

        // ===== SIDEBAR DIREITA - SESSIONS =====

        function renderSessionsList() {
            console.log('[RenderSessionsList] Iniciando renderização da lista de sessões');
            console.log('[RenderSessionsList] state.events:', state.events);

            const container = document.getElementById('sessionsList');
            const now = new Date();

            // Próximos eventos (ordenados por data)
            const upcoming = state.events
                .filter(e => new Date(e.start_time) >= now)
                .sort((a, b) => new Date(a.start_time) - new Date(b.start_time))
                .slice(0, 8);

            console.log('[RenderSessionsList] Eventos próximos encontrados:', upcoming.length);

            if (upcoming.length === 0) {
                console.log('[RenderSessionsList] Nenhum evento próximo, mostrando mensagem vazia');
                container.innerHTML = '<div class="empty-message">Nenhum evento próximo</div>';
                return;
            }

            container.innerHTML = upcoming.map(event => {
                const startTime = new Date(event.start_time);
                const endTime = event.end_time ? new Date(event.end_time) : null;
                const connection = state.connections.find(c => c.id === event.connection_id);

                // Calcular duração correta: se tem end_time, usar diferença; senão usar duration; senão padrão 60min
                let duration;
                if (endTime && startTime) {
                    duration = Math.round((endTime - startTime) / (1000 * 60)); // diferença em minutos
                } else if (event.duration) {
                    duration = event.duration;
                } else {
                    duration = 60; // padrão de 1 hora
                }

                return `
                    <div class="session-item" onclick="showEventDetail('${event.id}')">
                        <div class="session-color"></div>
                        <div class="session-content">
                            <div class="session-header">
                                <div class="session-title">${event.event_title || event.lead_name || 'Reunião'}</div>
                                <span class="session-badge">${getTimeUntil(startTime)}</span>
                            </div>
                            <div class="session-meta">
                                ${event.google_meet_link ? '<svg class="icon session-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg> Meet' : ''}
                                <svg class="icon session-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> ${(connection?.google_name || event.lead_name || 'N/A').split(' ')[0]}
                            </div>
                            <div class="session-time">
                                <svg class="icon session-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg> ${startTime.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                                <span class="session-duration">• ${duration} mins</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== SISTEMA DE ABAS DOS CALENDÁRIOS =====

        // Renderizar abas dos calendários
        function renderCalendarTabs() {
            const calendars = state.calendars || [];
            const container = document.getElementById('calendarTabs');

            console.log('[RenderCalendarTabs] Renderizando tabs, calendários encontrados:', calendars.length);

            if (calendars.length === 0) {
                console.log('[RenderCalendarTabs] Sem calendários, mostrando botão criar');
                container.innerHTML = `
                    <div class="calendar-tab empty-tab" onclick="openCreateCalendarModal()">
                        <span class="tab-name">Criar primeiro calendário</span>
                    </div>
                `;
                return;
            }

            console.log('[RenderCalendarTabs] Renderizando', calendars.length, 'calendários:', calendars);
            container.innerHTML = calendars.map(cal => {
                const isActive = cal.id === activeCalendarId;
                const eventCount = calendarEvents[cal.id]?.length || 0;

                return `
                    <div class="calendar-tab ${isActive ? 'active' : ''}"
                         data-calendar-id="${cal.id}"
                         onclick="switchToCalendar('${cal.id}')">
                        <div class="tab-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                        </div>
                        <span class="tab-name">${cal.name || 'Sem nome'}</span>
                        ${eventCount > 0 ? `<span class="tab-badge">${eventCount}</span>` : ''}
                        <button class="tab-close" onclick="closeCalendarTab(event, '${cal.id}')" title="Fechar">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');

            // Atualizar visibilidade do botão de adicionar calendário
            updateAddCalendarButtonVisibility();
        }

        // Trocar para calendário específico (clicar na aba)
        async function switchToCalendar(calendarId) {
            console.log('[SwitchToCalendar] Trocando para:', calendarId);

            // Atualizar ID ativo
            activeCalendarId = calendarId;

            // Atualizar visual das abas
            document.querySelectorAll('.calendar-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.calendarId === calendarId);
            });

            // Buscar eventos do calendário selecionado
            await loadCalendarEvents(calendarId);

            console.log('[SwitchToCalendar] Eventos carregados, renderizando interface...');

            // Atualizar o calendário visual com os eventos
            renderMainCalendar();

            // Atualizar lista de próximos eventos
            renderSessionsList();

            // Atualizar estatísticas
            updateStatistics();

            console.log('[SwitchToCalendar] Finalizada troca de calendário');
        }

        // Carregar eventos do calendário
        async function loadCalendarEvents(calendarId) {
            console.log('[LoadCalendarEvents] Carregando eventos do calendário:', calendarId);

            // Verificar cache
            if (calendarEvents[calendarId]) {
                console.log('[LoadCalendarEvents] Usando cache');
                state.events = calendarEvents[calendarId];
                return;
            }

            try {
                console.log('[LoadCalendarEvents] Fazendo chamada API para:', ENDPOINTS.listEvents);
                console.log('[LoadCalendarEvents] Parâmetros:', { calendar_id: calendarId, tenant_id: state.userData.tenant_id });

                // ✅ USAR apiCall em vez de fetch direto
                const data = await apiCall(ENDPOINTS.listEvents, {
                    calendar_id: calendarId,
                    tenant_id: state.userData.tenant_id
                });

                console.log('[LoadCalendarEvents] Resposta da API:', data);

                const events = data.events || data.eventos || [];
                console.log('[LoadCalendarEvents] Eventos extraídos:', events);

                // Salvar no cache
                calendarEvents[calendarId] = events;

                // Atualizar estado global
                state.events = events;

                console.log('[LoadCalendarEvents] Eventos carregados no state:', events.length);
                console.log('[LoadCalendarEvents] state.events atual:', state.events);

                // Atualizar badge na aba
                updateTabBadge(calendarId, events.length);

            } catch (error) {
                console.error('[LoadCalendarEvents] Erro:', error);
                state.events = [];
            }
        }

        // Atualizar badge da aba
        function updateTabBadge(calendarId, count) {
            const tab = document.querySelector(`.calendar-tab[data-calendar-id="${calendarId}"]`);
            if (!tab) return;

            let badge = tab.querySelector('.tab-badge');

            if (count > 0) {
                if (!badge) {
                    badge = document.createElement('span');
                    badge.className = 'tab-badge';
                    tab.insertBefore(badge, tab.querySelector('.tab-close'));
                }
                badge.textContent = count;
            } else if (badge) {
                badge.remove();
            }
        }

        // Fechar/deletar aba do calendário
        async function closeCalendarTab(event, calendarId) {
            event.stopPropagation(); // Evitar que clique na aba

            // Confirmar exclusão
            const calendar = calendars.find(c => c.id === calendarId);
            const confirmDelete = await customConfirm(`Deseja realmente excluir o calendário "${calendar?.name || 'Sem nome'}"?\n\nEsta ação não pode ser desfeita.`);

            if (!confirmDelete) return;

            try {
                // ✅ USAR apiCall em vez de fetch direto
                await apiCall(ENDPOINTS.deleteCalendar, {
                    calendar_id: calendarId,
                    tenant_id: state.userData.tenant_id
                });

                // Remover do array local
                calendars = calendars.filter(c => c.id !== calendarId);

                // Limpar cache de eventos
                delete calendarEvents[calendarId];

                // Se era o ativo, trocar para outro
                if (activeCalendarId === calendarId) {
                    if (calendars.length > 0) {
                        switchToCalendar(calendars[0].id);
                    } else {
                        activeCalendarId = null;
                        showNoCalendarsState();
                    }
                }

                // Re-renderizar abas
                renderCalendarTabs();

                showToast('Calendário excluído com sucesso', 'success');

            } catch (error) {
                console.error('[CloseCalendarTab] Erro:', error);
                showToast('Erro ao excluir calendário', 'error');
            }
        }

        // Modal de criar calendário
        function openCreateCalendarModal() {
            // Verificar se já existe um calendário
            if (calendars.length > 0) {
                showToast('Você já possui um calendário. Apenas um calendário é permitido por conta.', 'error');
                return;
            }

            // Resetar form
            document.getElementById('newCalendarName').value = '';
            document.getElementById('newCalendarEventTitle').value = '';

            // Atualizar placeholder com nome da empresa
            const generatedTitle = generateEventTitle();
            document.getElementById('newCalendarEventTitle').placeholder = `Ex: ${generatedTitle}`;

            document.getElementById('newCalendarDuration').value = '30';
            document.getElementById('newCalendarMaxDays').value = '30';

            // Abrir modal
            document.getElementById('createCalendarModal').classList.add('active');
        }

        function closeCreateCalendarModal() {
            document.getElementById('createCalendarModal').classList.remove('active');
        }

        // Funções do modal de aviso
        function showCreateCalendarWarning() {
            document.getElementById('createCalendarWarningModal').style.display = 'flex';
        }

        function closeCreateCalendarWarning() {
            document.getElementById('createCalendarWarningModal').style.display = 'none';
        }

        function openCreateCalendarFromWarning() {
            // Fechar popup de aviso
            closeCreateCalendarWarning();
            // Abrir modal de criação
            openCreateCalendarModal();
        }

        async function handleCreateCalendar(event) {
            event.preventDefault();

            const name = document.getElementById('newCalendarName').value.trim();
            const eventTitle = document.getElementById('newCalendarEventTitle').value.trim();
            const duration = parseInt(document.getElementById('newCalendarDuration').value);
            const maxDays = parseInt(document.getElementById('newCalendarMaxDays').value);

            if (!name) {
                showToast('Digite um nome para o calendário', 'error');
                return;
            }

            if (!eventTitle) {
                showToast('Digite um título para os eventos', 'error');
                return;
            }

            const btn = event.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-sm"></span> Criando...';

            try {
                // ✅ USAR apiCall em vez de fetch direto
                const data = await apiCall(ENDPOINTS.createCalendar, {
                    tenant_id: state.userData.tenant_id,
                    name: name,
                    event_title: eventTitle,
                    duration_minutes: duration,
                    max_days_ahead: maxDays
                });

                const newCalendar = data.calendar || data.calendario || data;

                // Adicionar à lista
                calendars.push(newCalendar);

                // Renderizar abas
                renderCalendarTabs();

                // Trocar para o novo calendário
                await switchToCalendar(newCalendar.id);

                // Fechar modal
                closeCreateCalendarModal();

                showToast('Calendário criado com sucesso!', 'success');

                // Atualizar visibilidade do botão +Contas
                updateInviteButtonVisibility();

                // Abrir automaticamente o modal de gerenciar contas
                setTimeout(() => {
                    openInviteModal();
                }, 500);

            } catch (error) {
                console.error('[CreateCalendar] Erro:', error);
                showToast('Erro ao criar calendário', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Criar Calendário';
            }
        }

        // Atualizar mensagens de carregamento quando não há calendários
        function updateLoadingMessagesForEmptyState() {
            const calendarMessage = document.getElementById('calendarLoadingMessage');
            const eventsMessage = document.getElementById('eventsLoadingMessage');

            if (calendarMessage) {
                calendarMessage.innerHTML = `
                    <div class="empty-state-message">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                            <line x1="12" y1="14" x2="12" y2="18"></line>
                            <line x1="10" y1="16" x2="14" y2="16"></line>
                        </svg>
                        <h3>Nenhum calendário encontrado</h3>
                        <p>Crie um calendário para começar a agendar</p>
                    </div>
                `;
            }

            if (eventsMessage) {
                eventsMessage.innerHTML = `
                    <div class="empty-state-message">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        <h3>Sem eventos</h3>
                        <p>Crie um calendário primeiro</p>
                    </div>
                `;
            }
        }

        // Restaurar mensagens de carregamento normais
        function restoreNormalLoadingMessages() {
            const calendarMessage = document.getElementById('calendarLoadingMessage');
            const eventsMessage = document.getElementById('eventsLoadingMessage');

            if (calendarMessage) {
                calendarMessage.textContent = 'Carregando calendário...';
            }

            if (eventsMessage) {
                eventsMessage.textContent = 'Carregando eventos...';
            }
        }

        // Controlar visibilidade do botão "Enviar Convite"
        function updateInviteButtonVisibility() {
            const inviteButton = document.getElementById('inviteButton');
            if (inviteButton) {
                if (calendars.length === 0) {
                    inviteButton.style.display = 'none';
                } else {
                    inviteButton.style.display = 'flex';
                }
            }
        }

        // Controlar visibilidade do botão "Adicionar Calendário"
        function updateAddCalendarButtonVisibility() {
            const addCalendarBtn = document.getElementById('addCalendarBtn');
            if (addCalendarBtn) {
                if (calendars.length > 0) {
                    addCalendarBtn.style.display = 'none';
                } else {
                    addCalendarBtn.style.display = 'flex';
                }
            }
        }

        // Gerar título automático do evento baseado no nome da conta
        function generateEventTitle() {
            const userData = getUserData();
            const companyName = userData?.company_name ||
                               userData?.companyName ||
                               userData?.tenant_name ||
                               userData?.accountName ||
                               userData?.userName ||
                               'Salesdever';

            return `Reunião - ${companyName}`;
        }

        // Estado sem calendários
        function showNoCalendarsState() {
            // Atualizar mensagens de carregamento nas áreas específicas
            updateLoadingMessagesForEmptyState();

            // Esconder botões
            updateInviteButtonVisibility();
            updateAddCalendarButtonVisibility();

            // Garantir estatísticas zeradas
            updateStatistics();

            // Ocultar área principal do calendário
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 400px; color: rgba(255,255,255,0.5); text-align: center;">
                        <div>
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="opacity: 0.3; margin-bottom: 1rem;">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <p>Configure seu calendário para começar</p>
                        </div>
                    </div>
                `;
            }

            // Mostrar popup modal centralizado
            setTimeout(() => {
                showCreateCalendarWarning();
            }, 500);
        }

        // ===== FUNÇÕES AUXILIARES =====

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Segunda como início
            return new Date(d.setDate(diff));
        }

        function isToday(date) {
            return date.toDateString() === new Date().toDateString();
        }

        function getEventsForSlot(date, hour) {
            return state.events.filter(e => {
                const eventDate = new Date(e.start_time);
                return eventDate.toDateString() === date.toDateString() && eventDate.getHours() === hour;
            });
        }

        // Nova função para calcular layout de eventos sobrepostos
        function calculateEventLayout(events) {
            if (events.length <= 1) {
                return events.map(event => ({
                    ...event,
                    layoutWidth: 100,
                    layoutLeft: 0,
                    isOverlapped: false
                }));
            }

            // Dividir largura igualmente entre eventos sobrepostos
            const width = 100 / events.length;

            return events.map((event, index) => ({
                ...event,
                layoutWidth: width,
                layoutLeft: width * index,
                isOverlapped: true
            }));
        }

        function getEventsForDay(date) {
            return state.events.filter(e => {
                const eventDate = new Date(e.start_time);
                return eventDate.toDateString() === date.toDateString();
            });
        }

        function getTimeUntil(date) {
            const now = new Date();
            const diff = date - now;
            const hours = Math.floor(diff / 3600000);
            const mins = Math.floor((diff % 3600000) / 60000);

            if (hours > 24) return `${Math.floor(hours / 24)} dias`;
            if (hours > 0) return `${hours}h`;
            if (mins > 0) return `${mins}m`;
            return 'Agora';
        }

        // ===== NAVEGAÇÃO =====

        function navigateCalendar(direction) {
            switch (state.currentView) {
                case 'day':
                    state.currentDate.setDate(state.currentDate.getDate() + direction);
                    break;
                case 'week':
                    state.currentDate.setDate(state.currentDate.getDate() + (direction * 7));
                    break;
                case 'month':
                    state.currentDate.setMonth(state.currentDate.getMonth() + direction);
                    break;
            }
            renderMainCalendar();
            renderMiniCalendar();
            updatePeriodDisplay();
        }

        function navigateMiniMonth(direction) {
            state.miniCalendarDate.setMonth(state.miniCalendarDate.getMonth() + direction);
            renderMiniCalendar();
        }

        function selectDate(isoString) {
            state.currentDate = new Date(isoString);
            renderMiniCalendar();
            renderMainCalendar();
            updatePeriodDisplay();
        }

        function switchView(view) {
            state.currentView = view;
            document.querySelectorAll('.view-tab').forEach(t => t.classList.toggle('active', t.dataset.view === view));
            renderMainCalendar();
            updatePeriodDisplay();
        }

        function updatePeriodDisplay() {
            const el = document.getElementById('periodDisplay');
            switch (state.currentView) {
                case 'day':
                    el.textContent = state.currentDate.toLocaleDateString('pt-BR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                    break;
                case 'week':
                    const ws = getWeekStart(state.currentDate);
                    const we = new Date(ws);
                    we.setDate(we.getDate() + 6);
                    el.textContent = `${ws.getDate()} - ${we.getDate()} de ${we.toLocaleDateString('pt-BR', { month: 'short' })}. ${we.getFullYear()}`;
                    break;
                case 'month':
                    el.textContent = state.currentDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                    break;
            }
        }

        // ===== ESTATÍSTICAS =====

        function updateStatistics() {
            console.log('🔄 Atualizando estatísticas...');

            // Verificar se há calendário válido
            if (!calendars || calendars.length === 0 || !state.calendar) {
                console.log('📊 Sem calendário válido - zerando estatísticas');
                const weeklyEl = document.getElementById('statWeeklySessions');
                const monthlyEl = document.getElementById('statMonthlySessions');
                const totalEl = document.getElementById('statTotalSessions');

                if (weeklyEl) weeklyEl.textContent = '0';
                if (monthlyEl) monthlyEl.textContent = '0';
                if (totalEl) totalEl.textContent = '0';
                return;
            }

            // Verificar se há conexões Google válidas
            const validConnections = state.connections ? state.connections.filter(conn =>
                conn &&
                conn.id &&
                (conn.google_name || conn.google_email) &&
                conn.google_name !== 'null' &&
                conn.google_email !== 'null'
            ) : [];

            if (validConnections.length === 0) {
                console.log('📊 Sem conexões válidas - zerando estatísticas');
                const weeklyEl = document.getElementById('statWeeklySessions');
                const monthlyEl = document.getElementById('statMonthlySessions');
                const totalEl = document.getElementById('statTotalSessions');

                if (weeklyEl) weeklyEl.textContent = '0';
                if (monthlyEl) monthlyEl.textContent = '0';
                if (totalEl) totalEl.textContent = '0';
                return;
            }

            console.log('📊 Total de eventos:', state.events.length);

            const now = new Date();
            const weekStart = getWeekStart(now);
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

            const weeklyEvents = state.events.filter(e => {
                const eventDate = new Date(e.start_time);
                return eventDate >= weekStart && eventDate <= now.setDate(now.getDate() + 7);
            });

            const monthlyEvents = state.events.filter(e => {
                const eventDate = new Date(e.start_time);
                return eventDate >= monthStart;
            });

            // Total de agendamentos (todos os eventos)
            const totalEvents = state.events.length;

            // Atualizar elementos com verificação
            const weeklyEl = document.getElementById('statWeeklySessions');
            const monthlyEl = document.getElementById('statMonthlySessions');
            const totalEl = document.getElementById('statTotalSessions');

            if (weeklyEl) weeklyEl.textContent = weeklyEvents.length;
            if (monthlyEl) monthlyEl.textContent = monthlyEvents.length;
            if (totalEl) totalEl.textContent = totalEvents;

            console.log('✅ Estatísticas atualizadas:', {
                semanal: weeklyEvents.length,
                mensal: monthlyEvents.length,
                total: totalEvents
            });
        }

        // ===== MODAIS =====

        function openInviteModal() {
            renderPendingInvites();
            renderConnectedAccounts();
            updateInviteCounts();
            document.getElementById('inviteModal').classList.add('active');
        }

        function closeInviteModal() {
            document.getElementById('inviteModal').classList.remove('active');
        }

        function openSettingsModal() {
            if (state.calendar) {
                document.getElementById('calendarName').value = state.calendar.name || '';
                document.getElementById('defaultDuration').value = state.calendar.duration_minutes || 30;
                document.getElementById('maxDays').value = state.calendar.max_days_ahead || 30;
            }

            // Carregar instâncias quando abrir
            loadWhatsAppInstances();

            // Adicionar event listener para toggle de notificações
            const notifyToggle = document.getElementById('notifyEnabled');
            if (notifyToggle) {
                notifyToggle.addEventListener('change', toggleNotificationFields);
            }

            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function switchSettingsTab(tabName) {
            // Remove active de todas as abas
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.color = 'var(--text-secondary)';
                tab.style.borderBottomColor = 'transparent';
            });

            // Remove active de todos os conteúdos
            document.querySelectorAll('.settings-tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            // Ativa aba clicada
            const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.style.color = 'var(--text-primary)';
                activeTab.style.borderBottomColor = 'var(--primary)';
            }

            // Ativa conteúdo correspondente
            const activeContent = document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (activeContent) {
                activeContent.classList.add('active');
                activeContent.style.display = 'block';
            }

            // Se for aba de lembretes ou notificações, carregar instâncias
            if (tabName === 'lembretes' || tabName === 'notificacoes') {
                loadWhatsAppInstances();
            }
        }

        function openCreateEventModal(date, hour) {
            // Verificar se há calendário e conexões válidas
            if (!calendars || calendars.length === 0 || !state.calendar) {
                showToast('Para criar eventos você precisa: 1) Criar um calendário e 2) Fazer uma conexão/integração com sua conta Google', 'error');
                return;
            }

            // Verificar se há conexões válidas
            const validConnections = state.connections ? state.connections.filter(conn =>
                conn &&
                conn.id &&
                (conn.google_name || conn.google_email) &&
                conn.google_name !== 'null' &&
                conn.google_email !== 'null'
            ) : [];

            if (validConnections.length === 0) {
                showToast('Para criar eventos você precisa fazer uma conexão/integração com sua conta Google. Use o botão "+Contas"', 'error');
                return;
            }

            const dateInput = document.getElementById('eventDateTime');
            const formattedDate = date.toISOString().slice(0, 10);
            const formattedTime = hour.toString().padStart(2, '0') + ':00';
            dateInput.value = `${formattedDate}T${formattedTime}`;

            populateConnectionSelect();
            document.getElementById('createEventModal').classList.add('active');
        }

        function closeCreateEventModal() {
            document.getElementById('createEventModal').classList.remove('active');
            document.getElementById('createEventForm').reset();
        }

        function closeEventDetailModal() {
            document.getElementById('eventDetailModal').classList.remove('active');
        }

        function switchModalTab(tab) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('active', c.id === `tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`));
        }

        function renderPendingInvites() {
            const container = document.getElementById('pendingList');

            // Filtrar apenas convites válidos (com name e email)
            const validInvites = state.invites ? state.invites.filter(invite =>
                invite && invite.name && invite.email &&
                invite.name.trim() !== '' && invite.email.trim() !== ''
            ) : [];

            if (validInvites.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                        <p>Nenhum convite pendente</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = validInvites.map(invite => {
                // Verificar se invite tem dados válidos
                const name = invite.name || 'Sem nome';
                const email = invite.email || 'Sem email';

                return `
                    <div class="list-item">
                        <div class="list-item-avatar">
                            <span class="avatar-fallback">${getInitials(name)}</span>
                        </div>
                        <div class="list-item-info">
                            <div class="list-item-name">${name}</div>
                            <div class="list-item-email">${email}</div>
                        </div>
                        <div class="list-item-actions">
                            <button class="btn-action success" onclick="resendInvite('${invite.id}')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23,4 23,10 17,10"/>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                </svg>
                                Reenviar
                            </button>
                            <button class="btn-action danger" onclick="deleteInvite('${invite.id}')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3,6 5,6 21,6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                Excluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderConnectedAccounts() {
            const container = document.getElementById('connectedList');

            // Filtrar conexões válidas (com ID e dados válidos) - TODAS, ativas e inativas
            const validConnections = state.connections ? state.connections.filter(conn =>
                conn &&
                conn.id &&
                (conn.google_name || conn.google_email) &&
                conn.google_name !== 'null' &&
                conn.google_email !== 'null'
            ) : [];

            console.log('[RenderConnectedAccounts] Todas as conexões:', validConnections);

            if (!validConnections || validConnections.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <p>Nenhuma conta encontrada</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = validConnections.map(conn => {
                const name = conn.google_name || 'Usuário';
                const email = conn.google_email || '';
                const picture = conn.google_picture || '';
                const isActive = conn.is_active === true || conn.is_active === 'true';

                console.log(`[RenderConnectedAccounts] ${name} - is_active:`, conn.is_active, 'isActive:', isActive);

                return `
                    <div class="list-item ${isActive ? 'connected' : 'disconnected'}">
                        <div class="list-item-avatar">
                            ${picture ?
                                `<img src="${picture}" alt="${name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                 <span class="avatar-fallback" style="display: none;">${getInitials(name)}</span>` :
                                `<span class="avatar-fallback">${getInitials(name)}</span>`
                            }
                            <span class="status-indicator ${isActive ? 'active' : 'inactive'}"></span>
                        </div>
                        <div class="list-item-info">
                            <div class="list-item-name">
                                ${name}
                                <span class="status-text ${isActive ? 'connected' : 'disconnected'}">
                                    ${isActive ? 'Conectado' : 'Desconectado'}
                                </span>
                            </div>
                            <div class="list-item-email">${email}</div>
                        </div>
                        <div class="list-item-actions">
                            ${isActive ?
                                `<button class="btn-action danger" onclick="disconnectAccount('${conn.id}')">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                        <polyline points="16,17 21,12 16,7"/>
                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                    </svg>
                                    Desconectar
                                </button>` :
                                `<button class="btn-action primary" onclick="reconnectAccount('${conn.id}')">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                                        <polyline points="10,17 15,12 10,7"/>
                                        <line x1="15" y1="12" x2="3" y2="12"/>
                                    </svg>
                                    Conectar
                                </button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateInviteCounts() {
            // Filtrar apenas convites válidos (com name e email)
            const validInvites = state.invites ? state.invites.filter(invite =>
                invite && invite.name && invite.email &&
                invite.name.trim() !== '' && invite.email.trim() !== ''
            ) : [];

            // Filtrar conexões válidas (mesma validação do render)
            const validConnections = state.connections ? state.connections.filter(conn =>
                conn &&
                conn.id &&
                (conn.google_name || conn.google_email) &&
                conn.google_name !== 'null' &&
                conn.google_email !== 'null'
            ) : [];

            // Contar apenas conexões ATIVAS como conectadas
            const activeConnections = validConnections.filter(conn =>
                conn.is_active === true || conn.is_active === 'true'
            );

            const pendingCount = validInvites.length;
            const connectedCount = activeConnections.length; // Apenas contas ativas
            const totalAccounts = validConnections.length; // Total de contas (ativas + inativas)

            console.log('[UpdateInviteCounts] Contas ativas:', connectedCount, 'Total de contas:', totalAccounts);

            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('connectedCount').textContent = connectedCount;
        }

        function populateConnectionSelect() {
            const select = document.getElementById('eventConnection');
            select.innerHTML = '';

            if (state.connections.length === 0) {
                const option = document.createElement('option');
                option.textContent = 'Nenhuma conta disponível';
                option.disabled = true;
                select.appendChild(option);
                return;
            }

            state.connections.filter(c => c.is_active !== false).forEach(conn => {
                const option = document.createElement('option');
                option.value = conn.id;
                option.textContent = `${conn.google_name} (${conn.google_email})`;
                select.appendChild(option);
            });
        }

        // ===== HANDLERS =====

        async function handleSendInvite(e) {
            e.preventDefault();
            const name = document.getElementById('inviteName').value;
            const email = document.getElementById('inviteEmail').value;

            try {
                await apiCall(ENDPOINTS.sendInvite, {
                    tenant_id: state.userData.tenant_id,
                    name,
                    email,
                    connect_url: `https://app1.salesdever.io/calendar-connect?tenant=${state.userData.tenant_id}`
                });

                showToast('Convite enviado com sucesso!', 'success');
                document.getElementById('inviteForm').reset();

                await loadAllData();
                renderPendingInvites();
                updateInviteCounts();
            } catch (err) {
                showToast('Erro ao enviar convite: ' + err.message, 'error');
            }
        }

        async function handleCreateEvent(e) {
            e.preventDefault();

            console.log('[CREATE_EVENT] Iniciando criação de evento...');

            const connectionId = document.getElementById('eventConnection').value;
            if (!connectionId) {
                showToast('Selecione uma agenda responsável', 'error');
                return;
            }

            // Validar data
            const eventDateTimeValue = document.getElementById('eventDateTime').value;
            if (!eventDateTimeValue) {
                showToast('Selecione uma data e hora para o evento', 'error');
                return;
            }

            const payload = {
                tenant_id: state.userData.tenant_id,
                connection_id: connectionId,
                start_time: new Date(eventDateTimeValue).toISOString(),
                duration: parseInt(document.getElementById('eventDuration').value) || 60,
                event_title: document.getElementById('eventTitle').value || 'Reunião',
                lead_name: document.getElementById('eventClientName').value || '',
                lead_email: document.getElementById('eventClientEmail').value || '',
                lead_phone: document.getElementById('eventClientPhone').value || '',
                source: 'manual',
                create_meet: document.getElementById('createMeetLink').checked || false
            };

            console.log('[CREATE_EVENT] Payload:', payload);

            try {
                showToast('Criando evento...', 'info');

                const result = await apiCall(ENDPOINTS.createEvent, payload);

                console.log('[CREATE_EVENT] Resultado:', result);

                showToast('Evento criado com sucesso!', 'success');
                closeCreateEventModal();

                // Recarregar todos os dados e atualizar interface
                try {
                    await loadAllData();
                    renderMainCalendar();
                    renderSessionsList();
                    renderMiniCalendar();

                    // Forçar atualização das estatísticas
                    updateStatistics();

                    // Atualizar display de período para garantir que tudo está sincronizado
                    updatePeriodDisplay();
                } catch (reloadError) {
                    console.warn('[CREATE_EVENT] Erro ao recarregar dados:', reloadError);
                    showToast('Evento criado, mas houve erro ao atualizar a interface', 'warning');
                }

            } catch (err) {
                console.error('[CREATE_EVENT] Erro:', err);
                showToast('Erro ao criar evento: ' + err.message, 'error');
            }
        }

        async function handleSaveSettings(e) {
            e.preventDefault();
            // Implementar salvar configurações
            showToast('Configurações salvas!', 'success');
            closeSettingsModal();
        }

        async function resendInvite(inviteId) {
            try {
                await apiCall(ENDPOINTS.resendInvite, { invite_id: inviteId });
                showToast('Convite reenviado!', 'success');
            } catch (err) {
                showToast('Erro ao reenviar convite', 'error');
            }
        }

        async function deleteInvite(inviteId) {
            if (!(await customConfirm('Tem certeza que deseja excluir este convite?'))) return;

            try {
                await apiCall(ENDPOINTS.deleteInvite, { invite_id: inviteId });
                showToast('Convite excluído!', 'success');

                await loadAllData();
                renderPendingInvites();
                updateInviteCounts();
            } catch (err) {
                showToast('Erro ao excluir convite', 'error');
            }
        }

        async function disconnectAccount(connectionId) {
            if (!(await customConfirm('Tem certeza que deseja desconectar esta conta?'))) return;

            try {
                await apiCall(ENDPOINTS.disconnectCalendar, { connection_id: connectionId });
                showToast('Conta desconectada!', 'success');

                await loadAllData();
                renderConnectedAccounts();
                updateInviteCounts();
            } catch (err) {
                showToast('Erro ao desconectar conta', 'error');
            }
        }

        // Função para reconectar conta desativada
        async function reconnectAccount(connectionId) {
            try {
                console.log('[ReconnectAccount] Reconectando conta ID:', connectionId);

                // Buscar dados da conexão
                const connection = state.connections.find(c => c.id === connectionId);
                if (!connection) {
                    showToast('Conta não encontrada', 'error');
                    return;
                }

                showToast('Reconectando conta...', 'info');

                // Chamar webhook de reconexão com TODAS as informações da conta
                const response = await fetch('https://sdr.salesdever.io/webhook/conectar-novamente-google', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        connection_id: connectionId,
                        tenant_id: state.userData.tenant_id,
                        // Dados da conta completos
                        google_name: connection.google_name,
                        google_email: connection.google_email,
                        google_picture: connection.google_picture,
                        google_id: connection.google_id,
                        is_active: connection.is_active,
                        created_at: connection.created_at,
                        updated_at: connection.updated_at,
                        // Dados adicionais se existirem
                        access_token: connection.access_token,
                        refresh_token: connection.refresh_token,
                        token_expires_at: connection.token_expires_at,
                        scopes: connection.scopes,
                        calendar_list: connection.calendar_list
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: Falha na reconexão`);
                }

                const result = await response.json();
                console.log('[ReconnectAccount] Resposta do webhook:', result);

                showToast('Conta reconectada com sucesso!', 'success');

                // Recarregar dados
                await loadAllData();
                renderConnectedAccounts();
                updateInviteCounts();

            } catch (err) {
                console.error('[ReconnectAccount] Erro:', err);
                showToast('Erro ao reconectar conta: ' + err.message, 'error');
            }
        }

        // Função para navegar para página de conversas com busca automática
        function viewCallSummary(phone) {
            if (!phone) {
                showToast('Número de telefone não disponível', 'error');
                return;
            }

            console.log('📞 Navegando para página de conversas para telefone:', phone);

            // Navegar para página de conversas na mesma aba com parâmetro de busca
            const conversasUrl = `../conversas/conversas.html?phone=${encodeURIComponent(phone)}`;
            window.location.href = conversasUrl;
        }

        function showEventDetail(eventId) {
            const event = state.events.find(e => e.id === eventId);
            if (!event) return;

            const startTime = new Date(event.start_time);
            const endTime = new Date(event.end_time);
            const connection = state.connections.find(c => c.id === event.connection_id);

            const content = document.getElementById('eventDetailContent');
            content.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h4 style="color: var(--primary); margin-bottom: 1rem; font-size: 1.2rem;">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px; width: 16px; height: 16px;">
                            <rect x="3" y="4" width="18" height="15" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        ${event.event_title || event.lead_name || 'Reunião'}
                    </h4>

                    <div style="display: grid; gap: 0.5rem;">
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid rgba(165, 148, 255, 0.1);">
                            <strong style="color: var(--text-secondary); font-size: 0.9rem; min-width: 90px;">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px; width: 14px; height: 14px;">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12,6 12,12 16,14"/>
                                </svg>
                                Horário:
                            </strong>
                            <span style="color: var(--text-primary); font-size: 0.9rem; flex: 1; text-align: right;">${startTime.toLocaleString('pt-BR')} - ${endTime.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</span>
                        </div>

                        ${event.lead_name ? `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid rgba(165, 148, 255, 0.1);">
                                <strong style="color: var(--text-secondary); font-size: 0.9rem; min-width: 90px;">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px; width: 14px; height: 14px;">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                    Cliente:
                                </strong>
                                <span style="color: var(--text-primary); font-size: 0.9rem; flex: 1; text-align: right;">${event.lead_name}</span>
                            </div>
                        ` : ''}

                        ${event.lead_email ? `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid rgba(165, 148, 255, 0.1);">
                                <strong style="color: var(--text-secondary); font-size: 0.9rem; min-width: 90px;">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px; width: 14px; height: 14px;">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                    Email:
                                </strong>
                                <span style="color: var(--text-primary); font-size: 0.9rem; flex: 1; text-align: right;">${event.lead_email}</span>
                            </div>
                        ` : ''}

                        ${event.lead_phone ? `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid rgba(165, 148, 255, 0.1);">
                                <strong style="color: var(--text-secondary); font-size: 0.9rem; min-width: 90px;">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px; width: 14px; height: 14px;">
                                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                                    </svg>
                                    Telefone:
                                </strong>
                                <span style="color: var(--text-primary); font-size: 0.9rem; flex: 1; text-align: right;">${event.lead_phone}</span>
                            </div>
                        ` : ''}

                        ${connection ? `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid rgba(165, 148, 255, 0.1);">
                                <strong style="color: var(--text-secondary); font-size: 0.9rem; min-width: 90px;">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px; width: 14px; height: 14px;">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                        <circle cx="9" cy="7" r="4"/>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                    </svg>
                                    Responsável:
                                </strong>
                                <span style="color: var(--text-primary); font-size: 0.9rem; flex: 1; text-align: right;">${connection.google_name}</span>
                            </div>
                        ` : ''}

                        ${event.lead_phone ? `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid rgba(165, 148, 255, 0.1);">
                                <strong style="color: var(--text-secondary); font-size: 0.9rem; min-width: 90px;">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px; width: 14px; height: 14px;">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    Ligação do lead:
                                </strong>
                                <button onclick="viewCallSummary('${event.lead_phone}')"
                                        style="display: inline-flex; align-items: center; padding: 0.3rem 0.6rem;
                                               background: linear-gradient(135deg, #A594FF, #667eea); color: white; text-decoration: none;
                                               border: none; border-radius: 4px; font-weight: 600;
                                               transition: all 0.2s; cursor: pointer; font-size: 0.85rem; gap: 4px;"
                                        onmouseover="this.style.background='linear-gradient(135deg, #8B7AFF, #5568D3)'"
                                        onmouseout="this.style.background='linear-gradient(135deg, #A594FF, #667eea)'">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    Ver Resumo
                                </button>
                            </div>
                        ` : ''}

                        ${event.google_meet_link ? `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0;">
                                <strong style="color: var(--text-secondary); font-size: 0.9rem; min-width: 90px;">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px; width: 14px; height: 14px;">
                                        <polygon points="23 7 16 12 23 17 23 7"/>
                                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                                    </svg>
                                    Meet:
                                </strong>
                                <a href="${event.google_meet_link}" target="_blank"
                                   style="display: inline-flex; align-items: center; padding: 0.3rem 0.6rem;
                                          background: white; color: #333; text-decoration: none;
                                          border: 1px solid #dadce0; border-radius: 4px; font-weight: 500;
                                          transition: all 0.2s; cursor: pointer; font-size: 0.85rem;"
                                   onmouseover="this.style.background='#f8f9fa'; this.style.borderColor='#c6c9cc'"
                                   onmouseout="this.style.background='white'; this.style.borderColor='#dadce0'">
                                    <img src="http://imagens-zipline.hgabnb.easypanel.host/u/rWkbgV.png" style="width: 16px; height: 16px; margin-right: 4px;" alt="Google Meet">
                                    Entrar
                                </a>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.getElementById('eventDetailModal').classList.add('active');
        }

        // ===== TOAST =====

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ===== EVENT LISTENERS =====

        function setupEventListeners() {
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.addEventListener('click', () => switchView(tab.dataset.view));
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
        }

        function setupCalendarClickEvents() {
            document.querySelectorAll('.day-slot').forEach(slot => {
                slot.addEventListener('click', (e) => {
                    if (e.target.closest('.event-block')) return;
                    const date = new Date(slot.dataset.date);
                    const hour = parseInt(slot.dataset.hour);
                    openCreateEventModal(date, hour);
                });
            });

            document.querySelectorAll('.month-day').forEach(cell => {
                cell.addEventListener('click', (e) => {
                    if (e.target.closest('.month-event')) return;
                    const date = new Date(cell.dataset.date);
                    openCreateEventModal(date, 9);
                });
            });
        }

        // ===== ONBOARDING FUNCTIONS =====

        let currentOnboardingStep = 1;

        function showOnboarding() {
            console.log('[ONBOARDING] Onboarding desabilitado - indo direto ao calendário');
            // Onboarding removido - função mantida para compatibilidade
        }

        function hideOnboarding() {
            document.getElementById('onboardingScreen').style.display = 'none';
            document.getElementById('mainLayout').style.display = 'grid';
        }

        function nextOnboardingStep() {
            const currentStep = document.querySelector(`.onboarding-step[data-step="${currentOnboardingStep}"]`);
            const currentDot = document.querySelector(`.onboarding-dot[data-step="${currentOnboardingStep}"]`);

            // Validate current step before proceeding
            if (!validateOnboardingStep(currentOnboardingStep)) {
                return;
            }

            // Mark current step as completed
            currentDot.classList.add('completed');
            currentStep.classList.remove('active');

            if (currentOnboardingStep < 4) {
                currentOnboardingStep++;
                showOnboardingStep(currentOnboardingStep);
            } else {
                // Complete onboarding
                completeOnboarding();
            }
        }

        function previousOnboardingStep() {
            if (currentOnboardingStep > 1) {
                const currentStep = document.querySelector(`.onboarding-step[data-step="${currentOnboardingStep}"]`);
                const currentDot = document.querySelector(`.onboarding-dot[data-step="${currentOnboardingStep}"]`);

                currentStep.classList.remove('active');
                currentDot.classList.remove('active');

                currentOnboardingStep--;
                showOnboardingStep(currentOnboardingStep);
            }
        }

        function showOnboardingStep(step) {
            // Update step display
            document.querySelectorAll('.onboarding-step').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.onboarding-dot').forEach(d => d.classList.remove('active'));

            const stepEl = document.querySelector(`.onboarding-step[data-step="${step}"]`);
            const dotEl = document.querySelector(`.onboarding-dot[data-step="${step}"]`);

            stepEl.classList.add('active');
            dotEl.classList.add('active');

            // Update navigation buttons
            const prevBtn = document.getElementById('onboardingPrev');
            const nextBtn = document.getElementById('onboardingNext');

            prevBtn.style.display = step > 1 ? 'flex' : 'none';

            if (step === 4) {
                nextBtn.innerHTML = `
                    Finalizar
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>
                `;
            } else {
                nextBtn.innerHTML = `
                    Próximo
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9,18 15,12 9,6"/>
                    </svg>
                `;
            }

            // Update summary in step 4
            if (step === 4) {
                updateOnboardingSummary();
            }
        }

        function validateOnboardingStep(step) {
            switch (step) {
                case 1:
                    if (state.connections.length === 0) {
                        showToast('Conecte uma conta do Google Calendar primeiro', 'warning');
                        return false;
                    }
                    return true;
                case 2:
                    const calendarName = document.getElementById('onboardingCalendarName').value;
                    if (!calendarName.trim()) {
                        showToast('Digite um nome para o calendário', 'warning');
                        return false;
                    }
                    return true;
                case 3:
                    return true; // Availability is optional
                case 4:
                    return true;
                default:
                    return false;
            }
        }

        async function completeOnboarding() {
            try {
                // Create calendar with the configured settings
                const calendarData = getOnboardingCalendarData();
                await apiCall(ENDPOINTS.createCalendar, calendarData);

                showToast('Configuração concluída com sucesso!', 'success');

                // Hide onboarding and load the app
                hideOnboarding();

                // Reload all data and show the main interface
                await loadAllData();
                renderMiniCalendar();
                renderMainCalendar();
                renderSessionsList();
                updateStatistics();
                updatePeriodDisplay();
                setupEventListeners();

            } catch (error) {
                console.error('Erro ao finalizar onboarding:', error);
                showToast('Erro ao criar calendário: ' + error.message, 'error');
            }
        }

        function getOnboardingCalendarData() {
            const calendarName = document.getElementById('onboardingCalendarName').value;
            const duration = parseInt(document.getElementById('onboardingDuration').value);
            const maxDays = parseInt(document.getElementById('onboardingMaxDays').value);

            // Get availability from the form
            const availableHours = {};
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

            days.forEach(day => {
                const dayEl = document.querySelector(`.availability-day[data-day="${day}"]`);
                const checkbox = dayEl.querySelector('input[type="checkbox"]');

                if (checkbox.checked) {
                    const startTime = dayEl.querySelector('.time-start').value;
                    const endTime = dayEl.querySelector('.time-end').value;
                    availableHours[day] = { start: startTime, end: endTime };
                } else {
                    availableHours[day] = { start: null, end: null };
                }
            });

            return {
                tenant_id: state.userData.tenant_id,
                name: calendarName,
                description: "Calendário criado através do assistente de configuração",
                duration_minutes: duration,
                max_days_ahead: maxDays,
                available_hours: availableHours,
                rotation_type: "round_robin",
                is_active: true
            };
        }

        function updateOnboardingSummary() {
            const connection = state.connections[0];
            if (connection) {
                document.getElementById('summaryAccountName').textContent = connection.google_name;
            }

            const calendarName = document.getElementById('onboardingCalendarName').value;
            document.getElementById('summaryCalendarName').textContent = calendarName || 'Calendário Principal';

            // Count active days
            const activeDays = document.querySelectorAll('.availability-day input[type="checkbox"]:checked').length;
            document.getElementById('summaryAvailability').textContent = `${activeDays} dias configurados`;
        }

        function showConnectedAccount(connection) {
            const connectedAccounts = document.getElementById('onboardingConnectedAccounts');
            const avatar = document.getElementById('connectedAccountAvatar');
            const fallback = document.getElementById('connectedAccountFallback');
            const name = document.getElementById('connectedAccountName');
            const email = document.getElementById('connectedAccountEmail');

            // Show connected accounts section
            connectedAccounts.style.display = 'block';

            // Set account info
            name.textContent = connection.google_name;
            email.textContent = connection.google_email;

            // Handle avatar
            if (connection.google_picture) {
                avatar.src = connection.google_picture;
                avatar.style.display = 'block';
                fallback.style.display = 'none';
            } else {
                avatar.style.display = 'none';
                fallback.style.display = 'flex';
                fallback.textContent = getInitials(connection.google_name);
            }
        }

        async function connectGoogleCalendar() {
            try {
                // Redirect to Google OAuth
                const connectUrl = `https://app1.salesdever.io/calendar-connect?tenant=${state.userData.tenant_id}`;
                window.open(connectUrl, '_blank');

                showToast('Uma nova aba foi aberta para conectar sua conta Google', 'info');

                // Poll for connection updates
                const pollInterval = setInterval(async () => {
                    try {
                        const connectionsRes = await apiCall(ENDPOINTS.listConnections, { tenant_id: state.userData.tenant_id });
                        const connections = connectionsRes.conexoes || [];

                        if (connections.length > state.connections.length) {
                            state.connections = connections;
                            showConnectedAccount(connections[connections.length - 1]);
                            showToast('Conta conectada com sucesso!', 'success');
                            clearInterval(pollInterval);
                        }
                    } catch (error) {
                        console.log('Polling error:', error);
                    }
                }, 3000);

                // Stop polling after 5 minutes
                setTimeout(() => clearInterval(pollInterval), 300000);

            } catch (error) {
                console.error('Erro ao conectar Google Calendar:', error);
                showToast('Erro ao conectar conta Google', 'error');
            }
        }

        // Handle availability day checkboxes
        document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox' && e.target.closest('.availability-day')) {
                const dayEl = e.target.closest('.availability-day');
                const timeInputs = dayEl.querySelectorAll('input[type="time"]');

                timeInputs.forEach(input => {
                    input.disabled = !e.target.checked;
                });
            }
        });

        // ===== UTILITY FUNCTIONS =====

        function getInitials(name) {
            if (!name) return 'NA';
            return name.split(' ')
                      .map(word => word.charAt(0).toUpperCase())
                      .join('')
                      .substring(0, 2);
        }

        // ===== ATUALIZAÇÃO PERIÓDICA =====

        // Atualizar dados a cada 5 minutos
        setInterval(async () => {
            try {
                await loadAllData();
                renderSessionsList();
                updateStatistics();
                renderMiniCalendar();
            } catch (error) {
                console.log('Erro na atualização automática:', error);
            }
        }, 300000); // 5 minutos

        // ============================================
        // POPUPS CUSTOMIZADOS
        // ============================================

        let customConfirmCallback = null;
        let isModalOpen = false;

        // Função para alert customizado
        function customAlert(message) {
            if (isModalOpen) return; // Prevenir múltiplos modais

            document.getElementById('alertMessage').textContent = message;
            const modal = document.getElementById('customAlertModal');
            modal.style.display = 'flex';
            isModalOpen = true;

            // Disable scroll on body
            document.body.style.overflow = 'hidden';

            // Focus no botão para acessibilidade
            setTimeout(() => {
                const button = document.querySelector('#customAlertModal .btn-primary');
                if (button) button.focus();
            }, 150);
        }

        // Função para confirm customizado
        function customConfirm(message) {
            if (isModalOpen) return Promise.resolve(false); // Prevenir múltiplos modais

            return new Promise((resolve) => {
                document.getElementById('confirmMessage').textContent = message;
                const modal = document.getElementById('customConfirmModal');
                modal.style.display = 'flex';
                isModalOpen = true;

                // Disable scroll on body
                document.body.style.overflow = 'hidden';

                // Guardar o callback
                customConfirmCallback = resolve;

                // Focus no botão cancelar por padrão
                setTimeout(() => {
                    const button = document.querySelector('#customConfirmModal .btn-secondary');
                    if (button) button.focus();
                }, 150);
            });
        }

        // Fechar alert customizado
        function closeCustomAlert() {
            const modal = document.getElementById('customAlertModal');
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scroll
            isModalOpen = false;
        }

        // Fechar confirm customizado
        function closeCustomConfirm(result) {
            const modal = document.getElementById('customConfirmModal');
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scroll
            isModalOpen = false;

            if (customConfirmCallback) {
                customConfirmCallback(result);
                customConfirmCallback = null;
            }
        }

        // Event listeners para os modais
        document.addEventListener('DOMContentLoaded', function() {
            // Clicar fora do modal para fechar (apenas para alert)
            document.getElementById('customAlertModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCustomAlert();
                }
            });

            // Prevent closing confirm modal by clicking outside (force user to choose)
        });

        // Suporte a teclado (ESC para fechar, Enter para confirmar)
        document.addEventListener('keydown', function(e) {
            if (!isModalOpen) return;

            const alertModal = document.getElementById('customAlertModal');
            const confirmModal = document.getElementById('customConfirmModal');

            if (alertModal.style.display === 'flex') {
                if (e.key === 'Escape' || e.key === 'Enter') {
                    e.preventDefault();
                    closeCustomAlert();
                }
            }

            if (confirmModal.style.display === 'flex') {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    closeCustomConfirm(false);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    closeCustomConfirm(true);
                }
            }
        });

        // ============================================
        // SISTEMA DE LEMBRETES E NOTIFICAÇÕES
        // ============================================

        const reminderState = {
            currentConfig: null,
            notificationConfig: null,
            availableGroups: [],
            selectedGroup: null,
            availableInstances: []
        };

        // ===== LEMBRETES =====

        function openReminderModal() {
            console.log('🔧 openReminderModal chamada');
            if (!state.calendar || !state.calendar.id) {
                showToast('Selecione um calendário primeiro', 'error');
                return;
            }
            loadWhatsAppInstances();
            loadReminderSettings();
            document.getElementById('reminderModal').classList.add('active');
        }

        function closeReminderModal() {
            document.getElementById('reminderModal').classList.remove('active');
        }

        async function loadWhatsAppInstances() {
            try {
                console.log('🔧 DEBUG: ===== INICIANDO CARREGAMENTO (BYPASS) =====');
                console.log('🔧 DEBUG: URL:', API_BASE + ENDPOINTS.getWhatsAppInstances);
                console.log('🔧 DEBUG: Payload:', { tenant_id: state.userData.tenant_id });

                // BYPASS do apiCall para evitar bug de array
                const fetchResponse = await fetch(API_BASE + ENDPOINTS.getWhatsAppInstances, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tenant_id: state.userData.tenant_id
                    })
                });

                if (!fetchResponse.ok) {
                    throw new Error(`HTTP error! status: ${fetchResponse.status}`);
                }

                const rawResponse = await fetchResponse.json();

                console.log('🔧 DEBUG: ===== RESPOSTA RECEBIDA (DIRETA) =====');
                console.log('🔧 DEBUG: RESPOSTA COMPLETA:', JSON.stringify(rawResponse, null, 2));
                console.log('🔧 DEBUG: Tipo:', typeof rawResponse);
                console.log('🔧 DEBUG: É array?', Array.isArray(rawResponse));
                console.log('🔧 DEBUG: Length (se array):', rawResponse?.length);

                // Processar resposta COMPLETA (sem bug do apiCall)
                let finalInstances = [];

                if (Array.isArray(rawResponse)) {
                    finalInstances = rawResponse;
                    console.log('🔧 DEBUG: Processado como ARRAY com', finalInstances.length, 'itens');
                } else if (rawResponse && typeof rawResponse === 'object') {
                    finalInstances = [rawResponse];
                    console.log('🔧 DEBUG: Processado como OBJETO único');
                } else {
                    finalInstances = [];
                    console.log('🔧 DEBUG: Resposta VAZIA ou INVÁLIDA');
                }

                reminderState.availableInstances = finalInstances;
                console.log('🔧 DEBUG: ===== INSTÂNCIAS FINAIS =====');
                console.log('🔧 DEBUG: Total salvo no estado:', reminderState.availableInstances.length);

                // Log detalhado de CADA instância
                for (let i = 0; i < reminderState.availableInstances.length; i++) {
                    const inst = reminderState.availableInstances[i];
                    console.log(`🔧 DEBUG: Instância ${i}:`, {
                        id: inst.id,
                        instance_key: inst.instance_key,
                        instance_name: inst.instance_name,
                        phone_number: inst.phone_number,
                        status: inst.status
                    });
                }

                console.log('🔧 DEBUG: Chamando populateInstancesSelect...');
                populateInstancesSelect();

            } catch (error) {
                console.error('❌ ERRO FATAL:', error);
                reminderState.availableInstances = [];
                populateInstancesSelect();
            }
        }

        function populateInstancesSelect() {
            console.log('🔧 POPULATE: ===== INICIANDO POPULAÇÃO =====');
            console.log('🔧 POPULATE: Total no estado:', reminderState.availableInstances?.length || 0);
            console.log('🔧 POPULATE: Dados completos:', JSON.stringify(reminderState.availableInstances, null, 2));

            const reminderSelect = document.getElementById('whatsappInstanceReminder');
            const notificationSelect = document.getElementById('whatsappInstanceNotif');

            console.log('🔧 POPULATE: Elementos encontrados:', {
                lembretes: !!reminderSelect,
                notificacoes: !!notificationSelect
            });

            // Limpar selects
            if (reminderSelect) {
                reminderSelect.innerHTML = '<option value="">Selecione uma instância</option>';
                console.log('🔧 POPULATE: Select lembretes limpo');
            }
            if (notificationSelect) {
                notificationSelect.innerHTML = '<option value="">Selecione uma instância</option>';
                console.log('🔧 POPULATE: Select notificações limpo');
            }

            // Verificar dados
            if (!reminderState.availableInstances || reminderState.availableInstances.length === 0) {
                console.log('❌ POPULATE: SEM DADOS PARA PROCESSAR');
                return;
            }

            console.log('🔧 POPULATE: ===== PROCESSANDO INSTÂNCIAS =====');

            // TESTE DIRETO - Dados hardcoded primeiro
            const testData = [
                {
                    instance_key: "JY2C95KFFR2P-IPF1-ETM4-0XYOJJ3F6KI6",
                    instance_name: "teste_android",
                    phone_number: "+5511952133289",
                    status: "desconectada"
                },
                {
                    instance_key: "OQA1M0CJ9A2O-TO87-F0U3-9KG7NA5I7YLL",
                    instance_name: "grazi2",
                    phone_number: "+5511933968439",
                    status: "conectada"
                }
            ];

            console.log('🔧 POPULATE: Usando dados de teste:', testData);

            // Usar dados reais ou teste
            const dataToUse = reminderState.availableInstances;

            for (let i = 0; i < dataToUse.length; i++) {
                const inst = dataToUse[i];
                console.log(`🔧 POPULATE: ===== Processando ${i + 1}/${dataToUse.length} =====`);
                console.log(`🔧 POPULATE: Instância ${i}:`, inst);

                const id = inst.instance_key;
                const nome = inst.instance_name;
                const tel = inst.phone_number;
                const stat = inst.status;

                console.log(`🔧 POPULATE: Campos extraídos:`, { id, nome, tel, stat });

                if (id && nome) {
                    const texto = `${nome} (${tel}) - ${stat}`;
                    console.log(`🔧 POPULATE: Texto criado: "${texto}"`);

                    // LEMBRETES
                    if (reminderSelect) {
                        const opt1 = document.createElement('option');
                        opt1.value = id;
                        opt1.textContent = texto;
                        reminderSelect.appendChild(opt1);
                        console.log(`✅ POPULATE: ADICIONADO em LEMBRETES: "${texto}"`);
                    } else {
                        console.log(`❌ POPULATE: Select lembretes não existe!`);
                    }

                    // NOTIFICAÇÕES
                    if (notificationSelect) {
                        const opt2 = document.createElement('option');
                        opt2.value = id;
                        opt2.textContent = texto;
                        notificationSelect.appendChild(opt2);
                        console.log(`✅ POPULATE: ADICIONADO em NOTIFICAÇÕES: "${texto}"`);
                    } else {
                        console.log(`❌ POPULATE: Select notificações não existe!`);
                    }
                } else {
                    console.log(`❌ POPULATE: Instância ${i} REJEITADA - faltam dados:`, { id, nome });
                }
            }

            // Verificar resultado final
            if (reminderSelect) {
                console.log(`🔧 POPULATE: Total final em LEMBRETES: ${reminderSelect.options.length - 1} instâncias`);
            }
            if (notificationSelect) {
                console.log(`🔧 POPULATE: Total final em NOTIFICAÇÕES: ${notificationSelect.options.length - 1} instâncias`);
            }

            console.log('🔧 POPULATE: ===== POPULAÇÃO FINALIZADA =====');
        }

        async function loadReminderSettings() {
            try {
                const response = await apiCall(ENDPOINTS.getReminderSettings, {
                    calendar_id: state.calendar.id
                });

                const config = response.config || {};
                reminderState.currentConfig = config;

                document.getElementById('whatsappInstance').value = config.whatsapp_instance || '';
                document.getElementById('sendConfirmation').checked = config.send_confirmation !== false;
                document.getElementById('confirmationMsg').value = config.confirmation_message || '{{nome}}, sua reunião foi agendada com sucesso para {{data_hora}}!';

                // Preset
                const preset = getPreset(config);
                document.getElementById('reminderPreset').value = preset;
                updatePresetMessages(preset, config);

            } catch (error) {
                console.error('Erro:', error);
            }
        }

        function getPreset(config) {
            if (!config.reminder_24h_enabled && !config.reminder_4h_enabled && !config.reminder_1h_enabled && !config.reminder_10m_enabled) {
                return 'nenhum';
            }
            if (config.reminder_24h_enabled && config.reminder_1h_enabled && !config.reminder_4h_enabled && !config.reminder_10m_enabled) {
                return 'basico';
            }
            if (config.reminder_24h_enabled && config.reminder_4h_enabled && config.reminder_1h_enabled && config.reminder_10m_enabled) {
                return 'completo';
            }
            return 'basico'; // default
        }

        function updatePresetMessages(preset, config) {
            const messages = {
                'basico': {
                    msg24h: config.reminder_24h_message || 'Oi {{nome}}, amanhã você tem reunião marcada conosco às {{horario}}!',
                    msg1h: config.reminder_1h_message || 'Oi {{nome}}! Falta 1 hora para nossa reunião. Nos vemos em breve!'
                },
                'completo': {
                    msg24h: config.reminder_24h_message || 'Oi {{nome}}, amanhã você tem reunião marcada conosco às {{horario}}!',
                    msg4h: config.reminder_4h_message || 'Oi {{nome}}, em 4 horas temos nossa reunião!',
                    msg1h: config.reminder_1h_message || 'Oi {{nome}}! Falta 1 hora para nossa reunião!',
                    msg10m: config.reminder_10m_message || 'Em 10 minutos entramos online! Até já {{nome}}!'
                }
            };

            const selected = messages[preset] || messages['basico'];

            if (selected.msg24h) document.getElementById('msg24h').value = selected.msg24h;
            if (selected.msg4h) document.getElementById('msg4h').value = selected.msg4h;
            if (selected.msg1h) document.getElementById('msg1h').value = selected.msg1h;
            if (selected.msg10m) document.getElementById('msg10m').value = selected.msg10m;

            toggleMessageFields(preset);
        }

        function toggleMessageFields(preset) {
            document.getElementById('msg24hGroup').style.display = preset === 'basico' || preset === 'completo' ? 'block' : 'none';
            document.getElementById('msg4hGroup').style.display = preset === 'completo' ? 'block' : 'none';
            document.getElementById('msg1hGroup').style.display = preset === 'basico' || preset === 'completo' ? 'block' : 'none';
            document.getElementById('msg10mGroup').style.display = preset === 'completo' ? 'block' : 'none';
        }

        async function saveReminderSettings(e) {
            e.preventDefault();

            const whatsappInstance = document.getElementById('whatsappInstance').value.trim();
            const preset = document.getElementById('reminderPreset').value;

            if (!whatsappInstance) {
                showToast('Informe a instância do WhatsApp', 'error');
                return;
            }

            const payload = {
                calendar_id: state.calendar.id,
                tenant_id: state.userData.tenant_id,

                send_confirmation: document.getElementById('sendConfirmation').checked,
                confirmation_message: document.getElementById('confirmationMsg').value,

                reminder_24h_enabled: preset === 'basico' || preset === 'completo',
                reminder_24h_message: document.getElementById('msg24h').value,

                reminder_4h_enabled: preset === 'completo',
                reminder_4h_message: document.getElementById('msg4h').value,

                reminder_1h_enabled: preset === 'basico' || preset === 'completo',
                reminder_1h_message: document.getElementById('msg1h').value,

                reminder_10m_enabled: preset === 'completo',
                reminder_10m_message: document.getElementById('msg10m').value,

                whatsapp_instance: whatsappInstance
            };

            try {
                await apiCall(ENDPOINTS.saveReminderSettings, payload);
                showToast('Lembretes configurados!', 'success');
                closeReminderModal();
            } catch (error) {
                console.error('Erro:', error);
                showToast('Erro ao salvar', 'error');
            }
        }

        // ===== NOTIFICAÇÕES =====

        function openNotificationModal() {
            console.log('🔧 openNotificationModal chamada');
            if (!state.calendar || !state.calendar.id) {
                showToast('Selecione um calendário primeiro', 'error');
                return;
            }
            loadWhatsAppInstances();
            loadNotificationSettings();
            document.getElementById('notificationModal').classList.add('active');
        }

        function closeNotificationModal() {
            document.getElementById('notificationModal').classList.remove('active');
        }

        async function loadNotificationSettings() {
            try {
                const response = await apiCall(ENDPOINTS.getNotificationSettings, {
                    calendar_id: state.calendar.id
                });

                const config = response.config || {};
                reminderState.notificationConfig = config;

                document.getElementById('notifyEnabled').checked = config.notify_closer_enabled || false;
                document.getElementById('whatsappInstanceNotif').value = config.whatsapp_instance || '';
                document.getElementById('notificationTemplate').value = config.notification_template || '🤖 Nova Reunião Agendada!\n\n📅 {{data_hora}}\n\n👤 Lead: {{lead_name}}\n📱 Telefone: {{lead_phone}}\n📧 Email: {{lead_email}}';

                if (config.whatsapp_group_id && config.whatsapp_group_name) {
                    reminderState.selectedGroup = {
                        id: config.whatsapp_group_id,
                        name: config.whatsapp_group_name
                    };
                    document.getElementById('selectedGroup').style.display = 'flex';
                    document.getElementById('selectedGroupName').textContent = config.whatsapp_group_name;
                } else {
                    document.getElementById('selectedGroup').style.display = 'none';
                }

                toggleNotificationFields();

            } catch (error) {
                console.error('Erro:', error);
            }
        }

        function toggleNotificationFields() {
            const enabled = document.getElementById('notifyEnabled').checked;
            document.getElementById('notificationFields').style.display = enabled ? 'block' : 'none';
        }

        async function selectWhatsAppGroup() {
            const instanceSelect = document.getElementById('whatsappInstanceNotif');
            const instanceCode = instanceSelect.value.trim();

            if (!instanceCode) {
                showToast('Selecione uma instância do WhatsApp primeiro', 'error');
                return;
            }

            // Pegar o NOME da instância (texto visível) em vez do código
            const instanceName = instanceSelect.options[instanceSelect.selectedIndex].text;
            console.log('🔧 DEBUG: Instance Code:', instanceCode);
            console.log('🔧 DEBUG: Instance Name:', instanceName);

            try {
                showToast('Carregando contatos...', 'info');

                // BUSCAR CONTATOS usando o endpoint novo - enviando NOME da instância
                const fetchResponse = await fetch('https://sdr.salesdever.io/webhook/busca-contatos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        instance: instanceName  // SÓ o nome da instância
                    })
                });

                if (!fetchResponse.ok) {
                    throw new Error(`HTTP error! status: ${fetchResponse.status}`);
                }

                const rawResponse = await fetchResponse.json();

                console.log('🔧 DEBUG: Resposta dos contatos:', rawResponse);

                // Processar resposta dos contatos - Evolution API retorna [{ "success": true, "data": [...] }]
                let contacts = [];

                if (Array.isArray(rawResponse) && rawResponse.length > 0) {
                    // Array principal com um objeto dentro
                    const firstItem = rawResponse[0];
                    if (firstItem && firstItem.success && Array.isArray(firstItem.data)) {
                        contacts = firstItem.data;
                        console.log('🔧 DEBUG: Encontrados', contacts.length, 'contatos no array aninhado');
                    }
                } else if (rawResponse && rawResponse.success && Array.isArray(rawResponse.data)) {
                    // Objeto direto
                    contacts = rawResponse.data;
                    console.log('🔧 DEBUG: Encontrados', contacts.length, 'contatos na propriedade data');
                } else {
                    console.log('🔧 DEBUG: Estrutura não reconhecida:', rawResponse);
                }

                console.log('🔧 DEBUG: Contatos processados:', contacts);

                reminderState.availableGroups = contacts.map(contact => ({
                    id: contact.id || contact.remoteJid || contact.phone || contact.numero,
                    name: contact.pushName || contact.name || contact.nome || contact.remoteJid || 'Sem nome',
                    participants: contact.isGroup ? 'Grupo' : 'Contato individual',
                    type: contact.isGroup ? 'group' : 'contact',
                    remoteJid: contact.remoteJid || contact.id
                }));

                renderGroupsList();
                document.getElementById('groupModal').classList.add('active');

            } catch (error) {
                console.error('Erro ao buscar contatos:', error);
                showToast('Erro ao buscar contatos', 'error');
            }
        }

        function renderGroupsList() {
            const container = document.getElementById('groupsList');

            if (reminderState.availableGroups.length === 0) {
                container.innerHTML = '<div class="empty-state">Nenhum grupo encontrado</div>';
                return;
            }

            container.innerHTML = reminderState.availableGroups.map(group => `
                <div class="group-item" onclick="selectGroup('${group.id}', '${escapeHtml(group.name)}')">
                    <div class="group-icon">
                        <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/>
                        </svg>
                    </div>
                    <div class="group-info">
                        <div class="group-name">${escapeHtml(group.name)}</div>
                        <div class="group-meta">${group.participants} participantes</div>
                    </div>
                </div>
            `).join('');
        }

        function selectGroup(groupId, groupName) {
            reminderState.selectedGroup = { id: groupId, name: groupName };
            document.getElementById('selectedGroup').style.display = 'flex';
            document.getElementById('selectedGroupName').textContent = groupName;
            closeGroupModal();
            showToast('Grupo selecionado!', 'success');
        }

        function closeGroupModal() {
            document.getElementById('groupModal').classList.remove('active');
        }

        async function saveNotificationSettings(e) {
            e.preventDefault();

            const enabled = document.getElementById('notifyEnabled').checked;
            const instanceSelect = document.getElementById('whatsappInstanceNotif');
            const instanceCode = instanceSelect.value.trim();

            if (!instanceCode) {
                showToast('Informe a instância do WhatsApp', 'error');
                return;
            }

            // Pegar o NOME da instância para o webhook
            const instanceName = instanceSelect.options[instanceSelect.selectedIndex].text;

            if (enabled && !reminderState.selectedGroup) {
                showToast('Selecione um grupo', 'error');
                return;
            }

            const payload = {
                calendar_id: state.calendar.id,
                tenant_id: state.userData.tenant_id,
                notify_closer_enabled: enabled,
                whatsapp_group_id: reminderState.selectedGroup?.id || null,
                whatsapp_group_name: reminderState.selectedGroup?.name || null,
                notification_template: document.getElementById('notificationTemplate').value,
                whatsapp_instance: instanceCode
            };

            try {
                // 1. Salvar configurações de notificação
                await apiCall(ENDPOINTS.saveNotificationSettings, payload);

                // 2. Se um contato foi selecionado, salvar no webhook também
                if (enabled && reminderState.selectedGroup) {
                    console.log('🔧 DEBUG: Salvando contato selecionado:', reminderState.selectedGroup);

                    const contactPayload = {
                        instance: instanceName,  // SÓ o nome da instância
                        selected_contact: reminderState.selectedGroup,
                        action: 'save_notification_contact'
                    };

                    const saveContactResponse = await fetch('https://sdr.salesdever.io/webhook/busca-contatos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(contactPayload)
                    });

                    if (!saveContactResponse.ok) {
                        throw new Error('Erro ao salvar contato selecionado');
                    }

                    console.log('✅ Contato salvo com sucesso');
                }

                showToast('Notificações configuradas!', 'success');
                closeNotificationModal();
            } catch (error) {
                console.error('Erro:', error);
                showToast('Erro ao salvar', 'error');
            }
        }

        // Helper
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            const presetSelect = document.getElementById('reminderPreset');
            if (presetSelect) {
                presetSelect.addEventListener('change', (e) => {
                    toggleMessageFields(e.target.value);
                });
            }

            const notifyToggle = document.getElementById('notifyEnabled');
            if (notifyToggle) {
                notifyToggle.addEventListener('change', toggleNotificationFields);
            }

            console.log('✅ Sistema de Lembretes carregado');
        });
    </script>

<!-- ============================================ -->
<!-- SISTEMA DE LEMBRETES - Agora integrado nas configurações -->
<!-- ============================================ -->

<!-- MODAL: Selecionar Grupo -->
<div id="groupModal" class="modal-overlay">
    <div class="modal" style="max-width: 550px;">
        <div class="modal-header">
            <h2 style="display: flex; align-items: center; gap: 8px; margin: 0;">
                <svg class="icon icon-lg" style="color: var(--primary);" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                </svg>
                Contatos do WhatsApp
            </h2>
            <button class="btn-icon" onclick="closeGroupModal()" type="button">
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>

        <div class="modal-body" style="padding: 24px;">
            <div id="groupsList" style="max-height: 400px; overflow-y: auto;"></div>
        </div>

        <div style="padding: 16px 24px; border-top: 1px solid var(--border);">
            <button type="button" onclick="closeGroupModal()" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-weight: 600;">Fechar</button>
        </div>
    </div>
</div>

<style>
/* Group items */
.group-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.group-item:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: var(--border-hover);
    transform: translateX(4px);
}

.group-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    flex-shrink: 0;
}

.group-info {
    flex: 1;
}

.group-name {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 2px;
}

.group-meta {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
}

/* Mensagens de estado vazio específicas */
.empty-state-message {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
}

.empty-state-message svg {
    margin-bottom: 1rem;
    opacity: 0.5;
    color: var(--text-muted);
}

.empty-state-message h3 {
    margin: 0.5rem 0;
    font-size: 1.1rem;
    font-weight: 500;
    color: var(--text-color);
}

.empty-state-message p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Estilos para selects de instância */
#whatsappInstance,
#whatsappInstanceNotif {
    transition: all 0.3s ease;
}

#whatsappInstance:hover,
#whatsappInstanceNotif:hover {
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.08);
}

#whatsappInstance:focus,
#whatsappInstanceNotif:focus {
    outline: none;
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 0 3px rgba(165, 148, 255, 0.2);
}

#whatsappInstance option,
#whatsappInstanceNotif option {
    background: #1a1333;
    color: #ffffff;
    padding: 8px;
    font-weight: 500;
}

#whatsappInstance option:checked,
#whatsappInstanceNotif option:checked {
    background: var(--primary);
    color: #ffffff;
}

#whatsappInstance option:hover,
#whatsappInstanceNotif option:hover {
    background: rgba(165, 148, 255, 0.2);
}

/* ========== POPUPS CUSTOMIZADOS ========== */
.alert-modal, .confirm-modal {
    max-width: 450px;
    width: 90%;
    min-width: 320px;
    background: linear-gradient(135deg, rgba(15, 8, 40, 0.98), rgba(10, 4, 32, 0.98));
    backdrop-filter: blur(24px);
    border: 1px solid rgba(165, 148, 255, 0.2);
    border-radius: 20px;
    box-shadow:
        0 25px 50px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(165, 148, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    animation: customPopupSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
}

.alert-modal::before, .confirm-modal::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(165, 148, 255, 0.6), transparent);
}

.alert-modal .modal-header,
.confirm-modal .modal-header {
    padding: 1.75rem 2rem 0.5rem 2rem;
    text-align: center;
    border: none;
    background: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
}

.alert-modal .modal-header h3,
.confirm-modal .modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: -0.025em;
    text-align: center;
    width: 100%;
}

.alert-modal .modal-content,
.confirm-modal .modal-content {
    padding: 1rem 2rem 1.5rem 2rem;
    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
}

.alert-modal .modal-content p,
.confirm-modal .modal-content p {
    margin: 0;
    line-height: 1.6;
    color: var(--text-secondary);
    font-size: 0.95rem;
    white-space: pre-line;
    text-align: center;
    width: 100%;
}

.alert-modal .modal-footer,
.confirm-modal .modal-footer {
    padding: 0 2rem 2rem 2rem;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    border: none;
}

/* Botão de Alert */
.alert-modal .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    padding: 12px 32px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    letter-spacing: 0.025em;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    min-width: 120px;
}

.alert-modal .btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s;
}

.alert-modal .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow:
        0 12px 24px rgba(165, 148, 255, 0.3),
        0 0 0 1px rgba(165, 148, 255, 0.4);
    background: linear-gradient(135deg, #B5A3FF, var(--primary));
}

.alert-modal .btn-primary:hover::before {
    left: 100%;
}

.alert-modal .btn-primary:active {
    transform: translateY(0);
    transition: transform 0.1s;
}

/* Botões de Confirmação */
.confirm-modal .btn-secondary {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border);
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    letter-spacing: 0.025em;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 100px;
}

.confirm-modal .btn-secondary:hover {
    background: var(--bg-card-hover);
    border-color: var(--border-hover);
    transform: translateY(-1px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.confirm-modal .btn-danger {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    letter-spacing: 0.025em;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    min-width: 110px;
}

.confirm-modal .btn-danger::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s;
}

.confirm-modal .btn-danger:hover {
    transform: translateY(-2px);
    box-shadow:
        0 12px 24px rgba(239, 68, 68, 0.3),
        0 0 0 1px rgba(239, 68, 68, 0.4);
    background: linear-gradient(135deg, #f87171, var(--danger));
}

.confirm-modal .btn-danger:hover::before {
    left: 100%;
}

.confirm-modal .btn-danger:active {
    transform: translateY(0);
    transition: transform 0.1s;
}

@keyframes customPopupSlideIn {
    0% {
        opacity: 0;
        transform: scale(0.85) translateY(-30px);
    }
    50% {
        opacity: 0.9;
        transform: scale(1.02) translateY(-5px);
    }
    100% {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}
</style>

<!-- POPUPS CUSTOMIZADOS -->
<div id="customAlertModal" class="modal-overlay" style="display: none;">
    <div class="modal alert-modal">
        <div class="modal-header">
            <h3>Aviso</h3>
        </div>
        <div class="modal-content">
            <p id="alertMessage"></p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-primary" onclick="closeCustomAlert()">Entendi</button>
        </div>
    </div>
</div>

<div id="customConfirmModal" class="modal-overlay" style="display: none;">
    <div class="modal confirm-modal">
        <div class="modal-header">
            <h3>Confirmação</h3>
        </div>
        <div class="modal-content">
            <p id="confirmMessage"></p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeCustomConfirm(false)">Cancelar</button>
            <button type="button" class="btn-danger" id="confirmOkButton" onclick="closeCustomConfirm(true)">Confirmar</button>
        </div>
    </div>
</div>

</body>
</html>